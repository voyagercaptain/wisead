<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.wise.dq.result.service.ResultMapper" >
	<resultMap id="BaseResultMap" type="kr.wise.dq.result.service.ResultVO">
		<result column="UPP_DQI_LNM"  property="uppDqiLnm"  jdbcType="VARCHAR"  />
		<result column="DQI_LNM"      property="dqiLnm"     jdbcType="VARCHAR"  />
		
		<result column="UPP_DQI_LNM"  property="cntName"    jdbcType="VARCHAR"  />
		<result column="TOT_CNT"      property="totCnt"     jdbcType="VARCHAR"  />	
		<result column="ERR_CNT"      property="errCnt"     jdbcType="VARCHAR"  />	
		<result column="ERR_RATE"     property="errRate"    jdbcType="VARCHAR"  />
		<result column="NO_EXE"       property="noExe"      jdbcType="VARCHAR"  />
		<result column="COL_CNT"      property="colCnt"     jdbcType="VARCHAR"  />
		<result column="TBL_CNT"      property="tblCnt"     jdbcType="VARCHAR"  />
		<result column="SUM_RATE"     property="sumRate"    jdbcType="VARCHAR"  />
		
		<result column="ANA_STR_DTM"  property="anaStrDtm"  jdbcType="VARCHAR"  />
		<result column="ANA_END_DTM"  property="anaEndDtm"  jdbcType="VARCHAR"  />
		
		<result column="ERR_SQL"  property="errSql"  jdbcType="CLOB"  />
		<result column="DBC_TBL_KOR_NM"  property="dbcTblKorNm"  jdbcType="VARCHAR"  />
		<result column="DBC_COL_KOR_NM"  property="dbcColKorNm"  jdbcType="VARCHAR"  />
		<result column="PRF_KND_CD"  property="prfKndCd"  jdbcType="VARCHAR"  />
		<result column="PRF_TYP"  property="prfTyp"  jdbcType="VARCHAR"  />
		<result column="PRF_NM"  property="prfNm"  jdbcType="VARCHAR"  />
		<result column="PRF_ID"  property="prfId"  jdbcType="VARCHAR"  />
		<result column="PRF_YN"  property="prfYn"  jdbcType="VARCHAR"  />
		<result column="DATA_TYPE"  property="dataType"  jdbcType="VARCHAR"  />
		<result column="EXP_YN"  property="expYn"  jdbcType="VARCHAR"  />
		<result column="EXP_RSN_CNTN"  property="expRsnCntn"  jdbcType="VARCHAR"  />
		
		<result column="DB_SCH_PNM"  property="dbSchPnm"  jdbcType="VARCHAR"  />
		<result column="DB_SCH_LNM"  property="dbSchLnm"  jdbcType="VARCHAR"  />
		<result column="DBC_TBL_NM"  property="dbcTblNm"  jdbcType="VARCHAR"  />
		<result column="DBC_COL_NM"  property="dbcColNm"  jdbcType="VARCHAR"  />
		
		<result column="STND_RATE"     property="stndRate"    jdbcType="VARCHAR"  />
		<result column="ERR_LST"     property="errLst"    jdbcType="VARCHAR"  />
<!-- 		<result column="GOAL"     property="goal"    jdbcType="VARCHAR"  /> -->
	</resultMap>
  
	<resultMap id="DataResultMap" type="kr.wise.dq.result.service.ResultDataVO">
		<result column="DQI_LNM"      property="dqiLnm"     jdbcType="VARCHAR"  />
		<result column="ANA_CNT"      property="anaCnt"     jdbcType="VARCHAR"  />	
		<result column="ERR_CNT"      property="errCnt"     jdbcType="VARCHAR"  />
		<result column="ERR_RATE"     property="errRate"    jdbcType="VARCHAR"  />
		<result column="PRF_KND_CD"  property="prfKndCd"  jdbcType="VARCHAR"  />
		<result column="PRF_NM"  property="prfNm"  jdbcType="VARCHAR"  />
		<result column="PRF_ID"  property="prfId"  jdbcType="VARCHAR"  />
		<result column="DBC_TBL_NM"  property="dbcTblNm"  jdbcType="VARCHAR"  />
		<result column="DBC_COL_NM"  property="dbcColNm"  jdbcType="VARCHAR"  />
		<result column="DBC_TBL_KOR_NM"  property="dbcTblKorNm"  jdbcType="VARCHAR"  />
		<result column="DBC_COL_KOR_NM"  property="dbcColKorNm"  jdbcType="VARCHAR"  />
		
		<result column="RNG"  property="rng" jdbcType="VARCHAR" />
		<result column="DTM"  property="dtm" jdbcType="VARCHAR" />
		<result column="REL"  property="rel" jdbcType="VARCHAR" />
		<result column="PTR"  property="ptr" jdbcType="VARCHAR" />
		<result column="EFVA" property="efva" jdbcType="VARCHAR" />
		<result column="UNQ"  property="unq" jdbcType="VARCHAR" />
		
		<result column="ERR_SQL"  property="errSql"  jdbcType="CLOB"  />
		
		<result column="COL_NM1" property="colNm1" jdbcType="VARCHAR" />
		<result column="COL_NM2" property="colNm2" jdbcType="VARCHAR" />
		<result column="COL_NM3" property="colNm3" jdbcType="VARCHAR" />
		<result column="COL_NM4" property="colNm4" jdbcType="VARCHAR" />
		<result column="COL_NM5" property="colNm5" jdbcType="VARCHAR" />
		<result column="COL_NM6" property="colNm6" jdbcType="VARCHAR" />
		<result column="COL_NM7" property="colNm7" jdbcType="VARCHAR" />
		<result column="COL_NM8" property="colNm8" jdbcType="VARCHAR" />
		<result column="COL_NM9" property="colNm9" jdbcType="VARCHAR" />
		<result column="COL_NM10" property="colNm10" jdbcType="VARCHAR" />
		
		<result column="COL_NM11" property="colNm11" jdbcType="VARCHAR" />
		<result column="COL_NM12" property="colNm12" jdbcType="VARCHAR" />
		<result column="COL_NM13" property="colNm13" jdbcType="VARCHAR" />
		<result column="COL_NM14" property="colNm14" jdbcType="VARCHAR" />
		<result column="COL_NM15" property="colNm15" jdbcType="VARCHAR" />
		<result column="COL_NM16" property="colNm16" jdbcType="VARCHAR" />
		<result column="COL_NM17" property="colNm17" jdbcType="VARCHAR" />
		<result column="COL_NM18" property="colNm18" jdbcType="VARCHAR" />
		<result column="COL_NM19" property="colNm19" jdbcType="VARCHAR" />
		<result column="COL_NM20" property="colNm20" jdbcType="VARCHAR" />
		
		<result column="COL_NM21" property="colNm21" jdbcType="VARCHAR" />
		<result column="COL_NM22" property="colNm22" jdbcType="VARCHAR" />
		<result column="COL_NM23" property="colNm23" jdbcType="VARCHAR" />
		<result column="COL_NM24" property="colNm24" jdbcType="VARCHAR" />
		<result column="COL_NM25" property="colNm25" jdbcType="VARCHAR" />
		<result column="COL_NM26" property="colNm26" jdbcType="VARCHAR" />
		<result column="COL_NM27" property="colNm27" jdbcType="VARCHAR" />
		<result column="COL_NM28" property="colNm28" jdbcType="VARCHAR" />
		<result column="COL_NM29" property="colNm29" jdbcType="VARCHAR" />
		<result column="COL_NM30" property="colNm30" jdbcType="VARCHAR" />
		
		<result column="COL_NM31" property="colNm31" jdbcType="VARCHAR" />
		<result column="COL_NM32" property="colNm32" jdbcType="VARCHAR" />
		<result column="COL_NM33" property="colNm33" jdbcType="VARCHAR" />
		<result column="COL_NM34" property="colNm34" jdbcType="VARCHAR" />
		<result column="COL_NM35" property="colNm35" jdbcType="VARCHAR" />
		<result column="COL_NM36" property="colNm36" jdbcType="VARCHAR" />
		<result column="COL_NM37" property="colNm37" jdbcType="VARCHAR" />
		<result column="COL_NM38" property="colNm38" jdbcType="VARCHAR" />
		<result column="COL_NM39" property="colNm39" jdbcType="VARCHAR" />
		<result column="COL_NM40" property="colNm40" jdbcType="VARCHAR" />
		
		<result column="COL_NM41" property="colNm41" jdbcType="VARCHAR" />
		<result column="COL_NM42" property="colNm42" jdbcType="VARCHAR" />
		<result column="COL_NM43" property="colNm43" jdbcType="VARCHAR" />
		<result column="COL_NM44" property="colNm44" jdbcType="VARCHAR" />
		<result column="COL_NM45" property="colNm45" jdbcType="VARCHAR" />
		<result column="COL_NM46" property="colNm46" jdbcType="VARCHAR" />
		<result column="COL_NM47" property="colNm47" jdbcType="VARCHAR" />
		<result column="COL_NM48" property="colNm48" jdbcType="VARCHAR" />
		<result column="COL_NM49" property="colNm49" jdbcType="VARCHAR" />
		<result column="COL_NM50" property="colNm50" jdbcType="VARCHAR" />
	</resultMap>

<select id="selectResultList" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
  SELECT CASE WHEN B.NO = 1 THEN A.UPP_DQI_LNM ELSE '값진단종합결과' END AS UPP_DQI_LNM 
       , CASE WHEN B.NO = 1 THEN A.DQI_LNM ELSE '값진단종합결과' END AS DQI_LNM
       , ANA_STR_DTM
       , SUM(A.TBL_CNT ) AS TBL_CNT    
	   , SUM(A.COL_CNT ) AS COL_CNT 
       , SUM(A.ERR_CNT ) AS ERR_CNT 
       , ROUND(SUM(A.ERR_CNT ) / SUM(A.TOT_CNT ) * 100, 4) AS ERR_RATE 
       , SUM(A.TOT_CNT ) AS TOT_CNT 
       , SUM(A.NO_EXE  ) AS NO_EXE 
  	   , CASE WHEN B.NO = 2 THEN NULL ELSE SUM(A.SUM_RATE) END AS SUM_RATE   
    FROM (
  SELECT DQI.UPP_DQI_LNM AS UPP_DQI_LNM
	   , DQI.DQI_LNM
	   , S.ANA_STR_DTM
	   , S.TBL_CNT
	   , S.COL_CNT
       , S.ERR_CNT
       , S.ERR_RATE
       , S.TOT_CNT
       , S.NO_EXE
  	   , ROUND(S.ERR_RATE * 100 / SUM(S.ERR_RATE) OVER (),2) AS SUM_RATE  
  	 FROM 
  	   (SELECT B.DQI_LNM AS UPP_DQI_LNM   
	         , A.DQI_LNM 	            
	      FROM WAM_DQI A
	           INNER JOIN WAM_DQI B
	              ON B.DQI_ID = A.UPP_DQI_ID
	     WHERE 1 = 1        
  	   ) DQI
  	   LEFT JOIN    	    
  	   (  	   
	   SELECT UPP_DQI_LNM
	        , DQI_LNM
	        , ANA_STR_DTM AS ANA_STR_DTM
			, COUNT(DISTINCT DBC_TBL_NM) AS TBL_CNT
			, COUNT(*)                   AS COL_CNT
		    , SUM(ESN_ER_CNT)            AS ERR_CNT
		    , ROUND((SUM(ESN_ER_CNT) / SUM(ANA_CNT)) * 100, 2) AS ERR_RATE
		    , SUM(ANA_CNT)               AS TOT_CNT
		    , COUNT(ANA_STR_DTM)         AS NO_EXE
		FROM (		     
			    SELECT A.PRF_ID
			         , U.DQI_LNM   AS UPP_DQI_LNM
					 , DQI.DQI_LNM
					 , A.ANA_STR_DTM
					 , D.DB_CONN_TRG_PNM
					 , C.DB_SCH_PNM     
					 , E.VRFC_ID
					 , E.VRFC_NM
					 , E.VRFC_RULE
					 , B.DBC_TBL_NM
					 , B.DBC_COL_NM
					 , A.ANA_CNT
					 , A.ESN_ER_CNT
					 , ROUND(A.ESN_ER_CNT / A.ANA_CNT * 100, 4) AS ER_RATE
					 , 'PT01' AS PRF_KND_CD
				  FROM WAM_PRF_RESULT A
					   INNER JOIN WAA_COL_RULE_REL B
						  ON B.RULE_REL_ID = A.PRF_ID
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID   
					   INNER JOIN WAA_VRFC_RULE E
						  ON E.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND E.VRFC_ID = B.VRFC_ID 
						 AND E.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN WAM_DQI DQI
						 ON E.DQI_ID = DQI.DQI_ID 
						AND DQI.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN WAM_DQI U
						 ON U.DQI_ID = DQI.UPP_DQI_ID
						AND U.REG_TYP_CD IN ('C', 'U') 
					   LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
                       LEFT JOIN WAA_EXP_COL EC
                          ON EC.DB_SCH_ID  = B.DB_SCH_ID
                         AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                         AND EC.DBC_COL_NM = B.DBC_COL_NM   						 
				 WHERE  1 = 1
				 		AND EC.DB_SCH_ID IS NULL         
				    	AND EC.DBC_TBL_NM IS NULL
				    	AND EC.DBC_COL_NM IS NULL
				   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
													   FROM WAM_PRF_RESULT
													  GROUP BY PRF_ID 
													 )   
		           AND NVL(EX.EXP_YN,'N')='N'     
                   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
						AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchId != null and dbSchId != ''" >
						AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchPnm != null and dbSchPnm != ''" >
						AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
					</if>
					<if test="dbcTblNm != null and dbcTblNm != ''" >
						AND (B.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR B.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
					</if>
					<if test="dbcColNm != null and dbcColNm != ''" >
						AND (B.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR B.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
					</if>
					<if test="mngUserId != null and mngUserId != ''" >
                    	AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}   
					</if>     
			    UNION ALL     
			    SELECT A.PRF_ID
			         , '유효성' AS UPP_DQI_LNM
					 , '코드 도메인'  AS DQI_LNM
					 , A.ANA_STR_DTM
					 , D.DB_CONN_TRG_PNM
					 , C.DB_SCH_PNM     
					 , E.CD_RULE_ID AS VRFC_ID
					 , E.CD_RULE_NM AS VRFC_NM
					 , ''           AS VRFC_RULE
					 , B.DBC_TBL_NM
					 , B.DBC_COL_NM
					 , A.ANA_CNT
					 , A.ESN_ER_CNT
					 , ROUND(A.ESN_ER_CNT / A.ANA_CNT * 100, 4) AS ER_RATE
					 , 'PT01' AS PRF_KND_CD
				  FROM WAM_PRF_RESULT A
					   INNER JOIN WAA_COL_RULE_REL B
						  ON B.RULE_REL_ID = A.PRF_ID
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID   
					   INNER JOIN WAA_CD_RULE E
						  ON E.CD_RULE_ID = B.VRFC_ID  		  
					  LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
                       LEFT JOIN WAA_EXP_COL EC
                          ON EC.DB_SCH_ID  = B.DB_SCH_ID
                         AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                         AND EC.DBC_COL_NM = B.DBC_COL_NM   						 
				 WHERE  1 = 1
				 		AND EC.DB_SCH_ID IS NULL         
				    	AND EC.DBC_TBL_NM IS NULL
				    	AND EC.DBC_COL_NM IS NULL
				   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
													   FROM WAM_PRF_RESULT
													  GROUP BY PRF_ID 
													 )   
		           AND NVL(EX.EXP_YN,'N')='N'     
                   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
						AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchId != null and dbSchId != ''" >
						AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchPnm != null and dbSchPnm != ''" >
						AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
					</if>
					<if test="dbcTblNm != null and dbcTblNm != ''" >
						AND (B.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR B.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
					</if>
					<if test="dbcColNm != null and dbcColNm != ''" >
						AND (B.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR B.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
					</if>
					<if test="mngUserId != null and mngUserId != ''" >
                    	AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}   
					</if>                                        
			    UNION ALL     
			                         
				SELECT A.PRF_ID
				     , '완전성' AS UPP_DQI_LNM
					 , '참조관계' AS DQI_LNM
					 , A.ANA_STR_DTM
					 , D.DB_CONN_TRG_PNM
					 , C.DB_SCH_PNM
					 , NULL AS VRFC_ID
					 , '참조무결성' AS VRFC_NM  
					 , NULL AS VRFC_RULE
					 , B.DBC_TBL_NM
					 , B.OBJ_NM  AS DBC_COL_NM
					 , A.ANA_CNT
					 , A.ESN_ER_CNT
					 , ROUND(A.ESN_ER_CNT / A.ANA_CNT * 100, 4) AS ER_RATE
					 , B.PRF_KND_CD         
				  FROM WAM_PRF_RESULT A
					   INNER JOIN WAM_PRF_MSTR B
						  ON B.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND B.PRF_ID = A.PRF_ID
						 AND B.REG_TYP_CD IN ('C', 'U')
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID					   
						LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 			
                       LEFT JOIN WAA_EXP_COL EC
                          ON EC.DB_SCH_ID  = B.DB_SCH_ID
                         AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                         AND EC.DBC_COL_NM = B.OBJ_NM    						 
				 WHERE  1 = 1  
				 		AND EC.DB_SCH_ID IS NULL         
				    	AND EC.DBC_TBL_NM IS NULL
				    	AND EC.DBC_COL_NM IS NULL
				   AND B.PRF_KND_CD = 'PT01'
				   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
													   FROM WAM_PRF_RESULT
													  GROUP BY PRF_ID 
													 )  
		           AND NVL(EX.EXP_YN,'N')='N'     
					<if test="dbConnTrgId != null and dbConnTrgId != ''" >
						AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchId != null and dbSchId != ''" >
						AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchPnm != null and dbSchPnm != ''" >
						AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
					</if>
					<if test="dbcTblNm != null and dbcTblNm != ''" >
						AND (B.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR B.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
					</if>
					<if test="dbcColNm != null and dbcColNm != ''" >
						AND (B.OBJ_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR B.OBJ_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
					</if>
					<if test="mngUserId != null and mngUserId != ''" >
                    	AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}   
					</if>                                       
			    UNION ALL                             
				SELECT A.BR_ID
				     , U.DQI_LNM   AS UPP_DQI_LNM
					 , DQI.DQI_LNM
					 , A.ANA_STR_DTM
					 , D.DB_CONN_TRG_PNM
					 , C.DB_SCH_PNM
					 , NULL AS VRFC_ID     
					 , CONCAT('업무규칙', BR_NM) AS VRFC_NM  
					 , NULL AS VRFC_RULE
					 , B.DBC_TBL_NM
					 , B.DBC_COL_NM
					 , A.ANA_CNT
					 , A.ER_CNT AS ESN_ER_CNT
					 , ROUND(A.ER_CNT / A.ANA_CNT * 100, 4) AS ER_RATE
					 , 'BR' AS PRF_KND_CD
				  FROM WAM_BR_RESULT A
					   INNER JOIN WAM_BR_MSTR B
						  ON B.BR_ID = A.BR_ID
						 AND B.REG_TYP_CD IN ('C', 'U')
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
					   LEFT JOIN WAM_BR_DQI_MAP M
					     ON M.BR_ID = B.BR_ID	 
					   LEFT JOIN WAM_DQI DQI
						 ON DQI.DQI_ID = M.DQI_ID 
						AND DQI.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN WAM_DQI U
						 ON U.DQI_ID = DQI.UPP_DQI_ID
						AND U.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 				  
                       LEFT JOIN WAA_EXP_COL EC
                          ON EC.DB_SCH_ID  = B.DB_SCH_ID
                         AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                         AND EC.DBC_COL_NM = B.DBC_TBL_NM 						 
				 WHERE  1 = 1     
				 		AND EC.DB_SCH_ID IS NULL         
				    	AND EC.DBC_TBL_NM IS NULL
				    	AND EC.DBC_COL_NM IS NULL	    
				   AND (A.BR_ID, A.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
													  FROM WAM_BR_RESULT
													GROUP BY BR_ID 
													)
		           AND NVL(EX.EXP_YN,'N')='N'     
					<if test="dbConnTrgId != null and dbConnTrgId != ''" >
						AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchId != null and dbSchId != ''" >
						AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
					</if>
					<if test="dbSchPnm != null and dbSchPnm != ''" >
						AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
					</if>
					<if test="dbcTblNm != null and dbcTblNm != ''" >
						AND (B.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR B.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
					</if>
					<if test="dbcColNm != null and dbcColNm != ''" >
						AND (B.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR B.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
					</if>
					<if test="mngUserId != null and mngUserId != ''" >
                    	AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}   
					</if>                  
		 ) X
		 GROUP BY UPP_DQI_LNM
		        , DQI_LNM
      ) S
      ON DQI.DQI_LNM = S.DQI_LNM 		        
 WHERE 1 = 1
 ) A
 LEFT JOIN
 (SELECT 1 AS NO
   UNION
  SELECT 2 AS NO  
 ) B
 ON 1 = 1
 WHERE 1 = 1
 GROUP BY CASE WHEN B.NO = 1 THEN A.UPP_DQI_LNM ELSE '값진단종합결과' END
        , CASE WHEN B.NO = 1 THEN A.DQI_LNM END               
 ORDER BY B.NO
         ,A.UPP_DQI_LNM
<!--         , CASE WHEN A.DQI_LNM = '관계키'  THEN 1 -->
<!--                WHEN A.DQI_LNM = '필수값'  THEN 2 -->
<!--                WHEN A.DQI_LNM = '금액'   THEN 3 -->
<!--                WHEN A.DQI_LNM = '날짜'   THEN 4 -->
<!--                WHEN A.DQI_LNM = '수량'   THEN 5 -->
<!--                WHEN A.DQI_LNM = '여부'   THEN 6 -->
<!--                WHEN A.DQI_LNM = '율'    THEN 7 -->
<!--                WHEN A.DQI_LNM = '코드'   THEN 8 -->
<!--                WHEN A.DQI_LNM = '계산 및 집계'  THEN 9 -->
<!--                WHEN A.DQI_LNM = '시간순서'  THEN 10 -->
<!--                WHEN A.DQI_LNM = '컬럼 간 논리관계'  THEN 11 -->
<!--                WHEN A.DQI_LNM = '명칭'  THEN 12 -->
<!--                WHEN A.DQI_LNM = '번호'  THEN 13 -->
<!--            END  -->
 
</select>


<select id="selectDtm" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	SELECT MIN(STR_DTM) AS ANA_STR_DTM
	      ,MAX(END_DTM) AS ANA_END_DTM
	  FROM (
	  (SELECT MIN(A.ANA_STR_DTM) AS STR_DTM
	     , MAX(A.ANA_END_DTM) AS END_DTM
	  FROM WAM_PRF_RESULT A
	       INNER JOIN WAM_PRF_MSTR B
	          ON B.REG_TYP_CD IN ('C', 'U')
	         AND B.PRF_ID = A.PRF_ID
	       INNER JOIN WAA_DB_SCH C
	          ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	         AND C.REG_TYP_CD IN ('C', 'U')
	         AND C.DB_SCH_ID = B.DB_SCH_ID 
	       INNER JOIN WAA_DB_CONN_TRG D
	          ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	         AND D.REG_TYP_CD IN ('C', 'U')
	         AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
<!-- 	       LEFT JOIN WAM_PRF_DQI_MAP E -->
<!-- 	         ON E.PRF_ID = B.PRF_ID -->
<!-- 	       LEFT JOIN WAM_DQI DQI -->
<!-- 	         ON E.DQI_ID = DQI.DQI_ID  -->
<!-- 	        AND DQI.REG_TYP_CD IN ('C', 'U') -->
<!-- 	       LEFT JOIN WAM_DQI U -->
<!-- 	         ON U.DQI_ID = DQI.UPP_DQI_ID -->
<!-- 	        AND U.REG_TYP_CD IN ('C', 'U')  -->
	       LEFT JOIN WAA_EXP_TBL EX          
		     ON EX.DB_SCH_ID  = B.DB_SCH_ID  
		    AND EX.DBC_TBL_NM = B.DBC_TBL_NM
			LEFT JOIN WAA_EXP_COL EC
			   ON EC.DB_SCH_ID  = B.DB_SCH_ID
			  AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
			  AND EC.DBC_COL_NM = B.OBJ_NM                     	
     	     WHERE 1 = 1
				AND EC.DB_SCH_ID IS NULL         
				AND EC.DBC_TBL_NM IS NULL
				AND EC.DBC_COL_NM IS NULL
	   AND NVL(EX.EXP_YN, 'N') = 'N'
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
	                                       FROM WAM_PRF_RESULT
	                                      GROUP BY PRF_ID 
	                                     )
		<if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (B.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR B.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
		</if>
		<if test="dbcColNm != null and dbcColNm != ''" >
			AND (B.OBJ_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR B.OBJ_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
		</if>
        <if test="mngUserId != null and mngUserId !='' ">
            AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
        </if>
		)
	  UNION ALL
	  (SELECT MIN(A.ANA_STR_DTM) AS STR_DTM
	     , MAX(A.ANA_END_DTM) AS END_DTM
	  FROM WAM_BR_RESULT A
	       INNER JOIN WAM_BR_MSTR B
	          ON B.BR_ID = A.BR_ID
	         AND B.REG_TYP_CD IN ('C', 'U')
	       INNER JOIN WAA_DB_SCH C
	          ON C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	         AND C.REG_TYP_CD IN ('C', 'U')
	         AND C.DB_SCH_ID = B.DB_SCH_ID 
	       INNER JOIN WAA_DB_CONN_TRG D
	          ON D.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	         AND D.REG_TYP_CD IN ('C', 'U')
	         AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
<!-- 	       LEFT JOIN WAM_BR_DQI_MAP M -->
<!-- 	         ON M.BR_ID = B.BR_ID	  -->
<!-- 	       LEFT JOIN WAM_DQI DQI -->
<!-- 	         ON DQI.DQI_ID = M.DQI_ID  -->
<!-- 	        AND DQI.REG_TYP_CD IN ('C', 'U') -->
<!-- 	       LEFT JOIN WAM_DQI U -->
<!-- 	         ON U.DQI_ID = DQI.UPP_DQI_ID -->
<!-- 	        AND U.REG_TYP_CD IN ('C', 'U') -->
	       LEFT JOIN WAA_EXP_TBL EX          
			 ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			AND EX.DBC_TBL_NM = B.DBC_TBL_NM
           LEFT JOIN WAA_EXP_COL EC
             ON EC.DB_SCH_ID  = B.DB_SCH_ID
            AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
            AND EC.DBC_COL_NM = B.DBC_COL_NM                     	
     	     WHERE 1 = 1
	   AND EC.DB_SCH_ID IS NULL         
	   AND EC.DBC_TBL_NM IS NULL
	   AND EC.DBC_COL_NM IS NULL
	   AND NVL(EX.EXP_YN, 'N') = 'N' 
	   AND (A.BR_ID, A.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
	                                      FROM WAM_BR_RESULT
	                                    GROUP BY BR_ID 
	                                    )
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (B.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR B.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
	   	AND (B.OBJ_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR B.OBJ_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
	   </if>
      <if test="mngUserId != null and mngUserId !='' ">
        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
      </if>
		)
	  ) RES
</select>

<select id="selectTotCnt" resultType="java.math.BigDecimal" parameterType="kr.wise.dq.result.service.ResultVO">
SELECT COUNT(*) AS TOT_CNT
  FROM WAA_DB_CONN_TRG DB
 INNER JOIN WAA_DB_SCH SCH
    ON SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
   AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
   AND SCH.REG_TYP_CD IN ('C', 'U')
  LEFT OUTER JOIN WAM_PRF_MSTR PRF
    ON PRF.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
   AND PRF.DB_SCH_ID = SCH.DB_SCH_ID
   AND PRF.PRF_KND_CD != 'PC01'
  <if test="mngUserId != null and mngUserId !='' ">
    AND PRF.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
  </if>
  LEFT OUTER JOIN WAM_BR_MSTR BR
    ON BR.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
   AND BR.DB_SCH_ID = SCH.DB_SCH_ID
  <if test="mngUserId != null and mngUserId !='' ">
    AND BR.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
  </if>
 WHERE DB.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
   AND DB.REG_TYP_CD IN ('C', 'U')
   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
   	AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchId != null and dbSchId != ''" >
   	AND SCH.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchPnm != null and dbSchPnm != ''" >
   	AND (SCH.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR SCH.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
   </if>
   <if test="dbcTblNm != null and dbcTblNm != ''" >
   	AND (PRF.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR PRF.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
   	AND (BR.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR BR.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
   </if>
   <if test="dbcColNm != null and dbcColNm != ''" >
   	AND (PRF.OBJ_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR PRF.OBJ_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
   	AND (BR.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR BR.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
   </if>
</select>

<select id="selectStndTotCnt" resultType="java.math.BigDecimal" parameterType="kr.wise.dq.result.service.ResultVO">
SELECT COUNT(*) AS TOT_CNT
  FROM WAA_DB_CONN_TRG DB
 INNER JOIN WAA_DB_SCH SCH
    ON SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
   AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
   AND SCH.REG_TYP_CD IN ('C', 'U')
 INNER JOIN WAT_DBC_TBL TBL
    ON TBL.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
   AND TBL.DB_SCH_ID = SCH.DB_SCH_ID
 INNER JOIN WAT_DBC_COL COL
    ON COL.DB_SCH_ID = TBL.DB_SCH_ID
   AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
 WHERE DB.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
   AND DB.REG_TYP_CD IN ('C', 'U')
   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
   	AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchId != null and dbSchId != ''" >
   	AND SCH.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchPnm != null and dbSchPnm != ''" >
   	AND (SCH.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR SCH.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
   </if>
   <if test="dbcTblNm != null and dbcTblNm != ''" >
   	AND (COL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR COL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
   </if>
</select>

<select id="selectRunCnt" resultType="java.math.BigDecimal" parameterType="kr.wise.dq.result.service.ResultVO">
SELECT SUM(RUN_CNT) AS TOT_CNT 
  FROM ( 
SELECT COUNT(*) AS RUN_CNT
  FROM WAA_DB_CONN_TRG DB
 INNER JOIN WAA_DB_SCH SCH
    ON SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
   AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
   AND SCH.REG_TYP_CD IN ('C', 'U')
  LEFT OUTER JOIN WAM_PRF_MSTR PRF
    ON PRF.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
   AND PRF.DB_SCH_ID = SCH.DB_SCH_ID
   AND PRF.PRF_KND_CD != 'PC01'
  INNER JOIN WAM_PRF_RESULT PR
    ON PR.PRF_ID = PRF.PRF_ID
  INNER JOIN (SELECT PRF_ID, MAX(ANA_STR_DTM) AS ANA_STR_DTM
                         FROM WAM_PRF_RESULT
                       GROUP BY PRF_ID ) R1
           ON R1.PRF_ID = PR.PRF_ID
          AND R1.ANA_STR_DTM = PR.ANA_STR_DTM
 WHERE DB.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
   AND DB.REG_TYP_CD IN ('C', 'U')
   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
   	AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchId != null and dbSchId != ''" >
   	AND SCH.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchPnm != null and dbSchPnm != ''" >
   	AND (SCH.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR SCH.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
   </if>
   <if test="dbcTblNm != null and dbcTblNm != ''" >
   	AND (PRF.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR PRF.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
   </if>
   <if test="dbcColNm != null and dbcColNm != ''" >
   	AND (PRF.OBJ_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR PRF.OBJ_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
   </if>
   <if test="mngUserId != null and mngUserId !='' ">
    AND PRF.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
   </if>
UNION ALL
SELECT COUNT(*) AS RUN_CNT
  FROM WAA_DB_CONN_TRG DB
 INNER JOIN WAA_DB_SCH SCH
    ON SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
   AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
   AND SCH.REG_TYP_CD IN ('C', 'U')
  LEFT OUTER JOIN WAM_BR_MSTR BR
    ON BR.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
   AND BR.DB_SCH_ID = SCH.DB_SCH_ID
 INNER JOIN WAM_BR_RESULT BRES
    ON BRES.BR_ID = BR.BR_ID
 INNER JOIN (SELECT BR_ID, MAX(ANA_STR_DTM) AS ANA_STR_DTM
                         FROM WAM_BR_RESULT
                       GROUP BY BR_ID ) R2
           ON R2.BR_ID = BRES.BR_ID
          AND R2.ANA_STR_DTM = BRES.ANA_STR_DTM
 WHERE DB.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
   AND DB.REG_TYP_CD IN ('C', 'U')
   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
   	AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchId != null and dbSchId != ''" >
   	AND SCH.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
   </if>
   <if test="dbSchPnm != null and dbSchPnm != ''" >
   	AND (SCH.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR SCH.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
   </if>
   <if test="dbcTblNm != null and dbcTblNm != ''" >
   	AND (BR.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR BR.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
   </if>
   <if test="dbcColNm != null and dbcColNm != ''" >
   	AND (BR.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR BR.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
   </if>
  <if test="mngUserId != null and mngUserId !='' ">
    AND BR.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
  </if>
   ) RES
</select>

<select id="selectTblList" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	-- SHEET 2 테이블목록
	-- 번호	 SCHEMA	 테이블	         테이블(한글)	    수집여부	진단여부	제외사유	    관련 검토기준
	-- 1	OO_USER	 AA_AAA_BBBB	자료실 조회 기록	Y	     N	    미사용테이블	
	
	SELECT DISTINCT A.DB_SCH_PNM AS DB_SCH_PNM
	    --  ,A.DB_SCH_LNM AS DB_SCH_LNM
	      ,B.DBC_TBL_NM AS DBC_TBL_NM
	      ,NVL(B.DBC_TBL_KOR_NM, B.DBC_TBL_NM) AS DBC_TBL_KOR_NM
	      ,NVL(EX.EXP_YN, 'N') AS EXP_YN
	      ,CASE WHEN (D.PRF_ID IS NULL AND G.BR_ID IS NULL) THEN 'N' ELSE 'Y' END AS PRF_YN
	      ,EX.EXP_RSN_CNTN AS EXP_RSN_CNTN
	    --  ,'' AS DESCN
	      ,MAX(D.ANA_STR_DTM) OVER(partition by B.DBC_TBL_NM) as ANA_STR_DTM
	  FROM WAA_DB_SCH A
	 INNER JOIN WAT_DBC_TBL B
	    ON B.DB_SCH_ID = A.DB_SCH_ID
	  LEFT OUTER JOIN WAM_PRF_MSTR C
	    ON C.DB_SCH_ID = B.DB_SCH_ID
	   AND C.DBC_TBL_NM = B.DBC_TBL_NM
	   AND C.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAM_PRF_RESULT D
	    ON D.PRF_ID = C.PRF_ID
	  LEFT OUTER JOIN WAM_BR_MSTR F
	    ON F.DB_SCH_ID = B.DB_SCH_ID
	   AND F.DBC_TBL_NM = B.DBC_TBL_NM
	   AND F.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAM_BR_RESULT G
	    ON G.BR_ID = F.BR_ID
	  LEFT OUTER JOIN WAA_EXP_TBL EX
	    ON EX.DB_SCH_ID = B.DB_SCH_ID
	   AND EX.DBC_TBL_NM = B.DBC_TBL_NM
      LEFT JOIN WAA_EXP_COL EC
        ON EC.DB_SCH_ID  = C.DB_SCH_ID 
        AND EC.DBC_TBL_NM = C.DBC_TBL_NM
        AND EC.DBC_COL_NM = C.OBJ_NM 
		WHERE 1=1
		AND A.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
		AND A.REG_TYP_CD IN ('C', 'U')
	   <!-- AND NVL(EX.EXP_YN, 'N') = 'N'  -->
	   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND A.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND A.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (A.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR A.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (B.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR B.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
	   </if>
      <if test="mngUserId != null and mngUserId !='' ">
        AND C.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
      </if>
	 ORDER BY A.DB_SCH_PNM, B.DBC_TBL_NM
</select>

<select id="selectDmnRule" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	-- SHEET 3 도메인규칙
	-- 번호	테이블명	                    한글테이블명	컬럼명	        한글컬럼명	데이터타입	검증유형	도메인	검증기준ID	검증기준명	검증형식	            분류코드	          제외데이터	제외데이터 구분자	도메인 검토내역	관련 검토기준	제외사유
	-- 1	NEWS_USER.BATCH_JOB_INFO	배치 잡 정보	BJI_STAT_CODE	상태	        CHAR(1)	    코드	    코드	    A10024	    공통코드		                    batch_job_status
	-- 2	NEWS_USER.BATCH_JOB_INFO	배치 잡 정보	BJI_REGI_DATE	등록일	    DATE(7)	    날짜	    날짜	    A10008	    년월일시분초	YYYYMMDDHH24MISS						
	
	SELECT A.DBC_TBL_NM AS DBC_TBL_NM
	      ,D.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
	      ,A.OBJ_NM AS DBC_COL_NM
	      ,E.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
	      ,E.DATA_TYPE || '(' || E.DATA_LEN || ')' AS DATA_TYPE
	      ,GET_CMCD_DTL_NM('PRF_KND_CD', A.PRF_KND_CD) AS PRF_KND_CD
	      ,DQI.DQI_LNM AS DQI_LNM
	      ,A.PRF_ID AS PRF_ID
	      ,A.PRF_NM AS PRF_NM
	      ,DQI.DQI_LNM AS PRF_TYP
	   --   ,'' AS 분류코드
	   --   ,'' AS 제외데이터
	   --   ,'' AS 제외데이터_구분자
	   --   ,'' AS 도메인_검토내역
	   --   ,'' AS 관련_검토기준
	   --   ,'' AS 제외사유
	  FROM WAM_PRF_MSTR A
	 INNER JOIN WAM_PRF_RESULT B
	    ON B.PRF_ID = A.PRF_ID
	  LEFT OUTER JOIN WAM_PRF_DQI_MAP WPDM
	    ON WPDM.PRF_ID = B.PRF_ID
	   AND WPDM.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAM_DQI DQI
	    ON DQI.DQI_ID = WPDM.DQI_ID
	   AND DQI.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAA_DB_SCH C
	    ON C.DB_SCH_ID = A.DB_SCH_ID
	   AND C.REG_TYP_CD IN ('C', 'U')
	   AND C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	  LEFT OUTER JOIN WAT_DBC_TBL D
	    ON D.DB_SCH_ID = C.DB_SCH_ID
	   AND D.DBC_TBL_NM = A.DBC_TBL_NM
	  LEFT OUTER JOIN WAT_DBC_COL E
	    ON E.DB_SCH_ID = D.DB_SCH_ID
	   AND E.DBC_TBL_NM = D.DBC_TBL_NM
	  LEFT JOIN WAA_EXP_TBL EX          
	    ON EX.DB_SCH_ID  = A.DB_SCH_ID  
	   AND EX.DBC_TBL_NM = A.DBC_TBL_NM
      LEFT JOIN WAA_EXP_COL EC
        ON EC.DB_SCH_ID  = A.DB_SCH_ID
       AND EC.DBC_TBL_NM = A.DBC_TBL_NM   
       AND EC.DBC_COL_NM = A.OBJ_NM  	   
	 WHERE A.REG_TYP_CD IN ('C', 'U')
	   AND NVL(EX.EXP_YN, 'N') = 'N'
	   AND A.PRF_KND_CD != 'PC01'
	   AND EC.DB_SCH_ID IS NULL         
	   AND EC.DBC_TBL_NM IS NULL
	   AND EC.DBC_COL_NM IS NULL	   
	 <if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (B.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR B.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
	   	AND (E.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR E.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
	   </if>
	 ORDER BY  A.PRF_ID
	 		  ,A.PRF_NM
	 		  ,D.DBC_TBL_NM
		      ,D.DBC_TBL_KOR_NM
		      ,E.DBC_COL_NM
		      ,E.DBC_COL_KOR_NM
	UNION ALL
	SELECT A.DBC_TBL_NM AS DBC_TBL_NM
	      ,D.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
	      ,A.DBC_COL_NM AS DBC_COL_NM
	      ,E.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
	      ,E.DATA_TYPE || '(' || E.DATA_LEN || ')' AS DATA_TYPE
	      ,'업무규칙' AS PRF_KND_CD
	      ,DQI.DQI_LNM AS DQI_LNM
	      ,A.BR_ID AS PRF_ID
	      ,A.BR_NM AS PRF_NM
	      ,DQI.DQI_LNM AS PRF_TYP
	    --  ,'' AS 분류코드
	    --  ,'' AS 제외데이터
	    --  ,'' AS 제외데이터_구분자
	    --  ,'' AS 도메인_검토내역
	    --  ,'' AS 관련_검토기준
	    --  ,'' AS 제외사유
	  FROM WAM_BR_MSTR A
	 INNER JOIN WAM_BR_RESULT B
	    ON B.BR_ID = A.BR_ID
	  LEFT OUTER JOIN WAM_BR_DQI_MAP WPDM
	    ON WPDM.BR_ID = B.BR_ID
	   AND WPDM.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAM_DQI DQI
	    ON DQI.DQI_ID = WPDM.DQI_ID
	   AND DQI.REG_TYP_CD IN ('C', 'U')
	  LEFT OUTER JOIN WAA_DB_SCH C
	    ON C.DB_SCH_ID = A.DB_SCH_ID
	   AND C.REG_TYP_CD IN ('C', 'U')
	   AND C.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	  LEFT OUTER JOIN WAT_DBC_TBL D
	    ON D.DB_SCH_ID = C.DB_SCH_ID
	   AND D.DBC_TBL_NM = A.DBC_TBL_NM
	  LEFT OUTER JOIN WAT_DBC_COL E
	    ON E.DB_SCH_ID = D.DB_SCH_ID
	   AND E.DBC_TBL_NM = D.DBC_TBL_NM
	   AND E.DBC_COL_NM = A.DBC_COL_NM
	  LEFT JOIN WAA_EXP_TBL EX          
	    ON EX.DB_SCH_ID  = A.DB_SCH_ID  
	   AND EX.DBC_TBL_NM = A.DBC_TBL_NM
      LEFT JOIN WAA_EXP_COL EC
        ON EC.DB_SCH_ID  = A.DB_SCH_ID
       AND EC.DBC_TBL_NM = A.DBC_TBL_NM   
       AND EC.DBC_COL_NM = A.DBC_COL_NM  
	 WHERE A.REG_TYP_CD IN ('C', 'U')
	   AND EC.DB_SCH_ID IS NULL         
	   AND EC.DBC_TBL_NM IS NULL
	   AND EC.DBC_COL_NM IS NULL	 
	   AND NVL(EX.EXP_YN, 'N') = 'N'
	 <if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (B.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR B.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
	   	AND (E.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR E.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
	   </if>
	 ORDER BY  A.BR_ID
	 		  ,A.BR_NM
	 		  ,D.DBC_TBL_NM
		      ,D.DBC_TBL_KOR_NM
		      ,E.DBC_COL_NM
		      ,E.DBC_COL_KOR_NM
</select>

<sql id="selectExec">
SELECT DISTINCT RES.*
      FROM (SELECT B.DBC_TBL_NM AS DBC_TBL_NM
				,DTBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
				,B.DBC_COL_NM AS DBC_COL_NM
				,DCOL.DBC_COL_KOR_NM 
				,IFNULL(CONCAT(DCOL.DATA_TYPE,CONCAT('[',CONCAT(IFNULL(DCOL.DATA_LEN,'-'),']'))),'') AS DATA_TYPE
				,E.VRFC_NM AS PRF_KND_CD
				,E.VRFC_ID AS PRF_ID
				,E.VRFC_RULE AS PRF_NM
				,DQI.DQI_LNM AS PRF_TYP
				,CASE WHEN A.PRF_ID IS NOT NULL THEN 'Y' ELSE 'N' END AS PRF_YN
				,EC.EXP_RSN_CNTN 
				, 0 AS LVL				
			  FROM WAM_PRF_RESULT A
				   RIGHT JOIN WAA_COL_RULE_REL B
					  ON B.RULE_REL_ID = A.PRF_ID
				   INNER JOIN WAA_DB_SCH C
					  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND C.REG_TYP_CD IN ('C', 'U')
					 AND C.DB_SCH_ID = B.DB_SCH_ID 
				   INNER JOIN WAA_DB_CONN_TRG D
					  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND D.REG_TYP_CD IN ('C', 'U')
					 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID   
				   LEFT JOIN WAA_VRFC_RULE E
					  ON E.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND E.VRFC_ID = B.VRFC_ID 
					 AND E.REG_TYP_CD IN ('C', 'U')
				   LEFT JOIN WAM_DQI DQI
					 ON E.DQI_ID = DQI.DQI_ID 
					AND DQI.REG_TYP_CD IN ('C', 'U')
				   LEFT JOIN WAM_DQI U
					 ON U.DQI_ID = DQI.UPP_DQI_ID
					AND U.REG_TYP_CD IN ('C', 'U') 
				   LEFT JOIN WAA_EXP_TBL EX          
					  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
					 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM        
                   INNER JOIN WAT_DBC_COL DCOL
                      ON DCOL.DB_SCH_ID  = B.DB_SCH_ID
                     AND DCOL.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND DCOL.DBC_COL_NM = B.DBC_COL_NM
                   INNER JOIN WAT_DBC_TBL DTBL
                      ON DTBL.DB_SCH_ID  = B.DB_SCH_ID
                     AND DTBL.DBC_TBL_NM = B.DBC_TBL_NM                        
     	     WHERE 1 = 1
<!-- 				AND EC.DB_SCH_ID IS NULL          -->
<!-- 				AND EC.DBC_TBL_NM IS NULL -->
<!-- 				AND EC.DBC_COL_NM IS NULL					  -->
	            AND NVL(EX.EXP_YN,'N')='N'
			   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (B.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR B.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (B.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR B.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
			   </if>
		      <if test="mngUserId != null and mngUserId !='' ">
		        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
		      </if>
		    UNION ALL     
		    SELECT B.DBC_TBL_NM AS DBC_TBL_NM
				,DTBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
				,B.DBC_COL_NM AS DBC_COL_NM
				,DCOL.DBC_COL_KOR_NM 
				,IFNULL(CONCAT(DCOL.DATA_TYPE,CONCAT('[',CONCAT(IFNULL(DCOL.DATA_LEN,'-'),']'))),'') AS DATA_TYPE
				,GET_CMCD_DTL_NM('CD_TYP_CD', E.CD_TYP_CD) AS PRF_KND_CD
				,E.CD_RULE_ID AS PRF_ID
				,E.CD_RULE_NM AS PRF_NM
				,'코드' AS PRF_TYP
				,CASE WHEN A.PRF_ID IS NOT NULL THEN 'Y' ELSE 'N' END AS PRF_YN
				,EC.EXP_RSN_CNTN 
				, 0 AS LVL				
			  FROM WAM_PRF_RESULT A
				   RIGHT JOIN WAA_COL_RULE_REL B
					  ON B.RULE_REL_ID = A.PRF_ID
				   INNER JOIN WAA_DB_SCH C
					  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND C.REG_TYP_CD IN ('C', 'U')
					 AND C.DB_SCH_ID = B.DB_SCH_ID 
				   INNER JOIN WAA_DB_CONN_TRG D
					  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND D.REG_TYP_CD IN ('C', 'U')
					 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID   
				   INNER JOIN WAA_CD_RULE E
					  ON E.CD_RULE_ID = B.VRFC_ID  		  
				  LEFT JOIN WAA_EXP_TBL EX          
					  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
					 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM 
                  INNER JOIN WAT_DBC_COL DCOL
                      ON DCOL.DB_SCH_ID  = B.DB_SCH_ID
                     AND DCOL.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND DCOL.DBC_COL_NM = B.DBC_COL_NM
				  INNER JOIN WAT_DBC_TBL DTBL
                      ON DTBL.DB_SCH_ID  = B.DB_SCH_ID
                     AND DTBL.DBC_TBL_NM = B.DBC_TBL_NM                     
     	     WHERE 1 = 1
<!-- 				AND EC.DB_SCH_ID IS NULL          -->
<!-- 				AND EC.DBC_TBL_NM IS NULL -->
<!-- 				AND EC.DBC_COL_NM IS NULL	 -->
	           AND NVL(EX.EXP_YN,'N')='N'
			   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (B.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR B.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (B.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR B.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
			   </if>
		      <if test="mngUserId != null and mngUserId !='' ">
		        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
		      </if>
		    UNION ALL     
			SELECT B.DBC_TBL_NM AS DBC_TBL_NM
				,DTBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
				,B.OBJ_NM AS DBC_COL_NM
				,DCOL.DBC_COL_KOR_NM 
				,IFNULL(CONCAT(DCOL.DATA_TYPE,CONCAT('[',CONCAT(IFNULL(DCOL.DATA_LEN,'-'),']'))),'') AS DATA_TYPE
				,'참조무결성' AS PRF_KND_CD 
				,B.PRF_ID AS PRF_ID
				,B.PRF_NM AS PRF_NM
				,'참조관계' AS PRF_TYP
				,CASE WHEN A.PRF_ID IS NOT NULL THEN 'Y' ELSE 'N' END AS PRF_YN
				,EC.EXP_RSN_CNTN 
				, 0 AS LVL									 
			  FROM WAM_PRF_RESULT A
				   RIGHT JOIN WAM_PRF_MSTR B
					  ON B.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND B.PRF_ID = A.PRF_ID
					 AND B.REG_TYP_CD IN ('C', 'U')
				   INNER JOIN WAA_DB_SCH C
					  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND C.REG_TYP_CD IN ('C', 'U')
					 AND C.DB_SCH_ID = B.DB_SCH_ID 
				   INNER JOIN WAA_DB_CONN_TRG D
					  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND D.REG_TYP_CD IN ('C', 'U')
					 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID					   
					LEFT JOIN WAA_EXP_TBL EX          
					  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
					 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 			
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.OBJ_NM
                  INNER JOIN WAT_DBC_COL DCOL
                      ON DCOL.DB_SCH_ID  = B.DB_SCH_ID
                     AND DCOL.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND DCOL.DBC_COL_NM = B.OBJ_NM
                  INNER JOIN WAT_DBC_TBL DTBL
                      ON DTBL.DB_SCH_ID  = B.DB_SCH_ID
                     AND DTBL.DBC_TBL_NM = B.DBC_TBL_NM    
     	     WHERE 1 = 1
<!-- 				AND EC.DB_SCH_ID IS NULL          -->
<!-- 				AND EC.DBC_TBL_NM IS NULL -->
<!-- 				AND EC.DBC_COL_NM IS NULL	 -->
			   AND B.PRF_KND_CD = 'PT01'
	           AND NVL(EX.EXP_YN,'N')='N'  
	           <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (B.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR B.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (B.OBJ_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR B.OBJ_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
			   </if>
		      <if test="mngUserId != null and mngUserId !='' ">
		        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
		      </if>
			UNION ALL
			SELECT B.DBC_TBL_NM AS DBC_TBL_NM
				 ,DTBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
				,B.DBC_COL_NM AS DBC_COL_NM
				,DCOL.DBC_COL_KOR_NM 
				,IFNULL(CONCAT(DCOL.DATA_TYPE,CONCAT('[',CONCAT(IFNULL(DCOL.DATA_LEN,'-'),']'))),'') AS DATA_TYPE
				 ,'업무규칙' AS PRF_KND_CD
				 ,B.BR_ID AS PRF_ID
				 ,B.BR_NM AS PRF_NM
				 ,DQI.DQI_LNM AS PRF_TYP
				 ,CASE WHEN A.BR_ID IS NOT NULL THEN 'Y' ELSE 'N' END AS PRF_YN
				,EC.EXP_RSN_CNTN 	
				, 0 AS LVL			 
			  FROM WAM_BR_RESULT A
				   RIGHT JOIN WAM_BR_MSTR B
					  ON B.BR_ID = A.BR_ID
					 AND B.REG_TYP_CD IN ('C', 'U')
				   INNER JOIN WAA_DB_SCH C
					  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND C.REG_TYP_CD IN ('C', 'U')
					 AND C.DB_SCH_ID = B.DB_SCH_ID 
				   INNER JOIN WAA_DB_CONN_TRG D
					  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND D.REG_TYP_CD IN ('C', 'U')
					 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
				   LEFT JOIN WAM_BR_DQI_MAP M
				     ON M.BR_ID = B.BR_ID	 
				   LEFT JOIN WAM_DQI DQI
					 ON DQI.DQI_ID = M.DQI_ID 
					AND DQI.REG_TYP_CD IN ('C', 'U')
				   LEFT JOIN WAM_DQI U
					 ON U.DQI_ID = DQI.UPP_DQI_ID
					AND U.REG_TYP_CD IN ('C', 'U')
				   LEFT JOIN WAA_EXP_TBL EX          
					  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
					 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 				  
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM 
                   INNER JOIN WAT_DBC_COL DCOL
                      ON DCOL.DB_SCH_ID  = B.DB_SCH_ID
                     AND DCOL.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND DCOL.DBC_COL_NM = B.DBC_COL_NM
					INNER JOIN WAT_DBC_TBL DTBL
                      ON DTBL.DB_SCH_ID  = B.DB_SCH_ID
                     AND DTBL.DBC_TBL_NM = B.DBC_TBL_NM                        
     	     WHERE 1 = 1
<!-- 				AND EC.DB_SCH_ID IS NULL          -->
<!-- 				AND EC.DBC_TBL_NM IS NULL -->
<!-- 				AND EC.DBC_COL_NM IS NULL	 -->
	           AND NVL(EX.EXP_YN,'N')='N' 
	           
	           <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (B.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR B.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (B.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR B.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
			   </if>
		      <if test="mngUserId != null and mngUserId !='' ">
		        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
		      </if>
			 UNION ALL
				SELECT   COL.DBC_TBL_NM AS DBC_TBL_NM
						,TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
						,COL.DBC_COL_NM AS DBC_COL_NM
						,COL.DBC_COL_KOR_NM 
						,IFNULL(CONCAT(COL.DATA_TYPE,CONCAT('[',CONCAT(IFNULL(COL.DATA_LEN,'-'),']'))),'') AS DATA_TYPE
						,''  AS PRF_KND_CD
						,''  AS PRF_ID
						,''  AS PRF_NM
						,''  AS PRF_TYP
						,'N' AS PRF_YN
						,EC.EXP_RSN_CNTN 
						, 1 AS LVL						
					  FROM WAA_DB_CONN_TRG DB
						   INNER JOIN WAA_DB_SCH SCH
							  ON SCH.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
							 AND SCH.REG_TYP_CD IN ('C', 'U')
							 AND SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID 
						   INNER JOIN WAT_DBC_TBL TBL
						      ON TBL.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID 
						     AND TBL.DB_SCH_ID = SCH.DB_SCH_ID 
						   INNER JOIN WAT_DBC_COL COL
						      ON COL.DB_SCH_ID = TBL.DB_SCH_ID 
						     AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
						    LEFT OUTER JOIN WAA_COL_RULE_REL REL
							  ON REL.DB_SCH_ID = COL.DB_SCH_ID 
							 AND REL.DBC_TBL_NM = COL.DBC_TBL_NM 
							 AND REL.DBC_COL_NM = COL.DBC_COL_NM 
						    LEFT JOIN WAA_EXP_TBL EX          
							  ON EX.DB_SCH_ID  = COL.DB_SCH_ID  
							 AND EX.DBC_TBL_NM = COL.DBC_TBL_NM
				            LEFT JOIN WAA_EXP_COL EC
				              ON EC.DB_SCH_ID  = COL.DB_SCH_ID
				             AND EC.DBC_TBL_NM = COL.DBC_TBL_NM   
				             AND EC.DBC_COL_NM = COL.DBC_COL_NM			             
							 WHERE 1 = 1
					            AND NVL(EX.EXP_YN,'N')='N'
							    AND DB.REG_TYP_CD IN ('C', 'U')
							    AND REL.RULE_REL_ID IS NULL
							    AND DB.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
							<if test="dbConnTrgId != null and dbConnTrgId != ''" >
						   	AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
						   </if>
						   <if test="dbSchId != null and dbSchId != ''" >
						   	AND SCH.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
						   </if>
						   <if test="dbSchPnm != null and dbSchPnm != ''" >
						   	AND (SCH.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR SCH.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
						   </if>
						   <if test="dbcTblNm != null and dbcTblNm != ''" >
						   	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
						   </if>
						   <if test="dbcColNm != null and dbcColNm != ''" >
						   	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
						   </if>								   
					      <if test="mngUserId != null and mngUserId !='' ">
					        AND REL.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
					      </if>
	           ORDER BY
	                 LVL  
		      		,DBC_COL_NM
		      		,DBC_TBL_NM
		      		,PRF_NM
		      		,PRF_ID 
	           ) RES
	           GROUP BY DBC_TBL_NM, DBC_COL_NM
</sql>

<select id="selectExecList" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	
	-- SHEET 4 실행목록
	-- 번호	테이블명	                    컬럼명	        검증유형	검증기준ID	검증기준명	 검증형식	                        실행여부                                                   제외사우
	-- 1	NEWS_USER.BATCH_JOB_INFO	BJI_SERVER_ID	참조	    C99999	    참조값	     NEWS_USER.BATCH_SERVER_INFO	Y    abc
	-- 2	NEWS_USER.BATCH_JOB_INFO	BJI_APPL_DATE	날짜	    A10008	    년월일시분초	 YYYYMMDDHH24MISS	            Y    bcd
	
	<include refid="selectExec" />
	
</select>

<select id="selectErrList" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
<!-- 	SHEET 5 오류목록 -->
<!-- 	번호	진단유형	진단룰명	진단테이블(영문)	        진단테이블(한글)	진단칼럼(영문)	 진단칼럼(한글)	전체건수	오류건수	오류율(%)	오류추정건수 SQL -->
<!-- 	1	여부	    여부10	NEWS_USER.CONN_GROUP_IN	연계 유입업체	    CGI_FLAG_ENABLE	 사용여부	        77	    5	    6.49	 -->
<!-- 	2	여부	    여부10	NEWS_USER.CONN_GROUP_IN	연계 유입업체	    CGI_STDXML_YN	 표준XML사용여부	77	    1	    1.30 -->
	-- 오류목록 조회
	SELECT DQI.DQI_LNM AS DQI_LNM
	      ,E.VRFC_NM AS PRF_KND_CD
	      ,B.DBC_TBL_NM AS DBC_TBL_NM
	      ,TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
	      ,B.DBC_COL_NM AS DBC_COL_NM
	      ,COL.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
	      ,A.ANA_CNT AS TOT_CNT
	      ,A.ESN_ER_CNT AS ERR_CNT
	      ,((A.ESN_ER_CNT / A.ANA_CNT) * 100) AS ERR_RATE
	      , PERR.ERR_DATA AS ERR_LST
				  FROM WAM_PRF_RESULT A
					   INNER JOIN WAA_COL_RULE_REL B
						  ON B.RULE_REL_ID = A.PRF_ID
					   LEFT JOIN (SELECT ERR.PRF_ID
					                   , ERR.ANA_STR_DTM
					                   , GROUP_CONCAT(ERR.COL_NM1 LIMIT 5) AS ERR_DATA
					                FROM WAM_PRF_ERR_DATA ERR
					               WHERE ERR.ESN_ER_DATA_SNO > 0
					               GROUP BY ERR.PRF_ID) PERR
				   		  ON PERR.PRF_ID = A.PRF_ID
				  		 AND PERR.ANA_STR_DTM = A.ANA_STR_DTM						  
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
					   INNER JOIN WAT_DBC_TBL TBL
                          ON TBL.DB_SCH_ID = C.DB_SCH_ID
						 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
					   INNER JOIN WAT_DBC_COL COL
                          ON COL.DB_SCH_ID = TBL.DB_SCH_ID
						 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
                         AND COL.DBC_TBL_NM = B.DBC_TBL_NM
                         AND COL.DBC_COL_NM = B.DBC_COL_NM
					   INNER JOIN WAA_VRFC_RULE E
						  ON E.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND E.VRFC_ID = B.VRFC_ID 
						 AND E.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN WAM_DQI DQI
						 ON E.DQI_ID = DQI.DQI_ID 
						AND DQI.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN WAM_DQI U
						 ON U.DQI_ID = DQI.UPP_DQI_ID
						AND U.REG_TYP_CD IN ('C', 'U') 
					   LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM
     	     WHERE 1 = 1
				AND EC.DB_SCH_ID IS NULL         
				AND EC.DBC_TBL_NM IS NULL
				AND EC.DBC_COL_NM IS NULL	
		           AND NVL(EX.EXP_YN,'N')='N'
		           AND A.ESN_ER_CNT > 0
				   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
													   FROM WAM_PRF_RESULT
													  GROUP BY PRF_ID 
													 )
				<if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
			   </if>
		      <if test="mngUserId != null and mngUserId !='' ">
		        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
		      </if>
			    UNION ALL     
			    SELECT '코드 도메인' AS DQI_LNM
					  ,B.VRFC_NM AS PRF_KND_CD
					  ,B.DBC_TBL_NM AS DBC_TBL_NM
					  ,TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
					  ,B.DBC_COL_NM AS DBC_COL_NM
					  ,COL.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
					  ,A.ANA_CNT AS TOT_CNT
					  ,A.ESN_ER_CNT AS ERR_CNT
					  ,((A.ESN_ER_CNT / A.ANA_CNT) * 100) AS ERR_RATE
					  , PERR.ERR_DATA AS ERR_LST
				  FROM WAM_PRF_RESULT A
					   INNER JOIN WAA_COL_RULE_REL B
						  ON B.RULE_REL_ID = A.PRF_ID
					   LEFT JOIN (SELECT ERR.PRF_ID
					                   , ERR.ANA_STR_DTM
					                   , GROUP_CONCAT(ERR.COL_NM1 LIMIT 5) AS ERR_DATA
					                FROM WAM_PRF_ERR_DATA ERR
					               WHERE ERR.ESN_ER_DATA_SNO > 0
					               GROUP BY ERR.PRF_ID) PERR
				   		  ON PERR.PRF_ID = A.PRF_ID
				  		 AND PERR.ANA_STR_DTM = A.ANA_STR_DTM						  
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
					   INNER JOIN WAT_DBC_TBL TBL
                          ON TBL.DB_SCH_ID = C.DB_SCH_ID
						 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
					   INNER JOIN WAT_DBC_COL COL
                          ON COL.DB_SCH_ID = TBL.DB_SCH_ID
						 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
                         AND COL.DBC_TBL_NM = B.DBC_TBL_NM
                         AND COL.DBC_COL_NM = B.DBC_COL_NM
					   INNER JOIN WAA_CD_RULE E
						  ON E.CD_RULE_ID = B.VRFC_ID  		  
					  LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM                     	
     	    		 WHERE 1 = 1
						AND EC.DB_SCH_ID IS NULL         
						AND EC.DBC_TBL_NM IS NULL
						AND EC.DBC_COL_NM IS NULL	
		           AND NVL(EX.EXP_YN,'N')='N'
		           AND A.ESN_ER_CNT != 0
				   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
													   FROM WAM_PRF_RESULT
													  GROUP BY PRF_ID 
													 )
				<if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
			   </if>
		      <if test="mngUserId != null and mngUserId !='' ">
		        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
		      </if>
			    UNION ALL     
				SELECT '참조관계' AS DQI_LNM
					  ,'참조무결성' AS PRF_KND_CD
					  ,B.DBC_TBL_NM AS DBC_TBL_NM
					  ,TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
					  ,B.OBJ_NM AS DBC_COL_NM
					  ,COL.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
					  ,A.ANA_CNT AS TOT_CNT
					  ,A.ESN_ER_CNT AS ERR_CNT
					  ,((A.ESN_ER_CNT / A.ANA_CNT) * 100) AS ERR_RATE
					  , PERR.ERR_DATA AS ERR_LST					
				  FROM WAM_PRF_RESULT A
					   INNER JOIN WAM_PRF_MSTR B
						  ON B.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND B.PRF_ID = A.PRF_ID
						 AND B.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN (SELECT ERR.PRF_ID
					                   , ERR.ANA_STR_DTM
					                   , GROUP_CONCAT(ERR.COL_NM1 LIMIT 5) AS ERR_DATA
					                FROM WAM_PRF_ERR_DATA ERR
					               WHERE ERR.ESN_ER_DATA_SNO > 0
					               GROUP BY ERR.PRF_ID) PERR
				   		  ON PERR.PRF_ID = A.PRF_ID
				  		 AND PERR.ANA_STR_DTM = A.ANA_STR_DTM							 
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
					   INNER JOIN WAT_DBC_TBL TBL
                          ON TBL.DB_SCH_ID = C.DB_SCH_ID
						 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
					   INNER JOIN WAT_DBC_COL COL
                          ON COL.DB_SCH_ID = TBL.DB_SCH_ID
						 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
                         AND COL.DBC_TBL_NM = B.DBC_TBL_NM
                         AND COL.DBC_COL_NM = B.OBJ_NM
						LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 			
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.OBJ_NM                     	
  	   	    	 WHERE 1 = 1
					AND EC.DB_SCH_ID IS NULL         
					AND EC.DBC_TBL_NM IS NULL
					AND EC.DBC_COL_NM IS NULL	
				   AND B.PRF_KND_CD = 'PT01'
		           AND NVL(EX.EXP_YN,'N')='N'
		           AND A.ESN_ER_CNT != 0
				   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
													   FROM WAM_PRF_RESULT
													  GROUP BY PRF_ID 
													 )
				<if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
			   </if>
		      <if test="mngUserId != null and mngUserId !='' ">
		        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
		      </if>
				UNION ALL
				SELECT DQI.DQI_LNM AS DQI_LNM
					  ,'업무규칙' AS PRF_KND_CD
					  ,B.DBC_TBL_NM AS DBC_TBL_NM
					  ,TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
					  ,B.DBC_COL_NM AS DBC_COL_NM
					  ,COL.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
					  ,A.ANA_CNT AS TOT_CNT
					  ,A.ER_CNT AS ERR_CNT
					  ,((A.ER_CNT / A.ANA_CNT) * 100) AS ERR_RATE
					  , PERR.ERR_DATA AS ERR_LST		  
				  FROM WAM_BR_RESULT A
					   INNER JOIN WAM_BR_MSTR B
						  ON B.BR_ID = A.BR_ID
						 AND B.REG_TYP_CD IN ('C', 'U')
			      	LEFT JOIN (SELECT ERR.BR_ID
					                   , ERR.ANA_STR_DTM
					                   , GROUP_CONCAT(NVL(ERR.COL_NM1,'') LIMIT 5) AS ERR_DATA
					                FROM WAM_BR_ERR_DATA ERR
					               WHERE ERR.ER_DATA_SNO > 0
					               GROUP BY ERR.BR_ID) PERR
				   		  ON PERR.BR_ID = A.BR_ID
				  		 AND PERR.ANA_STR_DTM = A.ANA_STR_DTM											 
					   INNER JOIN WAA_DB_SCH C
						  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND C.REG_TYP_CD IN ('C', 'U')
						 AND C.DB_SCH_ID = B.DB_SCH_ID 
					   INNER JOIN WAA_DB_CONN_TRG D
						  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
						 AND D.REG_TYP_CD IN ('C', 'U')
						 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
					   INNER JOIN WAT_DBC_TBL TBL
                          ON TBL.DB_SCH_ID = C.DB_SCH_ID
						 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
					   INNER JOIN WAT_DBC_COL COL
                          ON COL.DB_SCH_ID = TBL.DB_SCH_ID
						 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
                         AND COL.DBC_TBL_NM = B.DBC_TBL_NM
                         AND COL.DBC_COL_NM = B.DBC_COL_NM
					   LEFT JOIN WAM_BR_DQI_MAP M
					     ON M.BR_ID = B.BR_ID	 
					   LEFT JOIN WAM_DQI DQI
						 ON DQI.DQI_ID = M.DQI_ID 
						AND DQI.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN WAM_DQI U
						 ON U.DQI_ID = DQI.UPP_DQI_ID
						AND U.REG_TYP_CD IN ('C', 'U')
					   LEFT JOIN WAA_EXP_TBL EX          
						  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
						 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 				  
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM                     	
	     	     WHERE 1 = 1
					AND EC.DB_SCH_ID IS NULL         
					AND EC.DBC_TBL_NM IS NULL
					AND EC.DBC_COL_NM IS NULL	  
		           AND NVL(EX.EXP_YN,'N')='N'
		           AND A.ER_CNT != 0
				   AND (A.BR_ID, A.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
													  FROM WAM_BR_RESULT
													GROUP BY BR_ID 
													)
				<if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
			   </if>
		      <if test="mngUserId != null and mngUserId !='' ">
		        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
		      </if>
			 ORDER BY  DBC_TBL_NM
				      ,DBC_TBL_KOR_NM
				      ,DBC_COL_NM
				      ,DBC_COL_KOR_NM
</select>

<select id="selectErrListByDqi" resultMap="DataResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	SELECT *
	FROM (
	SELECT DQI.DQI_LNM AS DQI_LNM
	      ,E.VRFC_ID AS PRF_ID
	      ,E.VRFC_RULE AS PRF_NM
	      ,TBL.DBC_TBL_NM AS DBC_TBL_NM
	      ,TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
	      ,COL.DBC_COL_NM AS DBC_COL_NM
	      ,COL.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
	      ,E.VRFC_NM AS PRF_KND_CD
	      ,A.ANA_CNT AS ANA_CNT
	      ,A.ESN_ER_CNT AS ERR_CNT
	      ,CASE WHEN A.ANA_CNT=0 THEN 0 ELSE ROUND(A.ESN_ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
	  FROM WAM_PRF_RESULT A
		   INNER JOIN WAA_COL_RULE_REL B
			  ON B.RULE_REL_ID = A.PRF_ID
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID 
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
		   INNER JOIN WAT_DBC_TBL TBL
	                      ON TBL.DB_SCH_ID = C.DB_SCH_ID
			 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
		   INNER JOIN WAT_DBC_COL COL
	                      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
			 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
	                     AND COL.DBC_TBL_NM = B.DBC_TBL_NM
	                     AND COL.DBC_COL_NM = B.DBC_COL_NM
		   INNER JOIN WAA_VRFC_RULE E
			  ON E.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND E.VRFC_ID = B.VRFC_ID 
			 AND E.REG_TYP_CD IN ('C', 'U')
		   LEFT JOIN WAM_DQI DQI
			 ON E.DQI_ID = DQI.DQI_ID 
			AND DQI.REG_TYP_CD IN ('C', 'U')
		   LEFT JOIN WAM_DQI U
			 ON U.DQI_ID = DQI.UPP_DQI_ID
			AND U.REG_TYP_CD IN ('C', 'U') 
		   LEFT JOIN WAA_EXP_TBL EX          
			  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
            LEFT JOIN WAA_EXP_COL EC
                ON EC.DB_SCH_ID  = B.DB_SCH_ID
               AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
               AND EC.DBC_COL_NM = B.DBC_COL_NM                     	
     	     WHERE 1 = 1
				AND EC.DB_SCH_ID IS NULL         
				AND EC.DBC_TBL_NM IS NULL
				AND EC.DBC_COL_NM IS NULL	 
	         AND NVL(EX.EXP_YN,'N')='N'
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
										   FROM WAM_PRF_RESULT
										  GROUP BY PRF_ID 
										 )
	<if test="dbConnTrgId != null and dbConnTrgId != ''" >
	  	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	  </if>
	  <if test="dbSchId != null and dbSchId != ''" >
	  	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	  </if>
	  <if test="dbSchPnm != null and dbSchPnm != ''" >
	  	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
	  </if>
	  <if test="dbcTblNm != null and dbcTblNm != ''" >
	  	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
	  </if>
	  <if test="dbcColNm != null and dbcColNm != ''" >
	  	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
	  </if>
      <if test="mngUserId != null and mngUserId !='' ">
        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
      </if>					 
	   UNION ALL 
	   SELECT '코드 도메인' AS DQI_LNM
		  ,E.CD_RULE_ID AS PRF_ID
		  ,E.CD_RULE_NM AS PRF_NM
		  ,TBL.DBC_TBL_NM
		  ,TBL.DBC_TBL_KOR_NM
		  ,COL.DBC_COL_NM
		  ,COL.DBC_COL_KOR_NM
		  ,GET_CMCD_DTL_NM('CD_TYP_CD', E.CD_TYP_CD) AS PRF_KND_CD
		  ,A.ANA_CNT AS ANA_CNT
		  ,A.ESN_ER_CNT AS ERR_CNT
		  ,CASE WHEN A.ANA_CNT=0 THEN 0 ELSE ROUND(A.ESN_ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
	  FROM WAM_PRF_RESULT A
		   INNER JOIN WAA_COL_RULE_REL B
			  ON B.RULE_REL_ID = A.PRF_ID
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID 
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
		   INNER JOIN WAT_DBC_TBL TBL
	                      ON TBL.DB_SCH_ID = C.DB_SCH_ID
			 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
		   INNER JOIN WAT_DBC_COL COL
	                      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
			 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
	                     AND COL.DBC_TBL_NM = B.DBC_TBL_NM
	                     AND COL.DBC_COL_NM = B.DBC_COL_NM
		   INNER JOIN WAA_CD_RULE E
			  ON E.CD_RULE_ID = B.VRFC_ID  		  
		  LEFT JOIN WAA_EXP_TBL EX          
			  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
          LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM                     	
     	     WHERE 1 = 1
				AND EC.DB_SCH_ID IS NULL         
				AND EC.DBC_TBL_NM IS NULL
				AND EC.DBC_COL_NM IS NULL	
	         AND NVL(EX.EXP_YN,'N')='N'
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
										   FROM WAM_PRF_RESULT
										  GROUP BY PRF_ID 
										 )
	<if test="dbConnTrgId != null and dbConnTrgId != ''" >
	  	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	  </if>
	  <if test="dbSchId != null and dbSchId != ''" >
	  	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	  </if>
	  <if test="dbSchPnm != null and dbSchPnm != ''" >
	  	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
	  </if>
	  <if test="dbcTblNm != null and dbcTblNm != ''" >
	  	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
	  </if>
	  <if test="dbcColNm != null and dbcColNm != ''" >
	  	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
	  </if>
      <if test="mngUserId != null and mngUserId !='' ">
        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
      </if>						 
	   UNION ALL
	SELECT '참조관계' AS DQI_LNM
		  ,B.PRF_ID AS PRF_ID
		  ,B.PRF_NM AS PRF_NM
		  ,TBL.DBC_TBL_NM AS DBC_TBL_NM
		  ,TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
		  ,COL.DBC_COL_NM AS DBC_COL_NM
		  ,COL.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
		  ,'참조무결성' AS PRF_KND_CD
		  ,A.ANA_CNT AS ANA_CNT
		  ,A.ESN_ER_CNT AS ERR_CNT
		  ,CASE WHEN A.ANA_CNT=0 THEN 0 ELSE ROUND(A.ESN_ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
	  FROM WAM_PRF_RESULT A
		   INNER JOIN WAM_PRF_MSTR B
			  ON B.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND B.PRF_ID = A.PRF_ID
			 AND B.REG_TYP_CD IN ('C', 'U')
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID 
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
		   INNER JOIN WAT_DBC_TBL TBL
	                      ON TBL.DB_SCH_ID = C.DB_SCH_ID
			 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
		   INNER JOIN WAT_DBC_COL COL
	                      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
			 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
	                     AND COL.DBC_TBL_NM = B.DBC_TBL_NM
	                     AND COL.DBC_COL_NM = B.OBJ_NM
			LEFT JOIN WAA_EXP_TBL EX          
			  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 			
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.OBJ_NM                     	
     	     WHERE 1 = 1
				AND EC.DB_SCH_ID IS NULL         
				AND EC.DBC_TBL_NM IS NULL
				AND EC.DBC_COL_NM IS NULL	
	   AND B.PRF_KND_CD = 'PT01'
	         AND NVL(EX.EXP_YN,'N')='N'
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
										   FROM WAM_PRF_RESULT
										  GROUP BY PRF_ID 
										 )
	<if test="dbConnTrgId != null and dbConnTrgId != ''" >
	  	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	  </if>
	  <if test="dbSchId != null and dbSchId != ''" >
	  	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	  </if>
	  <if test="dbSchPnm != null and dbSchPnm != ''" >
	  	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
	  </if>
	  <if test="dbcTblNm != null and dbcTblNm != ''" >
	  	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
	  </if>
	  <if test="dbcColNm != null and dbcColNm != ''" >
	  	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
	  </if>
      <if test="mngUserId != null and mngUserId !='' ">
        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
      </if>					 
	UNION ALL
	SELECT DQI.DQI_LNM AS DQI_LNM
		  ,B.BR_ID AS PRF_ID
		  ,B.BR_NM AS PRF_NM
		  ,TBL.DBC_TBL_NM AS DBC_TBL_NM
		  ,TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
		  ,COL.DBC_COL_NM AS DBC_COL_NM
		  ,COL.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
		  ,'업무규칙' AS PRF_KND_CD
		  ,A.ANA_CNT AS ANA_CNT
		  ,A.ER_CNT AS ERR_CNT
		  ,CASE WHEN A.ANA_CNT=0 THEN 0 ELSE ROUND(A.ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
	  FROM WAM_BR_RESULT A
		   INNER JOIN WAM_BR_MSTR B
			  ON B.BR_ID = A.BR_ID
			 AND B.REG_TYP_CD IN ('C', 'U')
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID 
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
		   INNER JOIN WAT_DBC_TBL TBL
	                      ON TBL.DB_SCH_ID = C.DB_SCH_ID
			 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
		   INNER JOIN WAT_DBC_COL COL
	                      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
			 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
	                     AND COL.DBC_TBL_NM = B.DBC_TBL_NM
	                     AND COL.DBC_COL_NM = B.DBC_COL_NM
		   LEFT JOIN WAM_BR_DQI_MAP M
		     ON M.BR_ID = B.BR_ID	 
		   LEFT JOIN WAM_DQI DQI
			 ON DQI.DQI_ID = M.DQI_ID 
			AND DQI.REG_TYP_CD IN ('C', 'U')
		   LEFT JOIN WAM_DQI U
			 ON U.DQI_ID = DQI.UPP_DQI_ID
			AND U.REG_TYP_CD IN ('C', 'U')
		   LEFT JOIN WAA_EXP_TBL EX          
			  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 				  
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM                     	
     	     WHERE 1 = 1
				AND EC.DB_SCH_ID IS NULL         
				AND EC.DBC_TBL_NM IS NULL
				AND EC.DBC_COL_NM IS NULL	  
	         AND NVL(EX.EXP_YN,'N')='N'
	   AND (A.BR_ID, A.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
										  FROM WAM_BR_RESULT
										GROUP BY BR_ID 
										)
	<if test="dbConnTrgId != null and dbConnTrgId != ''" >
	  	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	  </if>
	  <if test="dbSchId != null and dbSchId != ''" >
	  	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	  </if>
	  <if test="dbSchPnm != null and dbSchPnm != ''" >
	  	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
	  </if>
	  <if test="dbcTblNm != null and dbcTblNm != ''" >
	  	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
	  </if>
	  <if test="dbcColNm != null and dbcColNm != ''" >
	  	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
	  </if>
      <if test="mngUserId != null and mngUserId !='' ">
        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
      </if>
	 ORDER BY  PRF_ID
	 		  ,PRF_NM
	 		  ,DBC_TBL_NM
		      ,DBC_TBL_KOR_NM
		      ,DBC_COL_NM
		      ,DBC_COL_KOR_NM
		      
		) TOTAL
		WHERE 1=1
		AND DQI_LNM LIKE CONCAT('%',#{dqiLnm,jdbcType=VARCHAR},'%') OR DQI_LNM LIKE CONCAT('%',UPPER(#{dqiLnm,jdbcType=VARCHAR}),'%') 		      
</select>

<select id="selectErrColCntByDqi" resultType="java.math.BigDecimal" parameterType="kr.wise.dq.result.service.ResultVO">

	SELECT COUNT(*)
	FROM (
	SELECT ERR_CNT
	FROM (

	SELECT DQI.DQI_LNM AS DQI_LNM
	      ,E.VRFC_ID AS PRF_ID
	      ,E.VRFC_RULE AS PRF_NM
	      ,TBL.DBC_TBL_NM AS DBC_TBL_NM
	      ,TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
	      ,COL.DBC_COL_NM AS DBC_COL_NM
	      ,COL.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
	      ,E.VRFC_NM AS PRF_KND_CD
	      ,A.ANA_CNT AS ANA_CNT
	      ,A.ESN_ER_CNT AS ERR_CNT
	      ,CASE WHEN A.ANA_CNT=0 THEN 0 ELSE ROUND(A.ESN_ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
	  FROM WAM_PRF_RESULT A
		   INNER JOIN WAA_COL_RULE_REL B
			  ON B.RULE_REL_ID = A.PRF_ID
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID 
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
		   INNER JOIN WAT_DBC_TBL TBL
	                      ON TBL.DB_SCH_ID = C.DB_SCH_ID
			 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
		   INNER JOIN WAT_DBC_COL COL
	                      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
			 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
	                     AND COL.DBC_TBL_NM = B.DBC_TBL_NM
	                     AND COL.DBC_COL_NM = B.DBC_COL_NM
		   INNER JOIN WAA_VRFC_RULE E
			  ON E.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND E.VRFC_ID = B.VRFC_ID 
			 AND E.REG_TYP_CD IN ('C', 'U')
		   LEFT JOIN WAM_DQI DQI
			 ON E.DQI_ID = DQI.DQI_ID 
			AND DQI.REG_TYP_CD IN ('C', 'U')
		   LEFT JOIN WAM_DQI U
			 ON U.DQI_ID = DQI.UPP_DQI_ID
			AND U.REG_TYP_CD IN ('C', 'U') 
		   LEFT JOIN WAA_EXP_TBL EX          
			  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
            LEFT JOIN WAA_EXP_COL EC
                ON EC.DB_SCH_ID  = B.DB_SCH_ID
               AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
               AND EC.DBC_COL_NM = B.DBC_COL_NM                     	
     	     WHERE 1 = 1
				AND EC.DB_SCH_ID IS NULL         
				AND EC.DBC_TBL_NM IS NULL
				AND EC.DBC_COL_NM IS NULL	 
	         AND NVL(EX.EXP_YN,'N')='N'
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
										   FROM WAM_PRF_RESULT
										  GROUP BY PRF_ID 
										 )
	<if test="dbConnTrgId != null and dbConnTrgId != ''" >
	  	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	  </if>
	  <if test="dbSchId != null and dbSchId != ''" >
	  	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	  </if>
	  <if test="dbSchPnm != null and dbSchPnm != ''" >
	  	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
	  </if>
	  <if test="dbcTblNm != null and dbcTblNm != ''" >
	  	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
	  </if>
	  <if test="dbcColNm != null and dbcColNm != ''" >
	  	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
	  </if>
      <if test="mngUserId != null and mngUserId !='' ">
        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
      </if>				 
	   UNION ALL 
	   SELECT '코드 도메인' AS DQI_LNM
		  ,E.CD_RULE_ID AS PRF_ID
		  ,E.CD_RULE_NM AS PRF_NM
		  ,TBL.DBC_TBL_NM
		  ,TBL.DBC_TBL_KOR_NM
		  ,COL.DBC_COL_NM
		  ,COL.DBC_COL_KOR_NM
		  ,GET_CMCD_DTL_NM('CD_TYP_CD', E.CD_TYP_CD) AS PRF_KND_CD
		  ,A.ANA_CNT AS ANA_CNT
		  ,A.ESN_ER_CNT AS ERR_CNT
		  ,CASE WHEN A.ANA_CNT=0 THEN 0 ELSE ROUND(A.ESN_ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
	  FROM WAM_PRF_RESULT A
		   INNER JOIN WAA_COL_RULE_REL B
			  ON B.RULE_REL_ID = A.PRF_ID
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID 
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
		   INNER JOIN WAT_DBC_TBL TBL
	                      ON TBL.DB_SCH_ID = C.DB_SCH_ID
			 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
		   INNER JOIN WAT_DBC_COL COL
	                      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
			 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
	                     AND COL.DBC_TBL_NM = B.DBC_TBL_NM
	                     AND COL.DBC_COL_NM = B.DBC_COL_NM
		   INNER JOIN WAA_CD_RULE E
			  ON E.CD_RULE_ID = B.VRFC_ID  		  
		  LEFT JOIN WAA_EXP_TBL EX          
			  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
          LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM                     	
     	     WHERE 1 = 1
				AND EC.DB_SCH_ID IS NULL         
				AND EC.DBC_TBL_NM IS NULL
				AND EC.DBC_COL_NM IS NULL	
	         AND NVL(EX.EXP_YN,'N')='N'
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
										   FROM WAM_PRF_RESULT
										  GROUP BY PRF_ID 
										 )
	<if test="dbConnTrgId != null and dbConnTrgId != ''" >
	  	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	  </if>
	  <if test="dbSchId != null and dbSchId != ''" >
	  	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	  </if>
	  <if test="dbSchPnm != null and dbSchPnm != ''" >
	  	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
	  </if>
	  <if test="dbcTblNm != null and dbcTblNm != ''" >
	  	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
	  </if>
	  <if test="dbcColNm != null and dbcColNm != ''" >
	  	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
	  </if>
      <if test="mngUserId != null and mngUserId !='' ">
        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
      </if>					 
	   UNION ALL
	SELECT '참조관계' AS DQI_LNM
		  ,B.PRF_ID AS PRF_ID
		  ,B.PRF_NM AS PRF_NM
		  ,TBL.DBC_TBL_NM AS DBC_TBL_NM
		  ,TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
		  ,COL.DBC_COL_NM AS DBC_COL_NM
		  ,COL.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
		  ,'참조무결성' AS PRF_KND_CD
		  ,A.ANA_CNT AS ANA_CNT
		  ,A.ESN_ER_CNT AS ERR_CNT
		  ,CASE WHEN A.ANA_CNT=0 THEN 0 ELSE ROUND(A.ESN_ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
	  FROM WAM_PRF_RESULT A
		   INNER JOIN WAM_PRF_MSTR B
			  ON B.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND B.PRF_ID = A.PRF_ID
			 AND B.REG_TYP_CD IN ('C', 'U')
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID 
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
		   INNER JOIN WAT_DBC_TBL TBL
	                      ON TBL.DB_SCH_ID = C.DB_SCH_ID
			 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
		   INNER JOIN WAT_DBC_COL COL
	                      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
			 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
	                     AND COL.DBC_TBL_NM = B.DBC_TBL_NM
	                     AND COL.DBC_COL_NM = B.OBJ_NM
			LEFT JOIN WAA_EXP_TBL EX          
			  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 			
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.OBJ_NM                     	
     	     WHERE 1 = 1
				AND EC.DB_SCH_ID IS NULL         
				AND EC.DBC_TBL_NM IS NULL
				AND EC.DBC_COL_NM IS NULL	
	   AND B.PRF_KND_CD = 'PT01'
	         AND NVL(EX.EXP_YN,'N')='N'
	   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
										   FROM WAM_PRF_RESULT
										  GROUP BY PRF_ID 
										 )
	<if test="dbConnTrgId != null and dbConnTrgId != ''" >
	  	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	  </if>
	  <if test="dbSchId != null and dbSchId != ''" >
	  	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	  </if>
	  <if test="dbSchPnm != null and dbSchPnm != ''" >
	  	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
	  </if>
	  <if test="dbcTblNm != null and dbcTblNm != ''" >
	  	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
	  </if>
	  <if test="dbcColNm != null and dbcColNm != ''" >
	  	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
	  </if>
      <if test="mngUserId != null and mngUserId !='' ">
        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
      </if>								 
	UNION ALL
	SELECT DQI.DQI_LNM AS DQI_LNM
		  ,B.BR_ID AS PRF_ID
		  ,B.BR_NM AS PRF_NM
		  ,TBL.DBC_TBL_NM AS DBC_TBL_NM
		  ,TBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
		  ,COL.DBC_COL_NM AS DBC_COL_NM
		  ,COL.DBC_COL_KOR_NM AS DBC_COL_KOR_NM
		  ,'업무규칙' AS PRF_KND_CD
		  ,A.ANA_CNT AS ANA_CNT
		  ,A.ER_CNT AS ERR_CNT
		  ,CASE WHEN A.ANA_CNT=0 THEN 0 ELSE ROUND(A.ER_CNT*100/A.ANA_CNT,2) END AS ERR_RATE
	  FROM WAM_BR_RESULT A
		   INNER JOIN WAM_BR_MSTR B
			  ON B.BR_ID = A.BR_ID
			 AND B.REG_TYP_CD IN ('C', 'U')
		   INNER JOIN WAA_DB_SCH C
			  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND C.REG_TYP_CD IN ('C', 'U')
			 AND C.DB_SCH_ID = B.DB_SCH_ID 
		   INNER JOIN WAA_DB_CONN_TRG D
			  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
			 AND D.REG_TYP_CD IN ('C', 'U')
			 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
		   INNER JOIN WAT_DBC_TBL TBL
	                      ON TBL.DB_SCH_ID = C.DB_SCH_ID
			 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
		   INNER JOIN WAT_DBC_COL COL
	                      ON COL.DB_SCH_ID = TBL.DB_SCH_ID
			 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
	                     AND COL.DBC_TBL_NM = B.DBC_TBL_NM
	                     AND COL.DBC_COL_NM = B.DBC_COL_NM
		   LEFT JOIN WAM_BR_DQI_MAP M
		     ON M.BR_ID = B.BR_ID	 
		   LEFT JOIN WAM_DQI DQI
			 ON DQI.DQI_ID = M.DQI_ID 
			AND DQI.REG_TYP_CD IN ('C', 'U')
		   LEFT JOIN WAM_DQI U
			 ON U.DQI_ID = DQI.UPP_DQI_ID
			AND U.REG_TYP_CD IN ('C', 'U')
		   LEFT JOIN WAA_EXP_TBL EX          
			  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
			 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 				  
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM                     	
     	     WHERE 1 = 1
				AND EC.DB_SCH_ID IS NULL         
				AND EC.DBC_TBL_NM IS NULL
				AND EC.DBC_COL_NM IS NULL	  
	         AND NVL(EX.EXP_YN,'N')='N'
	   AND (A.BR_ID, A.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
										  FROM WAM_BR_RESULT
										GROUP BY BR_ID 
										)
	<if test="dbConnTrgId != null and dbConnTrgId != ''" >
	  	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	  </if>
	  <if test="dbSchId != null and dbSchId != ''" >
	  	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	  </if>
	  <if test="dbSchPnm != null and dbSchPnm != ''" >
	  	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
	  </if>
	  <if test="dbcTblNm != null and dbcTblNm != ''" >
	  	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
	  </if>
	  <if test="dbcColNm != null and dbcColNm != ''" >
	  	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
	  </if>
      <if test="mngUserId != null and mngUserId !='' ">
        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
      </if>		
	 ORDER BY  PRF_ID
	 		  ,PRF_NM
	 		  ,DBC_TBL_NM
		      ,DBC_TBL_KOR_NM
		      ,DBC_COL_NM
		      ,DBC_COL_KOR_NM
		      
		) TOTAL
		WHERE 1=1
		AND DQI_LNM LIKE CONCAT('%',#{dqiLnm,jdbcType=VARCHAR},'%') OR DQI_LNM LIKE CONCAT('%',UPPER(#{dqiLnm,jdbcType=VARCHAR}),'%')
	) TMP
	WHERE ERR_CNT != 0 		      
</select>


<select id="selectErrDataMaxColCnt" resultType="int" parameterType="kr.wise.dq.result.service.ResultVO">
	SELECT IFNULL(MAX(RES.COL_CNT), 0) AS COL_CNT
  FROM (
		SELECT PERR.COL_CNT
		  FROM WAM_PRF_RESULT A
			   INNER JOIN WAA_COL_RULE_REL B
				  ON B.RULE_REL_ID = A.PRF_ID
				INNER JOIN WAM_PRF_ERR_DATA PERR
				   ON PERR.PRF_ID = A.PRF_ID
				  AND PERR.ANA_STR_DTM = A.ANA_STR_DTM
				  AND PERR.ESN_ER_DATA_SNO = 0
			   INNER JOIN WAA_DB_SCH C
				  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND C.REG_TYP_CD IN ('C', 'U')
				 AND C.DB_SCH_ID = B.DB_SCH_ID 
			   INNER JOIN WAA_DB_CONN_TRG D
				  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND D.REG_TYP_CD IN ('C', 'U')
				 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
			   INNER JOIN WAT_DBC_TBL TBL
				  ON TBL.DB_SCH_ID = C.DB_SCH_ID
				 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
			   INNER JOIN WAT_DBC_COL COL
				  ON COL.DB_SCH_ID = TBL.DB_SCH_ID
				 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
				 AND COL.DBC_TBL_NM = B.DBC_TBL_NM
				 AND COL.DBC_COL_NM = B.DBC_COL_NM
			   INNER JOIN WAA_VRFC_RULE E
				  ON E.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND E.VRFC_ID = B.VRFC_ID 
				 AND E.REG_TYP_CD IN ('C', 'U')
			   LEFT JOIN WAM_DQI DQI
				 ON E.DQI_ID = DQI.DQI_ID 
				AND DQI.REG_TYP_CD IN ('C', 'U')
			   LEFT JOIN WAM_DQI U
				 ON U.DQI_ID = DQI.UPP_DQI_ID
				AND U.REG_TYP_CD IN ('C', 'U') 
			   LEFT JOIN WAA_EXP_TBL EX          
				  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
				 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM                     	
     	     WHERE 1 = 1
				AND EC.DB_SCH_ID IS NULL         
				AND EC.DBC_TBL_NM IS NULL
				AND EC.DBC_COL_NM IS NULL	
		   AND NVL(EX.EXP_YN,'N')='N'
		   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
											   FROM WAM_PRF_RESULT
											  GROUP BY PRF_ID 
											 )
			<if test="dbConnTrgId != null and dbConnTrgId != ''" >
		   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		   </if>
		   <if test="dbSchId != null and dbSchId != ''" >
		   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		   </if>
		   <if test="dbSchPnm != null and dbSchPnm != ''" >
		   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
		   </if>
		   <if test="dbcTblNm != null and dbcTblNm != ''" >
		   	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
		   </if>
		   <if test="dbcColNm != null and dbcColNm != ''" >
		   	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
		   </if>
	     <if test="mngUserId != null and mngUserId !='' ">
	       AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
	     </if>						 
		UNION ALL 
		SELECT PERR.COL_CNT
		  FROM WAM_PRF_RESULT A
			   INNER JOIN WAA_COL_RULE_REL B
				  ON B.RULE_REL_ID = A.PRF_ID
			   INNER JOIN WAM_PRF_ERR_DATA PERR
				   ON PERR.PRF_ID = A.PRF_ID
				  AND PERR.ANA_STR_DTM = A.ANA_STR_DTM
				  AND PERR.ESN_ER_DATA_SNO = 0
			   INNER JOIN WAA_DB_SCH C
				  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND C.REG_TYP_CD IN ('C', 'U')
				 AND C.DB_SCH_ID = B.DB_SCH_ID 
			   INNER JOIN WAA_DB_CONN_TRG D
				  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND D.REG_TYP_CD IN ('C', 'U')
				 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
			   INNER JOIN WAT_DBC_TBL TBL
				  ON TBL.DB_SCH_ID = C.DB_SCH_ID
				 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
			   INNER JOIN WAT_DBC_COL COL
				  ON COL.DB_SCH_ID = TBL.DB_SCH_ID
				 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
				 AND COL.DBC_TBL_NM = B.DBC_TBL_NM
				 AND COL.DBC_COL_NM = B.DBC_COL_NM
			   INNER JOIN WAA_CD_RULE E
				  ON E.CD_RULE_ID = B.VRFC_ID  		  
			  LEFT JOIN WAA_EXP_TBL EX          
				  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
				 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM                     	
     	     WHERE 1 = 1
				AND EC.DB_SCH_ID IS NULL         
				AND EC.DBC_TBL_NM IS NULL
				AND EC.DBC_COL_NM IS NULL	
		   AND NVL(EX.EXP_YN,'N')='N'
		   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
											   FROM WAM_PRF_RESULT
											  GROUP BY PRF_ID 
											 )
		<if test="dbConnTrgId != null and dbConnTrgId != ''" >
		   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		   </if>
		   <if test="dbSchId != null and dbSchId != ''" >
		   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		   </if>
		   <if test="dbSchPnm != null and dbSchPnm != ''" >
		   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
		   </if>
		   <if test="dbcTblNm != null and dbcTblNm != ''" >
		   	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
		   </if>
		   <if test="dbcColNm != null and dbcColNm != ''" >
		   	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
		   </if>
	     <if test="mngUserId != null and mngUserId !='' ">
	       AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
	     </if>							 
		UNION ALL
		SELECT PERR.COL_CNT
		  FROM WAM_PRF_RESULT A
			   INNER JOIN WAM_PRF_MSTR B
				  ON B.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND B.PRF_ID = A.PRF_ID
				 AND B.REG_TYP_CD IN ('C', 'U')
			   INNER JOIN WAM_PRF_ERR_DATA PERR
				   ON PERR.PRF_ID = A.PRF_ID
				  AND PERR.ANA_STR_DTM = A.ANA_STR_DTM
				  AND PERR.ESN_ER_DATA_SNO = 0
			   INNER JOIN WAA_DB_SCH C
				  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND C.REG_TYP_CD IN ('C', 'U')
				 AND C.DB_SCH_ID = B.DB_SCH_ID 
			   INNER JOIN WAA_DB_CONN_TRG D
				  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND D.REG_TYP_CD IN ('C', 'U')
				 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
			   INNER JOIN WAT_DBC_TBL TBL
				  ON TBL.DB_SCH_ID = C.DB_SCH_ID
				 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
			   INNER JOIN WAT_DBC_COL COL
				  ON COL.DB_SCH_ID = TBL.DB_SCH_ID
				 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
				 AND COL.DBC_TBL_NM = B.DBC_TBL_NM
				 AND COL.DBC_COL_NM = B.OBJ_NM
				LEFT JOIN WAA_EXP_TBL EX          
				  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
				 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 			
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.OBJ_NM                     	
     	     WHERE 1 = 1
				AND EC.DB_SCH_ID IS NULL         
				AND EC.DBC_TBL_NM IS NULL
				AND EC.DBC_COL_NM IS NULL	
		   AND B.PRF_KND_CD = 'PT01'
		   AND NVL(EX.EXP_YN,'N')='N'
		   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
											   FROM WAM_PRF_RESULT
											  GROUP BY PRF_ID 
											 )
		<if test="dbConnTrgId != null and dbConnTrgId != ''" >
		   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		   </if>
		   <if test="dbSchId != null and dbSchId != ''" >
		   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		   </if>
		   <if test="dbSchPnm != null and dbSchPnm != ''" >
		   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
		   </if>
		   <if test="dbcTblNm != null and dbcTblNm != ''" >
		   	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
		   </if>
		   <if test="dbcColNm != null and dbcColNm != ''" >
		   	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
		   </if>
	     <if test="mngUserId != null and mngUserId !='' ">
	       AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
	     </if>						 
		UNION ALL
<!-- 		업무규칙 컬럼수가 3개이상 넘어가 버리면 문제생김  이거 수정해야함 210530. 누굴 족쳐야하냐 ㅋㅋㅋ-->
<!-- 		SELECT BERR.COL_CNT -->
		SELECT '2' AS COL_CNT
		  FROM WAM_BR_RESULT A
			   INNER JOIN WAM_BR_MSTR B
				  ON B.BR_ID = A.BR_ID
				 AND B.REG_TYP_CD IN ('C', 'U')
			   INNER JOIN WAM_BR_ERR_DATA BERR
				  ON BERR.BR_ID = A.BR_ID
				 AND BERR.ANA_STR_DTM = A.ANA_STR_DTM
				 AND BERR.ER_DATA_SNO = 0
			   INNER JOIN WAA_DB_SCH C
				  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND C.REG_TYP_CD IN ('C', 'U')
				 AND C.DB_SCH_ID = B.DB_SCH_ID 
			   INNER JOIN WAA_DB_CONN_TRG D
				  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND D.REG_TYP_CD IN ('C', 'U')
				 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
			   INNER JOIN WAT_DBC_TBL TBL
				  ON TBL.DB_SCH_ID = C.DB_SCH_ID
				 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
			   INNER JOIN WAT_DBC_COL COL
				  ON COL.DB_SCH_ID = TBL.DB_SCH_ID
				 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
				 AND COL.DBC_TBL_NM = B.DBC_TBL_NM
				 AND COL.DBC_COL_NM = B.DBC_COL_NM
			   LEFT JOIN WAM_BR_DQI_MAP M
				 ON M.BR_ID = B.BR_ID	 
			   LEFT JOIN WAM_DQI DQI
				 ON DQI.DQI_ID = M.DQI_ID 
				AND DQI.REG_TYP_CD IN ('C', 'U')
			   LEFT JOIN WAM_DQI U
				 ON U.DQI_ID = DQI.UPP_DQI_ID
				AND U.REG_TYP_CD IN ('C', 'U')
			   LEFT JOIN WAA_EXP_TBL EX          
				  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
				 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 				  
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM                     	
     	     WHERE 1 = 1
				AND EC.DB_SCH_ID IS NULL         
				AND EC.DBC_TBL_NM IS NULL
				AND EC.DBC_COL_NM IS NULL	 
		   AND NVL(EX.EXP_YN,'N')='N'
		   AND (A.BR_ID, A.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
											  FROM WAM_BR_RESULT
											GROUP BY BR_ID 
											)
			<if test="dbConnTrgId != null and dbConnTrgId != ''" >
		   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		   </if>
		   <if test="dbSchId != null and dbSchId != ''" >
		   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		   </if>
		   <if test="dbSchPnm != null and dbSchPnm != ''" >
		   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
		   </if>
		   <if test="dbcTblNm != null and dbcTblNm != ''" >
		   	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
		   </if>
		   <if test="dbcColNm != null and dbcColNm != ''" >
		   	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
		   </if>
	     <if test="mngUserId != null and mngUserId !='' ">
	       AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
	     </if>
       ) RES
</select>

<select id="selectErrDataByDqi" resultMap="DataResultMap" parameterType="map">
			SELECT *
			FROM (
			
			SELECT DQI.DQI_LNM
			  ,E.VRFC_ID AS PRF_ID
			  ,E.VRFC_RULE AS PRF_NM
			  ,TBL.DBC_TBL_NM
			  ,TBL.DBC_TBL_KOR_NM
			  ,COL.DBC_COL_NM
			  ,COL.DBC_COL_KOR_NM
			  ,E.VRFC_NM AS PRF_KND_CD
			  ,${pcolnm}
		  FROM WAM_PRF_RESULT A
			   INNER JOIN WAA_COL_RULE_REL B
				  ON B.RULE_REL_ID = A.PRF_ID
				INNER JOIN WAM_PRF_ERR_DATA PERR
				   ON PERR.PRF_ID = A.PRF_ID
				  AND PERR.ANA_STR_DTM = A.ANA_STR_DTM
				  AND PERR.ESN_ER_DATA_SNO > 0
			   INNER JOIN WAA_DB_SCH C
				  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND C.REG_TYP_CD IN ('C', 'U')
				 AND C.DB_SCH_ID = B.DB_SCH_ID 
			   INNER JOIN WAA_DB_CONN_TRG D
				  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND D.REG_TYP_CD IN ('C', 'U')
				 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID 
			   INNER JOIN WAT_DBC_TBL TBL
				  ON TBL.DB_SCH_ID = C.DB_SCH_ID
				 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
			   INNER JOIN WAT_DBC_COL COL
				  ON COL.DB_SCH_ID = TBL.DB_SCH_ID
				 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
				 AND COL.DBC_TBL_NM = B.DBC_TBL_NM
				 AND COL.DBC_COL_NM = B.DBC_COL_NM
			   INNER JOIN WAA_VRFC_RULE E
				  ON E.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND E.VRFC_ID = B.VRFC_ID 
				 AND E.REG_TYP_CD IN ('C', 'U')
			   LEFT JOIN WAM_DQI DQI
				 ON E.DQI_ID = DQI.DQI_ID 
				AND DQI.REG_TYP_CD IN ('C', 'U')
			   LEFT JOIN WAM_DQI U
				 ON U.DQI_ID = DQI.UPP_DQI_ID
				AND U.REG_TYP_CD IN ('C', 'U') 
			   LEFT JOIN WAA_EXP_TBL EX          
				  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
				 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM                     	
     	     WHERE 1 = 1
				AND EC.DB_SCH_ID IS NULL         
				AND EC.DBC_TBL_NM IS NULL
				AND EC.DBC_COL_NM IS NULL	
		   AND NVL(EX.EXP_YN,'N')='N'
		   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
											   FROM WAM_PRF_RESULT
											  GROUP BY PRF_ID 
											 )
		<if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
	   	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
	   </if>
      <if test="mngUserId != null and mngUserId !='' ">
        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
      </if>
		UNION ALL 
		SELECT '코드 도메인' AS DQI_LNM
			  ,E.CD_RULE_ID AS PRF_ID
			  ,E.CD_RULE_NM AS PRF_NM
			  ,TBL.DBC_TBL_NM
			  ,TBL.DBC_TBL_KOR_NM
			  ,COL.DBC_COL_NM
			  ,COL.DBC_COL_KOR_NM
			  ,GET_CMCD_DTL_NM('CD_TYP_CD', E.CD_TYP_CD) AS PRF_KND_CD
			  ,${pcolnm}
		  FROM WAM_PRF_RESULT A
			   INNER JOIN WAA_COL_RULE_REL B
				  ON B.RULE_REL_ID = A.PRF_ID
			   INNER JOIN WAM_PRF_ERR_DATA PERR
				   ON PERR.PRF_ID = A.PRF_ID
				  AND PERR.ANA_STR_DTM = A.ANA_STR_DTM
				  AND PERR.ESN_ER_DATA_SNO > 0
			   INNER JOIN WAA_DB_SCH C
				  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND C.REG_TYP_CD IN ('C', 'U')
				 AND C.DB_SCH_ID = B.DB_SCH_ID 
			   INNER JOIN WAA_DB_CONN_TRG D
				  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND D.REG_TYP_CD IN ('C', 'U')
				 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
			   INNER JOIN WAT_DBC_TBL TBL
				  ON TBL.DB_SCH_ID = C.DB_SCH_ID
				 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
			   INNER JOIN WAT_DBC_COL COL
				  ON COL.DB_SCH_ID = TBL.DB_SCH_ID
				 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
				 AND COL.DBC_TBL_NM = B.DBC_TBL_NM
				 AND COL.DBC_COL_NM = B.DBC_COL_NM
			   INNER JOIN WAA_CD_RULE E
				  ON E.CD_RULE_ID = B.VRFC_ID  		  
			  LEFT JOIN WAA_EXP_TBL EX          
				  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
				 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM                     	
     	     WHERE 1 = 1
				AND EC.DB_SCH_ID IS NULL         
				AND EC.DBC_TBL_NM IS NULL
				AND EC.DBC_COL_NM IS NULL	
		   AND NVL(EX.EXP_YN,'N')='N'
		   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
											   FROM WAM_PRF_RESULT
											  GROUP BY PRF_ID 
											 )
		<if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
	   	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
	   </if>
      <if test="mngUserId != null and mngUserId !='' ">
        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
      </if>							 
		UNION ALL
		SELECT '참조관계' AS DQI_LNM
			  ,B.PRF_ID AS PRF_ID
			  ,B.PRF_NM AS PRF_NM
			  ,TBL.DBC_TBL_NM
			  ,TBL.DBC_TBL_KOR_NM
			  ,COL.DBC_COL_NM
			  ,COL.DBC_COL_KOR_NM
			  ,'참조무결성' AS PRF_KND_CD
			  ,${pcolnm}
		  FROM WAM_PRF_RESULT A
			   INNER JOIN WAM_PRF_MSTR B
				  ON B.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND B.PRF_ID = A.PRF_ID
				 AND B.REG_TYP_CD IN ('C', 'U')
			   INNER JOIN WAM_PRF_ERR_DATA PERR
				   ON PERR.PRF_ID = A.PRF_ID
				  AND PERR.ANA_STR_DTM = A.ANA_STR_DTM
				  AND PERR.ESN_ER_DATA_SNO > 0
			   INNER JOIN WAA_DB_SCH C
				  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND C.REG_TYP_CD IN ('C', 'U')
				 AND C.DB_SCH_ID = B.DB_SCH_ID 
			   INNER JOIN WAA_DB_CONN_TRG D
				  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND D.REG_TYP_CD IN ('C', 'U')
				 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID
			   INNER JOIN WAT_DBC_TBL TBL
				  ON TBL.DB_SCH_ID = C.DB_SCH_ID
				 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
			   INNER JOIN WAT_DBC_COL COL
				  ON COL.DB_SCH_ID = TBL.DB_SCH_ID
				 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
				 AND COL.DBC_TBL_NM = B.DBC_TBL_NM
				 AND COL.DBC_COL_NM = B.OBJ_NM
				LEFT JOIN WAA_EXP_TBL EX          
				  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
				 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 			
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.OBJ_NM                     	
     	     WHERE 1 = 1
				AND EC.DB_SCH_ID IS NULL         
				AND EC.DBC_TBL_NM IS NULL
				AND EC.DBC_COL_NM IS NULL	
		   AND B.PRF_KND_CD = 'PT01'
		   AND NVL(EX.EXP_YN,'N')='N'
		   AND (A.PRF_ID, A.ANA_STR_DTM) IN (SELECT PRF_ID, MAX(ANA_STR_DTM)
											   FROM WAM_PRF_RESULT
											  GROUP BY PRF_ID 
											 )
		<if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
	   	AND (COL.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR COL.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
	   </if>
      <if test="mngUserId != null and mngUserId !='' ">
        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
      </if>								 
		UNION ALL
		SELECT DQI.DQI_LNM AS DQI_LNM
			  ,B.BR_ID AS PRF_ID
			  ,B.BR_NM AS PRF_NM
			  ,TBL.DBC_TBL_NM
			  ,TBL.DBC_TBL_KOR_NM
			  ,COL.DBC_COL_NM
			  ,COL.DBC_COL_KOR_NM
			  ,'업무규칙' AS PRF_KND_CD
<!-- 			  ,${bcolnm} -->
<!-- 210530 이거 변경해야함 -->
              ,CONCAT(NVL(BERR.COL_NM1,''),
			          CASE WHEN BERR.COL_NM2 IS NOT NULL THEN  ',' ELSE '' END,NVL(BERR.COL_NM2,''),
			          CASE WHEN BERR.COL_NM3 IS NOT NULL THEN  ',' ELSE '' END,NVL(BERR.COL_NM3,''),
			          CASE WHEN BERR.COL_NM4 IS NOT NULL THEN  ',' ELSE '' END,NVL(BERR.COL_NM4,''),
			          CASE WHEN BERR.COL_NM5 IS NOT NULL THEN  ',' ELSE '' END,NVL(BERR.COL_NM5,''),
			          CASE WHEN BERR.COL_NM6 IS NOT NULL THEN  ',' ELSE '' END,NVL(BERR.COL_NM6,''),
			          CASE WHEN BERR.COL_NM7 IS NOT NULL THEN  ',' ELSE '' END,NVL(BERR.COL_NM7,''),
			          CASE WHEN BERR.COL_NM8 IS NOT NULL THEN  ',' ELSE '' END,NVL(BERR.COL_NM8,''),
			          CASE WHEN BERR.COL_NM9 IS NOT NULL THEN  ',' ELSE '' END,NVL(BERR.COL_NM9,''),
			          CASE WHEN BERR.COL_NM10 IS NOT NULL THEN  ',' ELSE '' END,NVL(BERR.COL_NM10,'')
			          ) as COL_NM1 
			  ,COUNT(*)  AS ERR_CNT
		  FROM WAM_BR_RESULT A
			   INNER JOIN WAM_BR_MSTR B
				  ON B.BR_ID = A.BR_ID
				 AND B.REG_TYP_CD IN ('C', 'U')
			   INNER JOIN WAM_BR_ERR_DATA BERR
				  ON BERR.BR_ID = A.BR_ID
				 AND BERR.ANA_STR_DTM = A.ANA_STR_DTM
				 AND BERR.ER_DATA_SNO > 0
			   INNER JOIN WAA_DB_SCH C
				  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND C.REG_TYP_CD IN ('C', 'U')
				 AND C.DB_SCH_ID = B.DB_SCH_ID 
			   INNER JOIN WAA_DB_CONN_TRG D
				  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
				 AND D.REG_TYP_CD IN ('C', 'U')
				 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
			   INNER JOIN WAT_DBC_TBL TBL
				  ON TBL.DB_SCH_ID = C.DB_SCH_ID
				 AND TBL.DBC_TBL_NM = B.DBC_TBL_NM
			   INNER JOIN WAT_DBC_COL COL
				  ON COL.DB_SCH_ID = TBL.DB_SCH_ID
				 AND COL.DBC_TBL_NM = TBL.DBC_TBL_NM
				 AND COL.DBC_TBL_NM = B.DBC_TBL_NM
				 AND COL.DBC_COL_NM = B.DBC_COL_NM
			   LEFT JOIN WAM_BR_DQI_MAP M
				 ON M.BR_ID = B.BR_ID	 
			   LEFT JOIN WAM_DQI DQI
				 ON DQI.DQI_ID = M.DQI_ID 
				AND DQI.REG_TYP_CD IN ('C', 'U')
			   LEFT JOIN WAM_DQI U
				 ON U.DQI_ID = DQI.UPP_DQI_ID
				AND U.REG_TYP_CD IN ('C', 'U')
			   LEFT JOIN WAA_EXP_TBL EX          
				  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
				 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 				  
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM                     	
     	     WHERE 1 = 1
				AND EC.DB_SCH_ID IS NULL         
				AND EC.DBC_TBL_NM IS NULL
				AND EC.DBC_COL_NM IS NULL	 
		   AND NVL(EX.EXP_YN,'N')='N'
		   AND (A.BR_ID, A.ANA_STR_DTM) IN (SELECT BR_ID, MAX(ANA_STR_DTM)
											  FROM WAM_BR_RESULT
											GROUP BY BR_ID 
											)
		<if test="dbConnTrgId != null and dbConnTrgId != ''" >
	   	AND D.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchId != null and dbSchId != ''" >
	   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
	   </if>
	   <if test="dbSchPnm != null and dbSchPnm != ''" >
	   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
	   </if>
	   <if test="dbcTblNm != null and dbcTblNm != ''" >
	   	AND (TBL.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR TBL.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
	   </if>
	   <if test="dbcColNm != null and dbcColNm != ''" >
	   	AND (BM.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR BM.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
	   </if>
      <if test="mngUserId != null and mngUserId !='' ">
        AND B.MNG_USER_ID = #{mngUserId,jdbcType=VARCHAR}
      </if>
<!-- 	   임시추가 210530 이거 변경해야함 -->
	   GROUP BY DQI.DQI_LNM
			  ,B.BR_ID 
			  ,B.BR_NM 
			  ,TBL.DBC_TBL_NM
			  ,TBL.DBC_TBL_KOR_NM
			  ,COL.DBC_COL_NM
			  ,COL.DBC_COL_KOR_NM
			  ,BERR.COL_NM1
	          ,BERR.COL_NM2
	          ,BERR.COL_NM3
	          ,BERR.COL_NM4
	          ,BERR.COL_NM5
	          ,BERR.COL_NM6
	          ,BERR.COL_NM7
	          ,BERR.COL_NM8
	          ,BERR.COL_NM9
	          ,BERR.COL_NM10
		ORDER BY  DBC_TBL_NM
		      ,DBC_TBL_KOR_NM
		      ,DBC_COL_NM
		      ,DBC_COL_KOR_NM
		      
		) TOTAL
		WHERE 1=1
		AND DQI_LNM LIKE CONCAT('%',#{dqiLnm,jdbcType=VARCHAR},'%') OR DQI_LNM LIKE CONCAT('%',UPPER(#{dqiLnm,jdbcType=VARCHAR}),'%') 
</select>

<select id="selectStndDtm" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	SELECT MIN(DB.STR_DTM) AS ANA_STR_DTM
	     , NOW() AS ANA_END_DTM
	  FROM WAA_DB_CONN_TRG DB
	 INNER JOIN WAA_DB_SCH SCH
	    ON SCH.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
	   AND SCH.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	   AND SCH.REG_TYP_CD IN ('C', 'U')
	 WHERE 1=1
	   AND DB.EXP_DTM = STR_TO_DATE('99991231', '%Y%m%d')
	   AND DB.REG_TYP_CD IN ('C', 'U')
	 <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND SCH.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchPnm != null and dbSchPnm != ''" >
			AND (SCH.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR SCH.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
		</if>
</select>

<select id="selectModelDtm" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	SELECT NOW() AS ANA_END_DTM
	      ,MIN(RQST_DTM) AS ANA_STR_DTM
	  FROM WAM_PDM_TBL
	 WHERE 1=1
	  <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			AND DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
		</if>
		<if test="dbSchId != null and dbSchId != ''" >
			AND DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
		</if>
		<if test="dbcTblNm != null and dbcTblNm != ''" >
			AND (PDM_TBL_PNM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR PDM_TBL_LNM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
		</if>
</select>


<select id="selectExecPreCnt" resultMap="BaseResultMap" parameterType="kr.wise.dq.result.service.ResultVO">
	# 검증 성공 컬럼 수
	SELECT COUNT(CASE WHEN A.PRF_YN = 'Y' THEN 1 ELSE NULL END) AS COL_CNT
	FROM(
	<include refid="selectExec" />
	) A
</select>

<select id="selectExecTotCnt" resultType="java.math.BigDecimal" parameterType="kr.wise.dq.result.service.ResultVO">
	# 검증 가능 전체 컬럼수
SELECT COUNT(*)
FROM (	
SELECT DISTINCT RES.*
      FROM (SELECT B.DBC_TBL_NM AS DBC_TBL_NM
				,DTBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
				,B.DBC_COL_NM AS DBC_COL_NM
				,DCOL.DBC_COL_KOR_NM 
				,IFNULL(CONCAT(DCOL.DATA_TYPE,CONCAT('[',CONCAT(IFNULL(DCOL.DATA_LEN,'-'),']'))),'') AS DATA_TYPE
				,E.VRFC_NM AS PRF_KND_CD
				,E.VRFC_ID AS PRF_ID
				,E.VRFC_RULE AS PRF_NM
				,DQI.DQI_LNM AS PRF_TYP
				,CASE WHEN A.PRF_ID IS NOT NULL THEN 'Y' ELSE 'N' END AS PRF_YN
				,EC.EXP_RSN_CNTN 	
				, 0 AS LVL			
			  FROM WAM_PRF_RESULT A
				   RIGHT JOIN WAA_COL_RULE_REL B
					  ON B.RULE_REL_ID = A.PRF_ID
				   INNER JOIN WAA_DB_SCH C
					  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND C.REG_TYP_CD IN ('C', 'U')
					 AND C.DB_SCH_ID = B.DB_SCH_ID 
				   INNER JOIN WAA_DB_CONN_TRG D
					  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND D.REG_TYP_CD IN ('C', 'U')
					 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID   
				   LEFT JOIN WAA_VRFC_RULE E
					  ON E.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND E.VRFC_ID = B.VRFC_ID 
					 AND E.REG_TYP_CD IN ('C', 'U')
				   LEFT JOIN WAM_DQI DQI
					 ON E.DQI_ID = DQI.DQI_ID 
					AND DQI.REG_TYP_CD IN ('C', 'U')
				   LEFT JOIN WAM_DQI U
					 ON U.DQI_ID = DQI.UPP_DQI_ID
					AND U.REG_TYP_CD IN ('C', 'U') 
				   LEFT JOIN WAA_EXP_TBL EX          
					  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
					 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM        
                   INNER JOIN WAT_DBC_COL DCOL
                      ON DCOL.DB_SCH_ID  = B.DB_SCH_ID
                     AND DCOL.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND DCOL.DBC_COL_NM = B.DBC_COL_NM
                   INNER JOIN WAT_DBC_TBL DTBL
                      ON DTBL.DB_SCH_ID  = B.DB_SCH_ID
                     AND DTBL.DBC_TBL_NM = B.DBC_TBL_NM                        
     	     WHERE 1 = 1
<!-- 				AND EC.DB_SCH_ID IS NULL          -->
<!-- 				AND EC.DBC_TBL_NM IS NULL -->
<!-- 				AND EC.DBC_COL_NM IS NULL					  -->
				AND E.VRFC_ID IS NOT NULL
	            AND NVL(EX.EXP_YN,'N')='N'
			   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (B.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR B.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (B.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR B.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
			   </if>
		    UNION ALL     
		    SELECT B.DBC_TBL_NM AS DBC_TBL_NM
				,DTBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
				,B.DBC_COL_NM AS DBC_COL_NM
				,DCOL.DBC_COL_KOR_NM 
				,IFNULL(CONCAT(DCOL.DATA_TYPE,CONCAT('[',CONCAT(IFNULL(DCOL.DATA_LEN,'-'),']'))),'') AS DATA_TYPE
				,GET_CMCD_DTL_NM('CD_TYP_CD', E.CD_TYP_CD) AS PRF_KND_CD
				,E.CD_RULE_ID AS PRF_ID
				,E.CD_RULE_NM AS PRF_NM
				,'코드' AS PRF_TYP
				,CASE WHEN A.PRF_ID IS NOT NULL THEN 'Y' ELSE 'N' END AS PRF_YN
				,EC.EXP_RSN_CNTN 	
				, 0 AS LVL			
			  FROM WAM_PRF_RESULT A
				   RIGHT JOIN WAA_COL_RULE_REL B
					  ON B.RULE_REL_ID = A.PRF_ID
				   INNER JOIN WAA_DB_SCH C
					  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND C.REG_TYP_CD IN ('C', 'U')
					 AND C.DB_SCH_ID = B.DB_SCH_ID 
				   INNER JOIN WAA_DB_CONN_TRG D
					  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND D.REG_TYP_CD IN ('C', 'U')
					 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID   
				   INNER JOIN WAA_CD_RULE E
					  ON E.CD_RULE_ID = B.VRFC_ID  		  
				  LEFT JOIN WAA_EXP_TBL EX          
					  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
					 AND EX.DBC_TBL_NM = B.DBC_TBL_NM
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM 
                  INNER JOIN WAT_DBC_COL DCOL
                      ON DCOL.DB_SCH_ID  = B.DB_SCH_ID
                     AND DCOL.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND DCOL.DBC_COL_NM = B.DBC_COL_NM
				  INNER JOIN WAT_DBC_TBL DTBL
                      ON DTBL.DB_SCH_ID  = B.DB_SCH_ID
                     AND DTBL.DBC_TBL_NM = B.DBC_TBL_NM                     
     	     WHERE 1 = 1
<!-- 				AND EC.DB_SCH_ID IS NULL          -->
<!-- 				AND EC.DBC_TBL_NM IS NULL -->
<!-- 				AND EC.DBC_COL_NM IS NULL	 -->
				AND E.CD_RULE_ID IS NOT NULL
	           AND NVL(EX.EXP_YN,'N')='N'
			   <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (B.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR B.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (B.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR B.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
			   </if>
		    UNION ALL     
			SELECT B.DBC_TBL_NM AS DBC_TBL_NM
				,DTBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
				,B.OBJ_NM AS DBC_COL_NM
				,DCOL.DBC_COL_KOR_NM 
				,IFNULL(CONCAT(DCOL.DATA_TYPE,CONCAT('[',CONCAT(IFNULL(DCOL.DATA_LEN,'-'),']'))),'') AS DATA_TYPE
				,'참조무결성' AS PRF_KND_CD 
				,B.PRF_ID AS PRF_ID
				,B.PRF_NM AS PRF_NM
				,'참조관계' AS PRF_TYP
				,CASE WHEN A.PRF_ID IS NOT NULL THEN 'Y' ELSE 'N' END AS PRF_YN
				,EC.EXP_RSN_CNTN 	
				, 0 AS LVL								 
			  FROM WAM_PRF_RESULT A
				   RIGHT JOIN WAM_PRF_MSTR B
					  ON B.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND B.PRF_ID = A.PRF_ID
					 AND B.REG_TYP_CD IN ('C', 'U')
				   INNER JOIN WAA_DB_SCH C
					  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND C.REG_TYP_CD IN ('C', 'U')
					 AND C.DB_SCH_ID = B.DB_SCH_ID 
				   INNER JOIN WAA_DB_CONN_TRG D
					  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND D.REG_TYP_CD IN ('C', 'U')
					 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID					   
					LEFT JOIN WAA_EXP_TBL EX          
					  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
					 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 			
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.OBJ_NM
                  INNER JOIN WAT_DBC_COL DCOL
                      ON DCOL.DB_SCH_ID  = B.DB_SCH_ID
                     AND DCOL.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND DCOL.DBC_COL_NM = B.OBJ_NM
                  INNER JOIN WAT_DBC_TBL DTBL
                      ON DTBL.DB_SCH_ID  = B.DB_SCH_ID
                     AND DTBL.DBC_TBL_NM = B.DBC_TBL_NM    
     	     WHERE 1 = 1
<!-- 				AND EC.DB_SCH_ID IS NULL          -->
<!-- 				AND EC.DBC_TBL_NM IS NULL -->
<!-- 				AND EC.DBC_COL_NM IS NULL	 -->
				AND B.PRF_ID IS NOT NULL
			   AND B.PRF_KND_CD = 'PT01'
	           AND NVL(EX.EXP_YN,'N')='N'  
	           <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (B.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR B.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (B.OBJ_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR B.OBJ_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
			   </if>
			UNION ALL
			SELECT B.DBC_TBL_NM AS DBC_TBL_NM
				 ,DTBL.DBC_TBL_KOR_NM AS DBC_TBL_KOR_NM
				,B.DBC_COL_NM AS DBC_COL_NM
				,DCOL.DBC_COL_KOR_NM 
				,IFNULL(CONCAT(DCOL.DATA_TYPE,CONCAT('[',CONCAT(IFNULL(DCOL.DATA_LEN,'-'),']'))),'') AS DATA_TYPE
				 ,'업무규칙' AS PRF_KND_CD
				 ,B.BR_ID AS PRF_ID
				 ,B.BR_NM AS PRF_NM
				 ,DQI.DQI_LNM AS PRF_TYP
				 ,CASE WHEN A.BR_ID IS NOT NULL THEN 'Y' ELSE 'N' END AS PRF_YN
				,EC.EXP_RSN_CNTN 	
				, 0 AS LVL			 
			  FROM WAM_BR_RESULT A
				   RIGHT JOIN WAM_BR_MSTR B
					  ON B.BR_ID = A.BR_ID
					 AND B.REG_TYP_CD IN ('C', 'U')
				   INNER JOIN WAA_DB_SCH C
					  ON C.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND C.REG_TYP_CD IN ('C', 'U')
					 AND C.DB_SCH_ID = B.DB_SCH_ID 
				   INNER JOIN WAA_DB_CONN_TRG D
					  ON D.EXP_DTM = STR_TO_DATE('99991231','%Y%m%d')
					 AND D.REG_TYP_CD IN ('C', 'U')
					 AND D.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID  
				   LEFT JOIN WAM_BR_DQI_MAP M
				     ON M.BR_ID = B.BR_ID	 
				   LEFT JOIN WAM_DQI DQI
					 ON DQI.DQI_ID = M.DQI_ID 
					AND DQI.REG_TYP_CD IN ('C', 'U')
				   LEFT JOIN WAM_DQI U
					 ON U.DQI_ID = DQI.UPP_DQI_ID
					AND U.REG_TYP_CD IN ('C', 'U')
				   LEFT JOIN WAA_EXP_TBL EX          
					  ON EX.DB_SCH_ID  = B.DB_SCH_ID  
					 AND EX.DBC_TBL_NM = B.DBC_TBL_NM 				  
                   LEFT JOIN WAA_EXP_COL EC
                      ON EC.DB_SCH_ID  = B.DB_SCH_ID
                     AND EC.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND EC.DBC_COL_NM = B.DBC_COL_NM 
                   INNER JOIN WAT_DBC_COL DCOL
                      ON DCOL.DB_SCH_ID  = B.DB_SCH_ID
                     AND DCOL.DBC_TBL_NM = B.DBC_TBL_NM   
                     AND DCOL.DBC_COL_NM = B.DBC_COL_NM
					INNER JOIN WAT_DBC_TBL DTBL
                      ON DTBL.DB_SCH_ID  = B.DB_SCH_ID
                     AND DTBL.DBC_TBL_NM = B.DBC_TBL_NM                        
     	     WHERE 1 = 1
<!-- 				AND EC.DB_SCH_ID IS NULL          -->
<!-- 				AND EC.DBC_TBL_NM IS NULL -->
<!-- 				AND EC.DBC_COL_NM IS NULL	 -->
	           AND NVL(EX.EXP_YN,'N')='N' 
	           AND B.BR_ID IS NOT NULL
	           <if test="dbConnTrgId != null and dbConnTrgId != ''" >
			   	AND C.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchId != null and dbSchId != ''" >
			   	AND C.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
			   </if>
			   <if test="dbSchPnm != null and dbSchPnm != ''" >
			   	AND (C.DB_SCH_PNM LIKE CONCAT('%',#{dbSchPnm,jdbcType=VARCHAR},'%') OR C.DB_SCH_PNM LIKE CONCAT('%',UPPER(#{dbSchPnm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcTblNm != null and dbcTblNm != ''" >
			   	AND (B.DBC_TBL_NM LIKE CONCAT('%',#{dbcTblNm,jdbcType=VARCHAR},'%') OR B.DBC_TBL_NM LIKE CONCAT('%',UPPER(#{dbcTblNm,jdbcType=VARCHAR}),'%'))
			   </if>
			   <if test="dbcColNm != null and dbcColNm != ''" >
			   	AND (B.DBC_COL_NM LIKE CONCAT('%',#{dbcColNm,jdbcType=VARCHAR},'%') OR B.DBC_COL_NM LIKE CONCAT('%',UPPER(#{dbcColNm,jdbcType=VARCHAR}),'%'))
			   </if>								              
	           
	           ORDER BY
	           	    LVL  
		      		,DBC_COL_NM
		      		,DBC_TBL_NM
		      		,PRF_NM
		      		,PRF_ID 
	           ) RES
	           GROUP BY DBC_TBL_NM, DBC_COL_NM
	       ) A
</select>

</mapper>


