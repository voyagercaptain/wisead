<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.wise.dq.report.profile.service.ProgChartMapper" >
  <resultMap id="BaseResultMap" type="kr.wise.dq.report.profile.service.ProgChartVO">
    <id column="MAX_ANA_DGR" property="maxAnaDgr" jdbcType="VARCHAR" />
    <result column="ANA_DGR_DISP" property="anaDgrDisp" jdbcType="VARCHAR" />
    <result column="PRF_KND_CD" property="prfKndCd" jdbcType="VARCHAR" />
    <result column="ANA_CNT" property="anaCnt" jdbcType="VARCHAR" />
    <result column="ESN_ER_CNT" property="esnErCnt" jdbcType="VARCHAR" />
    <result column="ER_RATE" property="erRate" jdbcType="VARCHAR" />
    <result column="ANA_DGR" property="anaDgr" jdbcType="VARCHAR" />
    <result column="ER_CNT" property="erCnt" jdbcType="VARCHAR" />
    <result column="DPMO" property="dpmo" jdbcType="VARCHAR" />
    <result column="SIGMA" property="sigma" jdbcType="VARCHAR" />
    <result column="ANA_TBL_CNT" property="anaTblCnt" jdbcType="VARCHAR" />
    <result column="ANA_COL_CNT" property="anaColCnt" jdbcType="VARCHAR" />
    <result column="TOT_BR_CNT" property="totBrCnt" jdbcType="VARCHAR" />
    <result column="TGT_BR_CNT" property="tgtBrCnt" jdbcType="VARCHAR" />
    <result column="CS_ANA_CNT" property="csAnaCnt" jdbcType="VARCHAR" />
    <result column="IM_ACT_CNT" property="imActCnt" jdbcType="VARCHAR" />
    <result column="ANA_STR_DTM" property="anaStrDtm" jdbcType="VARCHAR" />
    <result column="DB_CONN_TRG_ID" property="dbConnTrgId" jdbcType="VARCHAR" />
    <result column="DB_CONN_TRG_LNM" property="dbConnTrgLnm" jdbcType="VARCHAR" />
    <result column="DB_SCH_ID" property="dbSchId" jdbcType="VARCHAR" />
    <result column="DB_SCH_LNM" property="dbSchLnm" jdbcType="VARCHAR" />
    <result column="DEPT_ID" property="deptId" jdbcType="VARCHAR" />
    <result column="DEPT_NM" property="deptNm" jdbcType="VARCHAR" />
    <result column="DEPT_FULL_PATH" property="deptFullPath" jdbcType="VARCHAR" />
    <result column="BIZ_AREA_ID" property="bizAreaId" jdbcType="VARCHAR" />
    <result column="BIZ_AREA_LNM" property="bizAreaLnm" jdbcType="VARCHAR" />
    <result column="BIZ_AREA_FULL_PATH" property="bizAreaFullPath" jdbcType="VARCHAR" />
    <result column="DQI_ID" property="dqiId" jdbcType="VARCHAR" />
    <result column="DQI_LNM" property="dqiLnm" jdbcType="VARCHAR" />
    <result column="DQI_FULL_PATH" property="dqiFullPath" jdbcType="VARCHAR" />
    <result column="CTQ_ID" property="ctqId" jdbcType="VARCHAR" />
    <result column="CTQ_LNM" property="ctqLnm" jdbcType="VARCHAR" />
    <result column="CTQ_FULL_PATH" property="ctqFullPath" jdbcType="VARCHAR" />
    <result column="DBC_TBL_NM" property="dbcTblNm" jdbcType="VARCHAR" />
    <result column="DBC_COL_NM" property="dbcColNm" jdbcType="VARCHAR" />
    <result column="DBC_TBL_KOR_NM" property="dbcTblKorNm" jdbcType="VARCHAR" />
    <result column="DBC_COL_KOR_NM" property="dbcColKorNm" jdbcType="VARCHAR" />
    <result column="BR_NM" property="brNm" jdbcType="VARCHAR" />
    
    <result column="PRF_TOT_CNT_DB" property="prfTotCntDb" jdbcType="VARCHAR" />
    <result column="ANA_TBL_TOT_CNT_DB" property="anaTblTotCntDb" jdbcType="VARCHAR" />
    <result column="ANA_COL_TOT_CNT_DB" property="anaColTotCntDb" jdbcType="VARCHAR" />
    <result column="ANA_CNT_DB" property="anaCntDb" jdbcType="VARCHAR" />
    <result column="ESN_ER_CNT_DB" property="esnErCntDb" jdbcType="VARCHAR" />
    <result column="ESN_ER_RATE_DB" property="esnErRateDb" jdbcType="VARCHAR" />
    <result column="PRF_TOT_CNT_SCH" property="prfTotCntSch" jdbcType="VARCHAR" />
    <result column="ANA_TBL_TOT_CNT_SCH" property="anaTblTotCntSch" jdbcType="VARCHAR" />
    <result column="ANA_COL_TOT_CNT_SCH" property="anaColTotCntSch" jdbcType="VARCHAR" />
    <result column="ANA_CNT_SCH" property="anaCntSch" jdbcType="VARCHAR" />
    <result column="ESN_ER_CNT_SCH" property="esnErCntSch" jdbcType="VARCHAR" />
    <result column="ESN_ER_RATE_SCH" property="esnErRateSch" jdbcType="VARCHAR" />
    <result column="PRF_TOT_CNT_TBL" property="prfTotCntTbl" jdbcType="VARCHAR" />
    <result column="ANA_TBL_TOT_CNT_TBL" property="anaTblTotCntTbl" jdbcType="VARCHAR" />
    <result column="ANA_COL_TOT_CNT_TBL" property="anaColTotCntTbl" jdbcType="VARCHAR" />
    <result column="ANA_CNT_TBL" property="anaCntTbl" jdbcType="VARCHAR" />
    <result column="ESN_ER_CNT_TBL" property="esnErCntTbl" jdbcType="VARCHAR" />
    <result column="ESN_ER_RATE_TBL" property="esnErRateTbl" jdbcType="VARCHAR" />
    <result column="PRF_TOT_CNT_COL" property="prfTotCntCol" jdbcType="VARCHAR" />
    <result column="ANA_TBL_TOT_CNT_COL" property="anaTblTotCntCol" jdbcType="VARCHAR" />
    <result column="ANA_COL_TOT_CNT_COL" property="anaColTotCntCol" jdbcType="VARCHAR" />
    <result column="ANA_CNT_COL" property="anaCntCol" jdbcType="VARCHAR" />
    <result column="ESN_ER_CNT_COL" property="esnErCntCol" jdbcType="VARCHAR" />
    <result column="ESN_ER_RATE_COL" property="esnErRateCol" jdbcType="VARCHAR" />
    
    <result column="PRF_CNT_PT01" property="prfCntPT01" jdbcType="VARCHAR" />
    <result column="PRF_ANA_TGT_CNT_PT01" property="prfAnaTgtCntPT01" jdbcType="VARCHAR" />
    <result column="PRF_ANA_CNT_PT01" property="prfAnaCntPT01" jdbcType="VARCHAR" />
    <result column="ESN_ER_CNT_PT01" property="esnErCntPT01" jdbcType="VARCHAR" />
    <result column="ESN_ER_RATE_PT01" property="esnErRatePT01" jdbcType="VARCHAR" />
    <result column="PRF_CNT_PT02" property="prfCntPT02" jdbcType="VARCHAR" />
    <result column="PRF_ANA_TGT_CNT_PT02" property="prfAnaTgtCntPT02" jdbcType="VARCHAR" />
    <result column="PRF_ANA_CNT_PT02" property="prfAnaCntPT02" jdbcType="VARCHAR" />
    <result column="ESN_ER_CNT_PT02" property="esnErCntPT02" jdbcType="VARCHAR" />
    <result column="ESN_ER_RATE_PT02" property="esnErRatePT02" jdbcType="VARCHAR" />
    <result column="PRF_CNT_PC01" property="prfCntPC01" jdbcType="VARCHAR" />
    <result column="PRF_ANA_TGT_CNT_PC01" property="prfAnaTgtCntPC01" jdbcType="VARCHAR" />
    <result column="PRF_ANA_CNT_PC01" property="prfAnaCntPC01" jdbcType="VARCHAR" />
    <result column="ESN_ER_CNT_PC01" property="esnErCntPC01" jdbcType="VARCHAR" />
    <result column="ESN_ER_RATE_PC01" property="esnErRatePC01" jdbcType="VARCHAR" />
    <result column="PRF_CNT_PC02" property="prfCntPC02" jdbcType="VARCHAR" />
    <result column="PRF_ANA_TGT_CNT_PC02" property="prfAnaTgtCntPC02" jdbcType="VARCHAR" />
    <result column="PRF_ANA_CNT_PC02" property="prfAnaCntPC02" jdbcType="VARCHAR" />
    <result column="ESN_ER_CNT_PC02" property="esnErCntPC02" jdbcType="VARCHAR" />
    <result column="ESN_ER_RATE_PC02" property="esnErRatePC02" jdbcType="VARCHAR" />
    <result column="PRF_CNT_PC03" property="prfCntPC03" jdbcType="VARCHAR" />
    <result column="PRF_ANA_TGT_CNT_PC03" property="prfAnaTgtCntPC03" jdbcType="VARCHAR" />
    <result column="PRF_ANA_CNT_PC03" property="prfAnaCntPC03" jdbcType="VARCHAR" />
    <result column="ESN_ER_CNT_PC03" property="esnErCntPC03" jdbcType="VARCHAR" />
    <result column="ESN_ER_RATE_PC03" property="esnErRatePC03" jdbcType="VARCHAR" />
    <result column="PRF_CNT_PC04" property="prfCntPC04" jdbcType="VARCHAR" />
    <result column="PRF_ANA_TGT_CNT_PC04" property="prfAnaTgtCntPC04" jdbcType="VARCHAR" />
    <result column="PRF_ANA_CNT_PC04" property="prfAnaCntPC04" jdbcType="VARCHAR" />
    <result column="ESN_ER_CNT_PC04" property="esnErCntPC04" jdbcType="VARCHAR" />
    <result column="ESN_ER_RATE_PC04" property="esnErRatePC04" jdbcType="VARCHAR" />
    <result column="PRF_CNT_PC05" property="prfCntPC05" jdbcType="VARCHAR" />
    <result column="PRF_ANA_TGT_CNT_PC05" property="prfAnaTgtCntPC05" jdbcType="VARCHAR" />
    <result column="PRF_ANA_CNT_PC05" property="prfAnaCntPC05" jdbcType="VARCHAR" />
    <result column="ESN_ER_CNT_PC05" property="esnErCntPC05" jdbcType="VARCHAR" />
    <result column="ESN_ER_RATE_PC05" property="esnErRatePC05" jdbcType="VARCHAR" />
    
  </resultMap>
  <sql id="ProgJoin" >
           			FROM WAM_BR_MSTR BM
                     INNER JOIN WAM_BR_RESULT BR
                        ON BM.BR_ID = BR.BR_ID
                     INNER JOIN WAM_BIZ_AREA BIZ
                        ON BM.BIZ_AREA_ID = BIZ.BIZ_AREA_ID
                       AND BIZ.REG_TYP_CD IN ('C', 'U')
                     INNER JOIN WAM_BR_DQI_MAP DQIMAP
                        ON BM.BR_ID = DQIMAP.BR_ID
                       AND DQIMAP.REG_TYP_CD IN ('C', 'U')
                     INNER JOIN WAM_DQI DQI
                        ON DQIMAP.DQI_ID = DQI.DQI_ID
                       AND DQI.REG_TYP_CD IN ('C', 'U')
                     LEFT OUTER JOIN WAM_BR_CTQ_MAP CTQMAP
                        ON BM.BR_ID = CTQMAP.BR_ID
                       AND CTQMAP.REG_TYP_CD IN ('C', 'U')
                     LEFT OUTER JOIN WAM_CTQ CTQ
                       ON CTQMAP.CTQ_ID = CTQ.CTQ_ID
                      AND CTQ.REG_TYP_CD IN ('C', 'U')  
                     LEFT OUTER JOIN WAA_USER U
				        ON BM.BR_CRGP_USER_ID = U.USER_ID
				       AND U.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
				       AND U.REG_TYP_CD IN ('C', 'U')
				      LEFT OUTER JOIN WAA_DEPT D
				        ON U.USER_ID = D.DEPT_ID
				       AND D.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
				       AND D.REG_TYP_CD IN ('C', 'U')
                     LEFT OUTER JOIN ( <include refid="kr.wise.dq.criinfo.anatrg.service.AnaTrgMapper.AnaTrg" /> ) DB
                      ON BM.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
                     AND BM.DBC_TBL_NM = DB.DBC_TBL_NM
                     AND BM.DBC_COL_NM = DB.DBC_COL_NM              
</sql>
  
<sql id="prfKndCdDbConnTrgLnm" >
				FROM WAM_PRF_MSTR M
                   INNER JOIN WAM_PRF_RESULT R
                      ON M.PRF_ID = R.PRF_ID
                     AND R.ANA_DGR IS NOT NULL
           			LEFT OUTER JOIN (SELECT DB_CONN_TRG_ID
                                            , PRF_KND_CD
                                            , COUNT(PRF_ID) PRF_CNT
                                       FROM WAM_PRF_MSTR 
                                      GROUP BY DB_CONN_TRG_ID
                                               , PRF_KND_CD
                                    ) CNT
              ON M.DB_CONN_TRG_ID = CNT.DB_CONN_TRG_ID
             AND M.PRF_KND_CD = CNT.PRF_KND_CD
</sql>
<sql id="prfKndCdDbSchLnm" >
  				FROM WAM_PRF_MSTR M
                   INNER JOIN WAM_PRF_RESULT R
                      ON M.PRF_ID = R.PRF_ID
                     AND R.ANA_DGR IS NOT NULL
                   INNER JOIN WAA_DB_CONN_TRG DB
                      ON M.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
                     AND DB.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
                     AND DB.REG_TYP_CD IN ('C', 'U')
                   INNER JOIN WAA_DB_SCH SCH
                      ON DB.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
                     AND SCH.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
                     AND SCH.REG_TYP_CD IN ('C', 'U')
                    LEFT OUTER JOIN (SELECT SCH.DB_SCH_ID
                                            , PRF_KND_CD
                                            , COUNT(PRF_ID) PRF_CNT
                                       FROM WAM_PRF_MSTR M
                                      INNER JOIN WAA_DB_CONN_TRG DB
                                         ON M.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
                                        AND DB.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
                                        AND DB.REG_TYP_CD IN ('C', 'U')
                                      INNER JOIN WAA_DB_SCH SCH
                                         ON DB.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
                                        AND SCH.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
                                        AND SCH.REG_TYP_CD IN ('C', 'U')
                                      GROUP BY SCH.DB_SCH_ID
                                               , PRF_KND_CD
                                    ) CNT
              ON SCH.DB_SCH_ID = CNT.DB_SCH_ID
             AND M.PRF_KND_CD = CNT.PRF_KND_CD         			
</sql>
<sql id="prfKndCdDbcTblNm" >
           		FROM WAM_PRF_MSTR M
                   INNER JOIN WAM_PRF_RESULT R
                      ON M.PRF_ID = R.PRF_ID
                     AND R.ANA_DGR IS NOT NULL
                   INNER JOIN WAA_DB_CONN_TRG DB
                      ON M.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
                     AND DB.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
                     AND DB.REG_TYP_CD IN ('C', 'U')
                   INNER JOIN WAA_DB_SCH SCH
                      ON DB.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
                     AND SCH.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
                     AND SCH.REG_TYP_CD IN ('C', 'U')
                    LEFT OUTER JOIN (SELECT M.DBC_TBL_NM
                                            , PRF_KND_CD
                                            , COUNT(PRF_ID) PRF_CNT
                                       FROM WAM_PRF_MSTR M
                                      INNER JOIN WAA_DB_CONN_TRG DB
                                         ON M.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
                                        AND DB.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
                                        AND DB.REG_TYP_CD IN ('C', 'U')
                                      INNER JOIN WAA_DB_SCH SCH
                                         ON DB.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
                                        AND SCH.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
                                        AND SCH.REG_TYP_CD IN ('C', 'U')
                                      GROUP BY M.DBC_TBL_NM
                                               , PRF_KND_CD
                                    ) CNT
              ON M.DBC_TBL_NM = CNT.DBC_TBL_NM
             AND M.PRF_KND_CD = CNT.PRF_KND_CD   	
</sql>
  
<select id="selectProfileProgChart" resultMap="BaseResultMap" parameterType="kr.wise.dq.profile.mstr.service.WamPrfMstrCommonVO">
SELECT A.*
<!--       ,TO_CHAR(ROUND(WDQ_FC_DPMO(A.ESN_ER_CNT, A.ANA_CNT ), 2)) AS DPMO  -->
      ,CAST(ROUND(WDQ_FC_SIGMA(WDQ_FC_DPMO(A.ESN_ER_CNT, A.ANA_CNT)), 2) AS CHAR) AS SIGMA  
      ,CASE WHEN A.ANA_CNT = 0 THEN 0
			     ELSE CASE WHEN A.ESN_ER_CNT = 0 THEN 100
			          	  ELSE ROUND(((A.ANA_CNT-A.ESN_ER_CNT)/A.ANA_CNT*100),2)
		END END AS ER_RATE
  FROM (
        SELECT PM.DB_CONN_TRG_ID
        	  ,DB.DB_CONN_TRG_LNM
              ,PR.ANA_DGR
<!--               ,PR.ANA_DGR || ' 차' AS ANA_DGR_DISP-->
			  ,CONCAT(PR.ANA_DGR,' ') AS ANA_DGR_DISP
              ,PM.PRF_KND_CD
              ,MAX(PR.ANA_STR_DTM) AS ANA_STR_DTM
              ,SUM(PR.ANA_CNT) AS ANA_CNT
              ,SUM(PR.ESN_ER_CNT) AS ESN_ER_CNT
              
          FROM WAM_PRF_RESULT PR
         INNER JOIN WAM_PRF_MSTR PM
            ON PR.PRF_ID = PM.PRF_ID
           AND PM.REG_TYP_CD IN ('C', 'U')
         INNER JOIN WAT_DBC_TBL TDB
            ON PM.DB_CONN_TRG_ID = TDB.DB_CONN_TRG_ID
           AND PM.DB_SCH_ID = TDB.DB_SCH_ID
           AND PM.DBC_TBL_NM = TDB.DBC_TBL_NM
         INNER JOIN WAA_DB_CONN_TRG DB
            ON PM.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
           AND DB.REG_TYP_CD IN ('C', 'U')
           AND DB.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
         INNER JOIN WAA_DB_SCH SCH
            ON DB.DB_CONN_TRG_ID = SCH.DB_CONN_TRG_ID
           AND SCH.REG_TYP_CD IN ('C', 'U')
           AND SCH.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
           
         WHERE PR.ANA_DGR IS NOT NULL
         AND PM.PRF_KND_CD != 'PC01'
         <if test="dbConnTrgId != null">
         AND PM.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
         </if>
         <if test="dbSchId != null">
         AND PM.DB_SCH_ID = #{dbSchId,jdbcType=VARCHAR}
         </if>
         <if test="prfKndCd != null">
         AND PM.PRF_KND_CD = #{prfKndCd,jdbcType=VARCHAR}
         </if>
         <if test="dbcTblNm != null">
         AND (PM.DBC_TBL_NM LIKE CONCAT('%' , #{dbcTblNm,jdbcType=VARCHAR} , '%')
         	OR PM.DBC_TBL_NM LIKE CONCAT('%' , UPPER(#{dbcTblNm,jdbcType=VARCHAR}) , '%'))
         </if>
         <if test="dbcColNm != null">
         AND (PM.OBJ_NM LIKE CONCAT('%' , #{dbcColNm,jdbcType=VARCHAR} , '%')
         	OR PM.OBJ_NM LIKE CONCAT('%' , UPPER(#{dbcColNm,jdbcType=VARCHAR}) , '%'))
         </if>
        
         GROUP BY PR.ANA_DGR, PM.PRF_KND_CD, PM.DB_CONN_TRG_ID, DB.DB_CONN_TRG_LNM ) A
         
         ORDER BY PRF_KND_CD, ANA_DGR
  </select>

<select id="selectImPlProgQuality" resultMap="BaseResultMap" parameterType="kr.wise.dq.report.profile.service.ProgChartVO">
  SELECT A.*
<!--       ,TO_CHAR(ROUND(WDQ_FC_DPMO(A.ER_CNT, A.ANA_CNT ), 2)) AS DPMO  -->
      ,CAST(ROUND(WDQ_FC_SIGMA(WDQ_FC_DPMO(A.ER_CNT,A.ANA_CNT)), 2) AS CHAR) AS SIGMA
      ,CASE WHEN A.ANA_CNT = 0 THEN 0
			     ELSE CASE WHEN A.ER_CNT = 0 THEN 100
			          ELSE ROUND(((A.ANA_CNT-A.ER_CNT)/A.ANA_CNT*100),2)
		END END AS ER_RATE
  FROM (
        SELECT 
              <if test='sortTyp == "dbConnTrgLnm"'>
               DB.DB_CONN_TRG_ID    
              ,DB.DB_CONN_TRG_LNM
              </if>
              <if test='sortTyp == "deptNm"'>
               D.DEPT_ID
              ,D.DEPT_NM
              ,D.ALL_DEPT_NM AS DEPT_FULL_PATH
              </if>
              <if test='sortTyp == "bizAreaLnm"'>
               BIZ.BIZ_AREA_ID
              ,BIZ.BIZ_AREA_LNM
              ,BIZ.FULL_PATH AS BIZ_AREA_FULL_PATH
              </if><if test='sortTyp == "dqiLnm"'>
               DQI.DQI_ID    
              ,DQI.DQI_LNM
              ,DQI.FULL_PATH AS DQI_FULL_PATH
              </if>
              <if test='sortTyp == "ctqLnm"'>
               CTQ.CTQ_ID    
              ,CTQ.CTQ_LNM
              ,CTQ.FULL_PATH AS CTQ_FULL_PATH
              </if>
              <if test='sortTyp == "dbcColNm"'>
              DB.DBC_COL_NM
              </if>
              ,BR.ANA_DGR
<!--               ,BR.ANA_DGR || '차' AS ANA_DGR_DISP -->
               ,CONCAT(BR.ANA_DGR , ' ') AS ANA_DGR_DISP
              ,MAX(BR.ANA_STR_DTM) AS ANA_STR_DTM
              ,IFNULL(COUNT(1),0) AS TOT_BR_CNT
              ,IFNULL(M.TGT_BR_CNT, 0) AS TGT_BR_CNT
              ,IFNULL(C.CS_ANA_CNT, 0) AS CS_ANA_CNT
              ,IFNULL(SUM(BR.ANA_CNT),0) AS ANA_CNT
              ,IFNULL(SUM(BR.ER_CNT),0) AS ER_CNT
              
          FROM WAM_BR_MSTR BM
            INNER JOIN WAM_BIZ_AREA BIZ
               ON BM.BIZ_AREA_ID = BIZ.BIZ_AREA_ID
              AND BIZ.REG_TYP_CD IN ('C', 'U')
            INNER JOIN WAM_BR_DQI_MAP DQIMAP
               ON BM.BR_ID = DQIMAP.BR_ID
              AND DQIMAP.REG_TYP_CD IN ('C', 'U')
            INNER JOIN WAM_DQI DQI
               ON DQIMAP.DQI_ID = DQI.DQI_ID
              AND DQI.REG_TYP_CD IN ('C', 'U')
             <if test='sortTyp == "ctqLnm"'>
             INNER JOIN WAM_BR_CTQ_MAP CTQMAP
             </if>
              LEFT OUTER JOIN WAM_BR_RESULT BR
<!--               LEFT OUTER JOIN (<include refid="kr.wise.dq.bizrule.service.WamBrResultMapper.getBrResultMaxAnaStrDtm"/>  ) BR -->
				 ON BM.BR_ID = BR.BR_ID
<!-- 				AND BR.ER_CNT > 0 -->
				AND BR.ANA_DGR IS NOT NULL
             <if test='sortTyp != "ctqLnm"'>
             LEFT OUTER JOIN WAM_BR_CTQ_MAP CTQMAP
             </if>
               ON BM.BR_ID = CTQMAP.BR_ID
              AND CTQMAP.REG_TYP_CD IN ('C', 'U')
             <if test='sortTyp == "ctqLnm"'> 
             INNER JOIN WAM_CTQ CTQ
             </if>
             <if test='sortTyp != "ctqLnm"'> 
             LEFT OUTER JOIN WAM_CTQ CTQ
             </if>
               ON CTQMAP.CTQ_ID = CTQ.CTQ_ID
              AND CTQ.REG_TYP_CD IN ('C', 'U') 
              <if test='sortTyp == "deptNm"'> 
             INNER JOIN WAA_USER U
             </if>
             <if test='sortTyp != "deptNm"'> 
             LEFT OUTER JOIN WAA_USER U
             </if>
               ON BM.BR_CRGP_USER_ID = U.USER_ID
              AND U.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
              AND U.REG_TYP_CD IN ('C', 'U')
              <if test='sortTyp == "deptNm"'>
             INNER JOIN WAA_DEPT D
             </if>
             <if test='sortTyp != "deptNm"'>
             LEFT OUTER JOIN WAA_DEPT D
             </if>
               ON U.USER_ID = D.DEPT_ID
              AND D.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
              AND D.REG_TYP_CD IN ('C', 'U')
             LEFT OUTER JOIN ( <include refid="kr.wise.dq.criinfo.anatrg.service.AnaTrgMapper.AnaTrg" /> ) DB
               ON BM.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
              AND BM.DBC_TBL_NM = DB.DBC_TBL_NM
              AND BM.DBC_COL_NM = DB.DBC_COL_NM
             LEFT OUTER JOIN ( SELECT BR.ANA_DGR
                                    <if test='sortTyp == "dbConnTrgLnm"'>
						               ,DB.DB_CONN_TRG_ID    
						              </if>
						              <if test='sortTyp == "deptNm"'>
						               ,D.DEPT_ID
						              </if>
						              <if test='sortTyp == "bizAreaLnm"'>
						               ,BIZ.BIZ_AREA_ID
						              </if><if test='sortTyp == "dqiLnm"'>
						               ,DQI.DQI_ID    
						              </if>
						              <if test='sortTyp == "ctqLnm"'>
						               ,CTQ.CTQ_ID    
						              </if>
						              <if test='sortTyp == "dbcColNm"'>
						               ,DB.DBC_COL_NM    
						              </if>
                                    ,COUNT(1) AS TGT_BR_CNT
                                <include refid="ProgJoin" />
                                  WHERE BR.ANA_DGR IS NOT NULL
                        <![CDATA[ AND BR.ER_CNT > 0 ]]>
                                  GROUP BY BR.ANA_DGR
									<if test='sortTyp == "dbConnTrgLnm"'>
						               ,DB.DB_CONN_TRG_ID    
						              </if>
						              <if test='sortTyp == "deptNm"'>
						               ,D.DEPT_ID
						              </if>
						              <if test='sortTyp == "bizAreaLnm"'>
						               ,BIZ.BIZ_AREA_ID
						              </if><if test='sortTyp == "dqiLnm"'>
						               ,DQI.DQI_ID    
						              </if>
						              <if test='sortTyp == "ctqLnm"'>
						               ,CTQ.CTQ_ID    
						              </if>
						              <if test='sortTyp == "dbcColNm"'>
						               ,DB.DBC_COL_NM    
						              </if>
                                  ) M
               ON BR.ANA_DGR = M.ANA_DGR
              <if test='sortTyp == "dbConnTrgLnm"'>
               AND BM.DB_CONN_TRG_ID = M.DB_CONN_TRG_ID   
              </if>
              <if test='sortTyp == "deptNm"'>
               AND D.DEPT_ID = M.DEPT_ID
              </if>
              <if test='sortTyp == "bizAreaLnm"'>
               AND BM.BIZ_AREA_ID = M.BIZ_AREA_ID
              </if><if test='sortTyp == "dqiLnm"'>
               AND DQI.DQI_ID = M.DQI_ID 
              </if>
              <if test='sortTyp == "ctqLnm"'>
               AND CTQ.CTQ_ID = M.CTQ_ID
              </if>
              <if test='sortTyp == "dbcColNm"'>
               AND DB.DBC_COL_NM = M.DBC_COL_NM
              </if>
              
             LEFT OUTER JOIN ( SELECT BR.ANA_DGR
                                     <if test='sortTyp == "dbConnTrgLnm"'>
						               ,DB.DB_CONN_TRG_ID    
						              </if>
						              <if test='sortTyp == "deptNm"'>
						               ,D.DEPT_ID
						              </if>
						              <if test='sortTyp == "bizAreaLnm"'>
						               ,BIZ.BIZ_AREA_ID
						              </if><if test='sortTyp == "dqiLnm"'>
						               ,DQI.DQI_ID    
						              </if>
						              <if test='sortTyp == "ctqLnm"'>
						               ,CTQ.CTQ_ID    
						              </if>
						              <if test='sortTyp == "dbcColNm"'>
						               ,DB.DBC_COL_NM    
						              </if>
                                     ,COUNT(1) AS CS_ANA_CNT
                                 FROM WAM_BR_MSTR BM
			                              INNER JOIN (<include refid="kr.wise.dq.bizrule.service.WamBrResultMapper.getBrResultMaxAnaStrDtm"/>  ) BR
										    ON BM.BR_ID = BR.BR_ID
										   AND BR.ER_CNT > 0
										   AND BR.ANA_DGR IS NOT NULL
			                     INNER JOIN WAM_CS_ANA_MSTR CM
			                     	ON BR.BR_ID = CM.ANA_JOB_ID
			                       AND BR.ANA_STR_DTM = CM.ANA_STR_DTM
			                     INNER JOIN WAM_BIZ_AREA BIZ
			                        ON BM.BIZ_AREA_ID = BIZ.BIZ_AREA_ID
			                       AND BIZ.REG_TYP_CD IN ('C', 'U')
			                     INNER JOIN WAM_BR_DQI_MAP DQIMAP
			                        ON BM.BR_ID = DQIMAP.BR_ID
			                       AND DQIMAP.REG_TYP_CD IN ('C', 'U')
			                     INNER JOIN WAM_DQI DQI
			                        ON DQIMAP.DQI_ID = DQI.DQI_ID
			                       AND DQI.REG_TYP_CD IN ('C', 'U')
			                     LEFT OUTER JOIN WAM_BR_CTQ_MAP CTQMAP
			                        ON BM.BR_ID = CTQMAP.BR_ID
			                       AND CTQMAP.REG_TYP_CD IN ('C', 'U')
			                     LEFT OUTER JOIN WAM_CTQ CTQ
			                       ON CTQMAP.CTQ_ID = CTQ.CTQ_ID
			                      AND CTQ.REG_TYP_CD IN ('C', 'U')  
			                     LEFT OUTER JOIN WAA_USER U
							        ON BM.BR_CRGP_USER_ID = U.USER_ID
							       AND U.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
							       AND U.REG_TYP_CD IN ('C', 'U')
							      LEFT OUTER JOIN WAA_DEPT D
							        ON U.USER_ID = D.DEPT_ID
							       AND D.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
							       AND D.REG_TYP_CD IN ('C', 'U')
			                     LEFT OUTER JOIN ( <include refid="kr.wise.dq.criinfo.anatrg.service.AnaTrgMapper.AnaTrg" /> ) DB
			                      ON BM.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
			                     AND BM.DBC_TBL_NM = DB.DBC_TBL_NM
			                     AND BM.DBC_COL_NM = DB.DBC_COL_NM    
                                    WHERE BR.ANA_DGR IS NOT NULL
                          <![CDATA[ AND BR.ER_CNT > 0 ]]>
                                    GROUP BY BR.ANA_DGR
									  <if test='sortTyp == "dbConnTrgLnm"'>
						               ,DB.DB_CONN_TRG_ID    
						              </if>
						              <if test='sortTyp == "deptNm"'>
						               ,D.DEPT_ID
						              </if>
						              <if test='sortTyp == "bizAreaLnm"'>
						               ,BIZ.BIZ_AREA_ID
						              </if><if test='sortTyp == "dqiLnm"'>
						               ,DQI.DQI_ID    
						              </if>
						              <if test='sortTyp == "ctqLnm"'>
						               ,CTQ.CTQ_ID    
						              </if>
						              <if test='sortTyp == "dbcColNm"'>
						               ,DB.DBC_COL_NM    
						              </if>
                                ) C
               ON BR.ANA_DGR = C.ANA_DGR
              <if test='sortTyp == "dbConnTrgLnm"'>
               AND BM.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID   
              </if>
              <if test='sortTyp == "deptNm"'>
               AND D.DEPT_ID = C.DEPT_ID
              </if>
              <if test='sortTyp == "bizAreaLnm"'>
               AND BM.BIZ_AREA_ID = C.BIZ_AREA_ID
              </if><if test='sortTyp == "dqiLnm"'>
               AND DQI.DQI_ID = C.DQI_ID 
              </if>
              <if test='sortTyp == "ctqLnm"'>
               AND CTQ.CTQ_ID = C.CTQ_ID
              </if>
              <if test='sortTyp == "dbcColNm"'>
               AND DB.DBC_COL_NM = C.DBC_COL_NM
              </if>
              
            WHERE BR.ANA_CNT IS NOT NULL
              AND BR.ANA_DGR IS NOT NULL
              <if test="dbConnTrgId != null">
              AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
              </if>
              <if test="dbcTblNm != null">
              AND (DB.DBC_TBL_NM LIKE CONCAT('%' , #{dbcTblNm,jdbcType=VARCHAR} , '%') OR DB.DBC_TBL_KOR_NM LIKE CONCAT('%' , #{dbcTblNm,jdbcType=VARCHAR} , '%')
		      	OR DB.DBC_TBL_NM LIKE CONCAT('%' , UPPER(#{dbcTblNm,jdbcType=VARCHAR}) , '%') OR DB.DBC_TBL_KOR_NM LIKE CONCAT('%' , UPPER(#{dbcTblNm,jdbcType=VARCHAR}) , '%'))
              </if>
              <if test="dbcColNm != null">
              AND (DB.DBC_COL_NM LIKE CONCAT('%' , #{dbcColNm,jdbcType=VARCHAR} , '%') OR DB.DBC_COL_KOR_NM LIKE CONCAT('%' , #{dbcColNm,jdbcType=VARCHAR} , '%')
		      	OR DB.DBC_COL_NM LIKE CONCAT('%' , UPPER(#{dbcColNm,jdbcType=VARCHAR}) , '%') OR DB.DBC_COL_KOR_NM LIKE CONCAT('%' , UPPER(#{dbcColNm,jdbcType=VARCHAR}) , '%'))
              </if>
              <if test="bizAreaLnm != null">
              AND BIZ.FULL_PATH LIKE CONCAT('%' , #{bizAreaLnm,jdbcType=VARCHAR} , '%')
              </if>
              <if test="dqiLnm != null">
		      AND DQI.FULL_PATH LIKE CONCAT('%' , #{dqiLnm,jdbcType=VARCHAR} , '%')
		      </if>
		      <if test="ctqLnm != null">
		      AND CTQ.FULL_PATH LIKE CONCAT('%' , #{ctqLnm,jdbcType=VARCHAR} , '%')
		      </if>
              <if test="anaJobNm != null">
              AND BM.BR_NM LIKE CONCAT('%' , #{anaJobNm,jdbcType=VARCHAR} , '%')
              </if>
              <if test="anaDgr != null">
              AND BR.ANA_DGR = #{anaDgr,jdbcType=VARCHAR}
              </if>
            
            GROUP BY <if test='sortTyp == "dbConnTrgLnm"'>
               DB.DB_CONN_TRG_ID    
              ,DB.DB_CONN_TRG_LNM,
              </if>
              <if test='sortTyp == "deptNm"'>
               D.DEPT_ID
              ,D.DEPT_NM
              ,D.ALL_DEPT_NM,
              </if>
              <if test='sortTyp == "bizAreaLnm"'>
               BIZ.BIZ_AREA_ID
              ,BIZ.BIZ_AREA_LNM
              ,BIZ.FULL_PATH,
              </if><if test='sortTyp == "dqiLnm"'>
               DQI.DQI_ID    
              ,DQI.DQI_LNM
              ,DQI.FULL_PATH,
              </if>
              <if test='sortTyp == "ctqLnm"'>
               CTQ.CTQ_ID    
              ,CTQ.CTQ_LNM
              ,CTQ.FULL_PATH,
              </if>
              <if test='sortTyp == "dbcColNm"'>
               DB.DBC_COL_NM,
              </if>
            
            BR.ANA_DGR, M.TGT_BR_CNT, C.CS_ANA_CNT ) A 
            
            ORDER BY DB_CONN_TRG_ID IS NULL
					<if test='sortTyp == "dbConnTrgLnm"'>
	               ,DB_CONN_TRG_ID    
	              </if>
	              <if test='sortTyp == "deptNm"'>
	               ,DEPT_ID
	              </if>
	              <if test='sortTyp == "bizAreaLnm"'>
	               ,BIZ_AREA_ID
	              </if><if test='sortTyp == "dqiLnm"'>
	               ,DQI_ID    
	              </if>
	              <if test='sortTyp == "ctqLnm"'>
	               ,CTQ_ID    
	              </if>
	              <if test='sortTyp == "dbcColNm"'>
	               ,DBC_COL_NM    
	              </if>
, ANA_DGR

</select>
<select id="selectImRslProgQuality" resultMap="BaseResultMap" parameterType="kr.wise.dq.report.profile.service.ProgChartVO">
  SELECT A.*
<!--       ,TO_CHAR(ROUND(WDQ_FC_DPMO(A.ER_CNT, A.ANA_CNT ), 2)) AS DPMO  -->
      ,CAST(ROUND(WDQ_FC_SIGMA(WDQ_FC_DPMO(A.ER_CNT,A.ANA_CNT)), 2) AS CHAR) AS SIGMA 
      ,CASE WHEN A.ANA_CNT = 0 THEN 0
			     ELSE CASE WHEN A.ER_CNT = 0 THEN 100
			         				ELSE ROUND(((A.ANA_CNT-A.ER_CNT)/A.ANA_CNT*100),2)
	  END END AS ER_RATE
  FROM (
        SELECT 
              <if test='sortTyp == "dbConnTrgLnm"'>
               DB.DB_CONN_TRG_ID    
              ,DB.DB_CONN_TRG_LNM
              </if>
              <if test='sortTyp == "deptNm"'>
               D.DEPT_ID
              ,D.DEPT_NM
              ,D.ALL_DEPT_NM AS DEPT_FULL_PATH
              </if>
              <if test='sortTyp == "bizAreaLnm"'>
               BIZ.BIZ_AREA_ID
              ,BIZ.BIZ_AREA_LNM
              ,BIZ.FULL_PATH AS BIZ_AREA_FULL_PATH
              </if><if test='sortTyp == "dqiLnm"'>
               DQI.DQI_ID    
              ,DQI.DQI_LNM
              ,DQI.FULL_PATH AS DQI_FULL_PATH
              </if>
              <if test='sortTyp == "ctqLnm"'>
               CTQ.CTQ_ID    
              ,CTQ.CTQ_LNM
              ,CTQ.FULL_PATH AS CTQ_FULL_PATH
              </if>
              <if test='sortTyp == "dbcColNm"'>
              DB.DBC_COL_NM
              </if>
              ,BR.ANA_DGR
<!--               ,BR.ANA_DGR || '차' AS ANA_DGR_DISP -->
               ,CONCAT(BR.ANA_DGR , ' ') AS ANA_DGR_DISP
              ,MAX(BR.ANA_STR_DTM) AS ANA_STR_DTM
              ,IFNULL(M.TGT_BR_CNT, 0) AS TGT_BR_CNT
              ,IFNULL(C.CS_ANA_CNT, 0) AS CS_ANA_CNT
              ,IFNULL(I.IM_ACT_CNT, 0) AS IM_ACT_CNT
              ,IFNULL(SUM(BR.ANA_CNT),0) AS ANA_CNT
              ,IFNULL(SUM(BR.ER_CNT),0) AS ER_CNT
              
          FROM WAM_BR_MSTR BM
            INNER JOIN WAM_BR_RESULT BR
               ON BM.BR_ID = BR.BR_ID
            INNER JOIN WAM_BIZ_AREA BIZ
               ON BM.BIZ_AREA_ID = BIZ.BIZ_AREA_ID
              AND BIZ.REG_TYP_CD IN ('C', 'U')
            INNER JOIN WAM_BR_DQI_MAP DQIMAP
               ON BM.BR_ID = DQIMAP.BR_ID
              AND DQIMAP.REG_TYP_CD IN ('C', 'U')
            INNER JOIN WAM_DQI DQI
               ON DQIMAP.DQI_ID = DQI.DQI_ID
              AND DQI.REG_TYP_CD IN ('C', 'U')
             <if test='sortTyp == "ctqLnm"'>
             INNER JOIN WAM_BR_CTQ_MAP CTQMAP
             </if>
             <if test='sortTyp != "ctqLnm"'>
             LEFT OUTER JOIN WAM_BR_CTQ_MAP CTQMAP
             </if>
               ON BM.BR_ID = CTQMAP.BR_ID
              AND CTQMAP.REG_TYP_CD IN ('C', 'U')
             <if test='sortTyp == "ctqLnm"'> 
             INNER JOIN WAM_CTQ CTQ
             </if>
             <if test='sortTyp != "ctqLnm"'> 
             LEFT OUTER JOIN WAM_CTQ CTQ
             </if>
               ON CTQMAP.CTQ_ID = CTQ.CTQ_ID
              AND CTQ.REG_TYP_CD IN ('C', 'U') 
              <if test='sortTyp == "deptNm"'> 
             INNER JOIN WAA_USER U
             </if>
             <if test='sortTyp != "deptNm"'> 
             LEFT OUTER JOIN WAA_USER U
             </if>
               ON BM.BR_CRGP_USER_ID = U.USER_ID
              AND U.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
              AND U.REG_TYP_CD IN ('C', 'U')
              <if test='sortTyp == "deptNm"'>
             INNER JOIN WAA_DEPT D
             </if>
             <if test='sortTyp != "deptNm"'>
             LEFT OUTER JOIN WAA_DEPT D
             </if>
               ON U.USER_ID = D.DEPT_ID
              AND D.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
              AND D.REG_TYP_CD IN ('C', 'U')
             LEFT OUTER JOIN ( <include refid="kr.wise.dq.criinfo.anatrg.service.AnaTrgMapper.AnaTrg" /> ) DB
               ON BM.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
              AND BM.DBC_TBL_NM = DB.DBC_TBL_NM
              AND BM.DBC_COL_NM = DB.DBC_COL_NM
             LEFT OUTER JOIN ( SELECT BR.ANA_DGR
                                    <if test='sortTyp == "dbConnTrgLnm"'>
						               ,DB.DB_CONN_TRG_ID    
						              </if>
						              <if test='sortTyp == "deptNm"'>
						               ,D.DEPT_ID
						              </if>
						              <if test='sortTyp == "bizAreaLnm"'>
						               ,BIZ.BIZ_AREA_ID
						              </if><if test='sortTyp == "dqiLnm"'>
						               ,DQI.DQI_ID    
						              </if>
						              <if test='sortTyp == "ctqLnm"'>
						               ,CTQ.CTQ_ID    
						              </if>
						              <if test='sortTyp == "dbcColNm"'>
						               ,DB.DBC_COL_NM    
						              </if>
                                    ,COUNT(1) AS TGT_BR_CNT
                                <include refid="ProgJoin" />
                                  WHERE BR.ANA_DGR IS NOT NULL
                        <![CDATA[ AND BR.ER_CNT > 0 ]]>
                                  GROUP BY BR.ANA_DGR
									<if test='sortTyp == "dbConnTrgLnm"'>
						               ,DB.DB_CONN_TRG_ID    
						              </if>
						              <if test='sortTyp == "deptNm"'>
						               ,D.DEPT_ID
						              </if>
						              <if test='sortTyp == "bizAreaLnm"'>
						               ,BIZ.BIZ_AREA_ID
						              </if><if test='sortTyp == "dqiLnm"'>
						               ,DQI.DQI_ID    
						              </if>
						              <if test='sortTyp == "ctqLnm"'>
						               ,CTQ.CTQ_ID    
						              </if>
						              <if test='sortTyp == "dbcColNm"'>
						               ,DB.DBC_COL_NM    
						              </if>
                                  ) M
               ON BR.ANA_DGR = M.ANA_DGR
              <if test='sortTyp == "dbConnTrgLnm"'>
               AND BM.DB_CONN_TRG_ID = M.DB_CONN_TRG_ID   
              </if>
              <if test='sortTyp == "deptNm"'>
               AND D.DEPT_ID = M.DEPT_ID
              </if>
              <if test='sortTyp == "bizAreaLnm"'>
               AND BM.BIZ_AREA_ID = M.BIZ_AREA_ID
              </if><if test='sortTyp == "dqiLnm"'>
               AND DQI.DQI_ID = M.DQI_ID 
              </if>
              <if test='sortTyp == "ctqLnm"'>
               AND CTQ.CTQ_ID = M.CTQ_ID
              </if>
              <if test='sortTyp == "dbcColNm"'>
               AND DB.DBC_COL_NM = M.DBC_COL_NM
              </if>
              
             LEFT OUTER JOIN ( SELECT BR.ANA_DGR
                                     <if test='sortTyp == "dbConnTrgLnm"'>
						               ,DB.DB_CONN_TRG_ID    
						              </if>
						              <if test='sortTyp == "deptNm"'>
						               ,D.DEPT_ID
						              </if>
						              <if test='sortTyp == "bizAreaLnm"'>
						               ,BIZ.BIZ_AREA_ID
						              </if><if test='sortTyp == "dqiLnm"'>
						               ,DQI.DQI_ID    
						              </if>
						              <if test='sortTyp == "ctqLnm"'>
						               ,CTQ.CTQ_ID    
						              </if>
						              <if test='sortTyp == "dbcColNm"'>
						               ,DB.DBC_COL_NM    
						              </if>
                                     ,COUNT(1) AS CS_ANA_CNT
                                 FROM WAM_BR_MSTR BM
			                   	INNER JOIN (<include refid="kr.wise.dq.bizrule.service.WamBrResultMapper.getBrResultMaxAnaStrDtm"/>  ) BR
									ON BM.BR_ID = BR.BR_ID
								   AND BR.ER_CNT > 0
								   AND BR.ANA_DGR IS NOT NULL
			                     INNER JOIN WAM_CS_ANA_MSTR CM
			                     	ON BR.BR_ID = CM.ANA_JOB_ID
			                       AND BR.ANA_STR_DTM = CM.ANA_STR_DTM
			                     INNER JOIN WAM_BIZ_AREA BIZ
			                        ON BM.BIZ_AREA_ID = BIZ.BIZ_AREA_ID
			                       AND BIZ.REG_TYP_CD IN ('C', 'U')
			                     INNER JOIN WAM_BR_DQI_MAP DQIMAP
			                        ON BM.BR_ID = DQIMAP.BR_ID
			                       AND DQIMAP.REG_TYP_CD IN ('C', 'U')
			                     INNER JOIN WAM_DQI DQI
			                        ON DQIMAP.DQI_ID = DQI.DQI_ID
			                       AND DQI.REG_TYP_CD IN ('C', 'U')
			                     LEFT OUTER JOIN WAM_BR_CTQ_MAP CTQMAP
			                        ON BM.BR_ID = CTQMAP.BR_ID
			                       AND CTQMAP.REG_TYP_CD IN ('C', 'U')
			                     LEFT OUTER JOIN WAM_CTQ CTQ
			                       ON CTQMAP.CTQ_ID = CTQ.CTQ_ID
			                      AND CTQ.REG_TYP_CD IN ('C', 'U')  
			                     LEFT OUTER JOIN WAA_USER U
							        ON BM.BR_CRGP_USER_ID = U.USER_ID
							       AND U.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
							       AND U.REG_TYP_CD IN ('C', 'U')
							      LEFT OUTER JOIN WAA_DEPT D
							        ON U.USER_ID = D.DEPT_ID
							       AND D.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
							       AND D.REG_TYP_CD IN ('C', 'U')
			                     LEFT OUTER JOIN ( <include refid="kr.wise.dq.criinfo.anatrg.service.AnaTrgMapper.AnaTrg" /> ) DB
			                      ON BM.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
			                     AND BM.DBC_TBL_NM = DB.DBC_TBL_NM
			                     AND BM.DBC_COL_NM = DB.DBC_COL_NM    
                                    WHERE BR.ANA_DGR IS NOT NULL
                          <![CDATA[ AND BR.ER_CNT > 0 ]]>
                                    GROUP BY BR.ANA_DGR
									  <if test='sortTyp == "dbConnTrgLnm"'>
						               ,DB.DB_CONN_TRG_ID    
						              </if>
						              <if test='sortTyp == "deptNm"'>
						               ,D.DEPT_ID
						              </if>
						              <if test='sortTyp == "bizAreaLnm"'>
						               ,BIZ.BIZ_AREA_ID
						              </if><if test='sortTyp == "dqiLnm"'>
						               ,DQI.DQI_ID    
						              </if>
						              <if test='sortTyp == "ctqLnm"'>
						               ,CTQ.CTQ_ID    
						              </if>
						              <if test='sortTyp == "dbcColNm"'>
						               ,DB.DBC_COL_NM    
						              </if>
                                ) C
               ON BR.ANA_DGR = C.ANA_DGR
              <if test='sortTyp == "dbConnTrgLnm"'>
               AND BM.DB_CONN_TRG_ID = C.DB_CONN_TRG_ID   
              </if>
              <if test='sortTyp == "deptNm"'>
               AND D.DEPT_ID = C.DEPT_ID
              </if>
              <if test='sortTyp == "bizAreaLnm"'>
               AND BM.BIZ_AREA_ID = C.BIZ_AREA_ID
              </if><if test='sortTyp == "dqiLnm"'>
               AND DQI.DQI_ID = C.DQI_ID 
              </if>
              <if test='sortTyp == "ctqLnm"'>
               AND CTQ.CTQ_ID = C.CTQ_ID
              </if>
              <if test='sortTyp == "dbcColNm"'>
               AND DB.DBC_COL_NM = M.DBC_COL_NM
              </if>
            
            LEFT OUTER JOIN ( SELECT BR.ANA_DGR
                                     <if test='sortTyp == "dbConnTrgLnm"'>
						               ,DB.DB_CONN_TRG_ID    
						              </if>
						              <if test='sortTyp == "deptNm"'>
						               ,D.DEPT_ID
						              </if>
						              <if test='sortTyp == "bizAreaLnm"'>
						               ,BIZ.BIZ_AREA_ID
						              </if><if test='sortTyp == "dqiLnm"'>
						               ,DQI.DQI_ID    
						              </if>
						              <if test='sortTyp == "ctqLnm"'>
						               ,CTQ.CTQ_ID    
						              </if>
						              <if test='sortTyp == "dbcColNm"'>
						               ,DB.DBC_COL_NM    
						              </if>
                                     ,COUNT(1) AS IM_ACT_CNT
                                 FROM WAM_BR_MSTR BM
			                     INNER JOIN (<include refid="kr.wise.dq.bizrule.service.WamBrResultMapper.getBrResultMaxAnaStrDtm"/>  ) BR
									ON BM.BR_ID = BR.BR_ID
								   AND BR.ER_CNT > 0
								   AND BR.ANA_DGR IS NOT NULL
			                     INNER JOIN WAM_CS_ANA_MSTR CM
			                     	ON BR.BR_ID = CM.ANA_JOB_ID
			                      AND BR.ANA_STR_DTM = CM.ANA_STR_DTM
			                     INNER JOIN WAM_IM_ACT_MSTR IM
			                     	ON CM.ANA_JOB_ID = IM.ANA_JOB_ID
			                       AND CM.ANA_STR_DTM = IM.ANA_STR_DTM
			                       AND CM.ANA_KND_CD = IM.ANA_KND_CD
			                     INNER JOIN WAM_BIZ_AREA BIZ
			                        ON BM.BIZ_AREA_ID = BIZ.BIZ_AREA_ID
			                       AND BIZ.REG_TYP_CD IN ('C', 'U')
			                     INNER JOIN WAM_BR_DQI_MAP DQIMAP
			                        ON BM.BR_ID = DQIMAP.BR_ID
			                       AND DQIMAP.REG_TYP_CD IN ('C', 'U')
			                     INNER JOIN WAM_DQI DQI
			                        ON DQIMAP.DQI_ID = DQI.DQI_ID
			                       AND DQI.REG_TYP_CD IN ('C', 'U')
			                     LEFT OUTER JOIN WAM_BR_CTQ_MAP CTQMAP
			                        ON BM.BR_ID = CTQMAP.BR_ID
			                       AND CTQMAP.REG_TYP_CD IN ('C', 'U')
			                     LEFT OUTER JOIN WAM_CTQ CTQ
			                       ON CTQMAP.CTQ_ID = CTQ.CTQ_ID
			                      AND CTQ.REG_TYP_CD IN ('C', 'U')  
			                     LEFT OUTER JOIN WAA_USER U
							        ON BM.BR_CRGP_USER_ID = U.USER_ID
							       AND U.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
							       AND U.REG_TYP_CD IN ('C', 'U')
							      LEFT OUTER JOIN WAA_DEPT D
							        ON U.USER_ID = D.DEPT_ID
							       AND D.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
							       AND D.REG_TYP_CD IN ('C', 'U')
			                     LEFT OUTER JOIN ( <include refid="kr.wise.dq.criinfo.anatrg.service.AnaTrgMapper.AnaTrg" /> ) DB
			                      ON BM.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
			                     AND BM.DBC_TBL_NM = DB.DBC_TBL_NM
			                     AND BM.DBC_COL_NM = DB.DBC_COL_NM    
                                    WHERE BR.ANA_DGR IS NOT NULL
                          <![CDATA[ AND BR.ER_CNT > 0 ]]>
                                    GROUP BY BR.ANA_DGR
									  <if test='sortTyp == "dbConnTrgLnm"'>
						               ,DB.DB_CONN_TRG_ID    
						              </if>
						              <if test='sortTyp == "deptNm"'>
						               ,D.DEPT_ID
						              </if>
						              <if test='sortTyp == "bizAreaLnm"'>
						               ,BIZ.BIZ_AREA_ID
						              </if><if test='sortTyp == "dqiLnm"'>
						               ,DQI.DQI_ID    
						              </if>
						              <if test='sortTyp == "ctqLnm"'>
						               ,CTQ.CTQ_ID    
						              </if>
						              <if test='sortTyp == "dbcColNm"'>
						               ,DB.DBC_COL_NM    
						              </if>
                                ) I
               ON BR.ANA_DGR = I.ANA_DGR
              <if test='sortTyp == "dbConnTrgLnm"'>
               AND BM.DB_CONN_TRG_ID = I.DB_CONN_TRG_ID   
              </if>
              <if test='sortTyp == "deptNm"'>
               AND D.DEPT_ID = I.DEPT_ID
              </if>
              <if test='sortTyp == "bizAreaLnm"'>
               AND BM.BIZ_AREA_ID = I.BIZ_AREA_ID
              </if><if test='sortTyp == "dqiLnm"'>
               AND DQI.DQI_ID = I.DQI_ID 
              </if>
              <if test='sortTyp == "ctqLnm"'>
               AND CTQ.CTQ_ID = I.CTQ_ID
              </if>
              <if test='sortTyp == "dbcColNm"'>
               AND DB.DBC_COL_NM = M.DBC_COL_NM
              </if>
             
              
            WHERE BR.ANA_CNT IS NOT NULL
              AND BR.ANA_DGR IS NOT NULL
              <![CDATA[ AND TGT_BR_CNT > 0 ]]>
              <if test="dbConnTrgId != null">
              AND DB.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
              </if>
              <if test="dbcTblNm != null">
              AND (DB.DBC_TBL_NM LIKE CONCAT('%' , #{dbcTblNm,jdbcType=VARCHAR} , '%') OR DB.DBC_TBL_KOR_NM LIKE CONCAT('%' , #{dbcTblNm,jdbcType=VARCHAR} , '%')
		      	OR DB.DBC_TBL_NM LIKE CONCAT('%' , UPPER(#{dbcTblNm,jdbcType=VARCHAR}) , '%') OR DB.DBC_TBL_KOR_NM LIKE CONCAT('%' , UPPER(#{dbcTblNm,jdbcType=VARCHAR}) , '%'))
              </if>
              <if test="dbcColNm != null">
              AND (DB.DBC_COL_NM LIKE CONCAT('%' , #{dbcColNm,jdbcType=VARCHAR} , '%') OR DB.DBC_COL_KOR_NM LIKE CONCAT('%' , #{dbcColNm,jdbcType=VARCHAR} , '%')
		      	OR DB.DBC_COL_NM LIKE CONCAT('%' , UPPER(#{dbcColNm,jdbcType=VARCHAR}) , '%') OR DB.DBC_COL_KOR_NM LIKE CONCAT('%' , UPPER(#{dbcColNm,jdbcType=VARCHAR}) , '%'))
              </if>
              <if test="bizAreaLnm != null">
              AND BIZ.FULL_PATH LIKE CONCAT('%' , #{bizAreaLnm,jdbcType=VARCHAR} , '%')
              </if>
              <if test="dqiLnm != null">
		      AND DQI.FULL_PATH LIKE CONCAT('%' , #{dqiLnm,jdbcType=VARCHAR} , '%')
		      </if>
		      <if test="ctqLnm != null">
		      AND CTQ.FULL_PATH LIKE CONCAT('%' , #{ctqLnm,jdbcType=VARCHAR} , '%')
		      </if>
              <if test="anaJobNm != null">
              AND BM.BR_NM LIKE CONCAT('%' , #{anaJobNm,jdbcType=VARCHAR} , '%')
              </if>
              <if test="anaDgr != null">
              AND BR.ANA_DGR = #{anaDgr,jdbcType=VARCHAR}
              </if>
            
            GROUP BY <if test='sortTyp == "dbConnTrgLnm"'>
               DB.DB_CONN_TRG_ID    
              ,DB.DB_CONN_TRG_LNM,
              </if>
              <if test='sortTyp == "deptNm"'>
               D.DEPT_ID
              ,D.DEPT_NM
              ,D.ALL_DEPT_NM,
              </if>
              <if test='sortTyp == "bizAreaLnm"'>
               BIZ.BIZ_AREA_ID
              ,BIZ.BIZ_AREA_LNM
              ,BIZ.FULL_PATH,
              </if><if test='sortTyp == "dqiLnm"'>
               DQI.DQI_ID    
              ,DQI.DQI_LNM
              ,DQI.FULL_PATH,
              </if>
              <if test='sortTyp == "ctqLnm"'>
               CTQ.CTQ_ID    
              ,CTQ.CTQ_LNM
              ,CTQ.FULL_PATH,
              </if>
              <if test='sortTyp == "dbcColNm"'>
               DB.DBC_COL_NM,
              </if>
            
            BR.ANA_DGR, M.TGT_BR_CNT, C.CS_ANA_CNT, I.IM_ACT_CNT ) A 
            
            ORDER BY DB_CONN_TRG_ID IS NULL
					<if test='sortTyp == "dbConnTrgLnm"'>
	               ,DB_CONN_TRG_ID    
	              </if>
	              <if test='sortTyp == "deptNm"'>
	               ,DEPT_ID
	              </if>
	              <if test='sortTyp == "bizAreaLnm"'>
	               ,BIZ_AREA_ID
	              </if><if test='sortTyp == "dqiLnm"'>
	               ,DQI_ID    
	              </if>
	              <if test='sortTyp == "ctqLnm"'>
	               ,CTQ_ID    
	              </if>
	              <if test='sortTyp == "dbcColNm"'>
	               ,DBC_COL_NM    
	              </if>
, ANA_DGR

</select>
<select id="selectProfileQuality" resultMap="BaseResultMap" parameterType="kr.wise.dq.report.profile.service.ProgChartVO">
  SELECT A.*
<!--   	  ,A.ANA_DGR || '차' AS ANA_DGR_DISP-->
   	  ,CONCAT(A.ANA_DGR , ' ') AS ANA_DGR_DISP
  	  <if test='sortTyp == "dbConnTrgLnm"'>
  	  ,DB.DB_CONN_TRG_LNM
  	  </if>
      <if test='sortTyp == "dbSchLnm"'>
      ,DB.DB_CONN_TRG_LNM
  	  ,SCH.DB_SCH_LNM
  	  </if>
  	  <if test='sortTyp == "dbcTblNm"'>
  	  ,DB.DB_CONN_TRG_LNM
  	  ,SCH.DB_SCH_LNM
  	  ,A.DBC_TBL_NM
  	  </if>
  	  <if test='sortTyp == "dbcColNm"'>
  	  ,DB.DB_CONN_TRG_LNM
  	  ,SCH.DB_SCH_LNM
  	  ,A.DBC_TBL_NM
  	  ,A.DBC_COL_NM
  	  </if>
      
      ,CASE WHEN A.PRF_ANA_CNT_PT01 = 0 THEN 0 ELSE CASE WHEN A.ESN_ER_CNT_PT01 = 0 THEN 100 ELSE ROUND(((A.PRF_ANA_CNT_PT01-A.ESN_ER_CNT_PT01)/A.PRF_ANA_CNT_PT01*100),2) END END AS ESN_ER_RATE_PT01
      ,CASE WHEN A.PRF_ANA_CNT_PT02 = 0 THEN 0 ELSE CASE WHEN A.ESN_ER_CNT_PT02 = 0 THEN 100 ELSE ROUND(((A.PRF_ANA_CNT_PT02-A.ESN_ER_CNT_PT02)/A.PRF_ANA_CNT_PT02*100),2) END END AS ESN_ER_RATE_PT02
      ,CASE WHEN A.PRF_ANA_CNT_PC01 = 0 THEN 0 ELSE CASE WHEN A.ESN_ER_CNT_PC01 = 0 THEN 100 ELSE ROUND(((A.PRF_ANA_CNT_PC01-A.ESN_ER_CNT_PC01)/A.PRF_ANA_CNT_PC01*100),2) END END AS ESN_ER_RATE_PC01
	  ,CASE WHEN A.PRF_ANA_CNT_PC02 = 0 THEN 0 ELSE CASE WHEN A.ESN_ER_CNT_PC02 = 0 THEN 100 ELSE ROUND(((A.PRF_ANA_CNT_PC02-A.ESN_ER_CNT_PC02)/A.PRF_ANA_CNT_PC02*100),2) END END AS ESN_ER_RATE_PC02
	  ,CASE WHEN A.PRF_ANA_CNT_PC03 = 0 THEN 0 ELSE CASE WHEN A.ESN_ER_CNT_PC03 = 0 THEN 100 ELSE ROUND(((A.PRF_ANA_CNT_PC03-A.ESN_ER_CNT_PC03)/A.PRF_ANA_CNT_PC03*100),2) END END AS ESN_ER_RATE_PC03
	  ,CASE WHEN A.PRF_ANA_CNT_PC04 = 0 THEN 0 ELSE CASE WHEN A.ESN_ER_CNT_PC04 = 0 THEN 100 ELSE ROUND(((A.PRF_ANA_CNT_PC04-A.ESN_ER_CNT_PC04)/A.PRF_ANA_CNT_PC04*100),2) END END AS ESN_ER_RATE_PC04
	  ,CASE WHEN A.PRF_ANA_CNT_PC05 = 0 THEN 0 ELSE CASE WHEN A.ESN_ER_CNT_PC05 = 0 THEN 100 ELSE ROUND(((A.PRF_ANA_CNT_PC05-A.ESN_ER_CNT_PC05)/A.PRF_ANA_CNT_PC05*100),2) END END AS ESN_ER_RATE_PC05

      
      <if test='sortTyp == "dbConnTrgLnm"'>
  	  ,TOT.PRF_TOT_CNT_DB
      ,TOT.ANA_TBL_TOT_CNT_DB
      ,TOT.ANA_COL_TOT_CNT_DB
      ,TOT.ANA_CNT_DB
      ,TOT.ESN_ER_CNT_DB
      ,TOT.ESN_ER_RATE_DB
  	  </if>
      <if test='sortTyp == "dbSchLnm"'>
  	  ,TOT.PRF_TOT_CNT_SCH
      ,TOT.ANA_TBL_TOT_CNT_SCH
      ,TOT.ANA_COL_TOT_CNT_SCH
      ,TOT.ANA_CNT_SCH
      ,TOT.ESN_ER_CNT_SCH
      ,TOT.ESN_ER_RATE_SCH
  	  </if>
  	  <if test='sortTyp == "dbcTblNm"'>
  	  ,TOT.PRF_TOT_CNT_TBL
      ,TOT.ANA_TBL_TOT_CNT_TBL
      ,TOT.ANA_COL_TOT_CNT_TBL
      ,TOT.ANA_CNT_TBL
      ,TOT.ESN_ER_CNT_TBL
      ,TOT.ESN_ER_RATE_TBL
  	  </if>
  	  <if test='sortTyp == "dbcColNm"'>
  	  ,TOT.PRF_TOT_CNT_COL
      ,TOT.ANA_TBL_TOT_CNT_COL
      ,TOT.ANA_COL_TOT_CNT_COL
      ,TOT.ANA_CNT_COL
      ,TOT.ESN_ER_CNT_COL
      ,TOT.ESN_ER_RATE_COL
  	  </if>
  	  
  FROM (
            SELECT 
              <if test='sortTyp == "dbConnTrgLnm"'>
		  	  A.DB_CONN_TRG_ID
		  	  </if>
		      <if test='sortTyp == "dbSchLnm"'>
		  	  A.DB_CONN_TRG_ID,
		  	  A.DB_SCH_ID
		  	  </if>
		  	  <if test='sortTyp == "dbcTblNm"'>
		  	  A.DB_CONN_TRG_ID,
		  	  A.DB_SCH_ID,
		  	  A.DBC_TBL_NM
		  	  </if>
		  	  <if test='sortTyp == "dbcColNm"'>
		  	  A.DB_CONN_TRG_ID,
		  	  A.DB_SCH_ID,
		  	  A.DBC_TBL_NM,
		  	  A.DBC_COL_NM
		  	  </if>
                   , A.ANA_DGR
                   
                   ,SUM(A.PRF_CNT_PT01) AS PRF_CNT_PT01 -- 저장건수
                   ,MAX(PRF_ANA_TGT_CNT_PT01) AS PRF_ANA_TGT_CNT_PT01 -- 분석건수
                   ,MAX(PRF_ANA_CNT_PT01) AS PRF_ANA_CNT_PT01 -- 데이터분석건수
                   ,MAX(ESN_ER_CNT_PT01) ESN_ER_CNT_PT01 -- 추정오류건수
                   
                   ,SUM(A.PRF_CNT_PT02) AS PRF_CNT_PT02 -- 저장건수
                   ,MAX(PRF_ANA_TGT_CNT_PT02) AS PRF_ANA_TGT_CNT_PT02 -- 분석건수
                   ,MAX(PRF_ANA_CNT_PT02) AS PRF_ANA_CNT_PT02 -- 데이터분석건수
                   ,MAX(ESN_ER_CNT_PT02) ESN_ER_CNT_PT02 -- 추정오류건수
                   
                   ,SUM(A.PRF_CNT_PC01) AS PRF_CNT_PC01 -- 저장건수
                   ,MAX(PRF_ANA_TGT_CNT_PC01) AS PRF_ANA_TGT_CNT_PC01 -- 분석건수
                   ,MAX(PRF_ANA_CNT_PC01) AS PRF_ANA_CNT_PC01 -- 데이터분석건수
                   ,MAX(ESN_ER_CNT_PC01) ESN_ER_CNT_PC01 -- 추정오류건수
                   
                   ,SUM(A.PRF_CNT_PC02) AS PRF_CNT_PC02 -- 저장건수
                   ,MAX(PRF_ANA_TGT_CNT_PC02) AS PRF_ANA_TGT_CNT_PC02 -- 분석건수
                   ,MAX(PRF_ANA_CNT_PC02) AS PRF_ANA_CNT_PC02 -- 데이터분석건수
                   ,MAX(ESN_ER_CNT_PC02) ESN_ER_CNT_PC02 -- 추정오류건수
                   
                   ,SUM(A.PRF_CNT_PC03) AS PRF_CNT_PC03 -- 저장건수
                   ,MAX(PRF_ANA_TGT_CNT_PC03) AS PRF_ANA_TGT_CNT_PC03 -- 분석건수
                   ,MAX(PRF_ANA_CNT_PC03) AS PRF_ANA_CNT_PC03 -- 데이터분석건수
                   ,MAX(ESN_ER_CNT_PC03) ESN_ER_CNT_PC03 -- 추정오류건수
                   
                   ,SUM(A.PRF_CNT_PC04) AS PRF_CNT_PC04 -- 저장건수
                   ,MAX(PRF_ANA_TGT_CNT_PC04) AS PRF_ANA_TGT_CNT_PC04 -- 분석건수
                   ,MAX(PRF_ANA_CNT_PC04) AS PRF_ANA_CNT_PC04 -- 데이터분석건수
                   ,MAX(ESN_ER_CNT_PC04) ESN_ER_CNT_PC04 -- 추정오류건수
                   
                   ,SUM(A.PRF_CNT_PC05) AS PRF_CNT_PC05 -- 저장건수
                   ,MAX(PRF_ANA_TGT_CNT_PC05) AS PRF_ANA_TGT_CNT_PC05 -- 분석건수
                   ,MAX(PRF_ANA_CNT_PC05) AS PRF_ANA_CNT_PC05 -- 데이터분석건수
                   ,MAX(ESN_ER_CNT_PC05) ESN_ER_CNT_PC05 -- 추정오류건수
                   
                   
                   
              FROM (
              
              SELECT
                     <if test='sortTyp == "dbConnTrgLnm"'>
				  	  M.DB_CONN_TRG_ID
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM,
				  	  M.OBJ_NM AS DBC_COL_NM
				  	  </if>
                   , M.PRF_KND_CD
                   , R.ANA_DGR
                   -- PT01
                   , MAX(CNT.PRF_CNT) AS PRF_CNT_PT01  
                   , COUNT(R.PRF_ID) AS PRF_ANA_TGT_CNT_PT01       
                   , SUM(R.ANA_CNT) AS PRF_ANA_CNT_PT01
                   , SUM(R.ESN_ER_CNT) AS ESN_ER_CNT_PT01
                   -- PT02
                   , NULL AS PRF_CNT_PT02
                   , NULL AS PRF_ANA_TGT_CNT_PT02
                   , NULL AS PRF_ANA_CNT_PT02
                   , NULL AS ESN_ER_CNT_PT02
                   -- PC01
                   , NULL AS PRF_CNT_PC01
                   , NULL AS PRF_ANA_TGT_CNT_PC01
                   , NULL AS PRF_ANA_CNT_PC01
                   , NULL AS ESN_ER_CNT_PC01
                   -- PC02
                   , NULL AS PRF_CNT_PC02
                   , NULL AS PRF_ANA_TGT_CNT_PC02
                   , NULL AS PRF_ANA_CNT_PC02
                   , NULL AS ESN_ER_CNT_PC02
                   -- PC03
                   , NULL AS PRF_CNT_PC03
                   , NULL AS PRF_ANA_TGT_CNT_PC03
                   , NULL AS PRF_ANA_CNT_PC03
                   , NULL AS ESN_ER_CNT_PC03
                   -- PC04
                   , NULL AS PRF_CNT_PC04
                   , NULL AS PRF_ANA_TGT_CNT_PC04
                   , NULL AS PRF_ANA_CNT_PC04
                   , NULL AS ESN_ER_CNT_PC04
                   -- PC05
                   , NULL AS PRF_CNT_PC05
                   , NULL AS PRF_ANA_TGT_CNT_PC05
                   , NULL AS PRF_ANA_CNT_PC05
                   , NULL AS ESN_ER_CNT_PC05
              
                     <if test='sortTyp == "dbConnTrgLnm"'>
				  	 
                    	<include refid="prfKndCdDbConnTrgLnm" />
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  	<include refid="prfKndCdDbSchLnm" />
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  	<include refid="prfKndCdDbcTblNm" />
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  	<include refid="prfKndCdDbcTblNm" />
				  	  </if>
              
             WHERE 1 = 1
               AND M.PRF_KND_CD = 'PT01'
             GROUP BY 
             		<if test='sortTyp == "dbConnTrgLnm"'>
				  	  M.DB_CONN_TRG_ID
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM,
				  	  M.OBJ_NM
				  	  </if>
                     , M.PRF_KND_CD
                     , R.ANA_DGR

            UNION ALL

            SELECT
                    <if test='sortTyp == "dbConnTrgLnm"'>
				  	  M.DB_CONN_TRG_ID
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM,
				  	  M.OBJ_NM AS DBC_COL_NM
				  	  </if>
                   , M.PRF_KND_CD
                   , R.ANA_DGR
                   -- PT01
                   , NULL AS PRF_CNT_PT01  
                   , NULL AS PRF_ANA_TGT_CNT_PT01       
                   , NULL AS PRF_ANA_CNT_PT01
                   , NULL AS ESN_ER_CNT_PT01
                   -- PT02
                   , MAX(CNT.PRF_CNT) AS PRF_CNT_PT02
                   , COUNT(R.PRF_ID) AS PRF_ANA_TGT_CNT_PT02
                   , SUM(R.ANA_CNT) AS PRF_ANA_CNT_PT02
                   , SUM(R.ESN_ER_CNT) AS ESN_ER_CNT_PT02
                   -- PC01
                   , NULL AS PRF_CNT_PC01
                   , NULL AS PRF_ANA_TGT_CNT_PC01
                   , NULL AS PRF_ANA_CNT_PC01
                   , NULL AS ESN_ER_CNT_PC01
                   -- PC02
                   , NULL AS PRF_CNT_PC02
                   , NULL AS PRF_ANA_TGT_CNT_PC02
                   , NULL AS PRF_ANA_CNT_PC02
                   , NULL AS ESN_ER_CNT_PC02
                   -- PC03
                   , NULL AS PRF_CNT_PC03
                   , NULL AS PRF_ANA_TGT_CNT_PC03
                   , NULL AS PRF_ANA_CNT_PC03
                   , NULL AS ESN_ER_CNT_PC03
                   -- PC04
                   , NULL AS PRF_CNT_PC04
                   , NULL AS PRF_ANA_TGT_CNT_PC04
                   , NULL AS PRF_ANA_CNT_PC04
                   , NULL AS ESN_ER_CNT_PC04
                   -- PC05
                   , NULL AS PRF_CNT_PC05
                   , NULL AS PRF_ANA_TGT_CNT_PC05
                   , NULL AS PRF_ANA_CNT_PC05
                   , NULL AS ESN_ER_CNT_PC05
             		  <if test='sortTyp == "dbConnTrgLnm"'>
				  	 
                    	<include refid="prfKndCdDbConnTrgLnm" />
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  	<include refid="prfKndCdDbSchLnm" />
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  	<include refid="prfKndCdDbcTblNm" />
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  	<include refid="prfKndCdDbcTblNm" />
				  	  </if>
				  	  
             WHERE 1 = 1
               AND M.PRF_KND_CD = 'PT02'
             GROUP BY <if test='sortTyp == "dbConnTrgLnm"'>
				  	  M.DB_CONN_TRG_ID
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM,
				  	  M.OBJ_NM
				  	  </if>
                     , M.PRF_KND_CD
                     , R.ANA_DGR

            UNION ALL

            SELECT
                    <if test='sortTyp == "dbConnTrgLnm"'>
				  	  M.DB_CONN_TRG_ID
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM,
				  	  M.OBJ_NM AS DBC_COL_NM
				  	  </if>
                   , M.PRF_KND_CD
                   , R.ANA_DGR
                   -- PT01
                   , NULL AS PRF_CNT_PT01
                   , NULL AS PRF_ANA_TGT_CNT_PT01
                   , NULL AS PRF_ANA_CNT_PT01
                   , NULL AS ESN_ER_CNT_PT01
                   -- PT02
                   , NULL AS PRF_CNT_PT02
                   , NULL AS PRF_ANA_TGT_CNT_PT02
                   , NULL AS PRF_ANA_CNT_PT02
                   , NULL AS ESN_ER_CNT_PT02
                   -- PC01
                   , MAX(CNT.PRF_CNT) AS PRF_CNT_PC01  
                   , COUNT(R.PRF_ID) AS PRF_ANA_TGT_CNT_PC01       
                   , SUM(R.ANA_CNT) AS PRF_ANA_CNT_PC01
                   , SUM(R.ESN_ER_CNT) AS ESN_ER_CNT_PC01
                   -- PC02
                   , NULL AS PRF_CNT_PC02
                   , NULL AS PRF_ANA_TGT_CNT_PC02
                   , NULL AS PRF_ANA_CNT_PC02
                   , NULL AS ESN_ER_CNT_PC02
                   -- PC03
                   , NULL AS PRF_CNT_PC03
                   , NULL AS PRF_ANA_TGT_CNT_PC03
                   , NULL AS PRF_ANA_CNT_PC03
                   , NULL AS ESN_ER_CNT_PC03
                   -- PC04
                   , NULL AS PRF_CNT_PC04
                   , NULL AS PRF_ANA_TGT_CNT_PC04
                   , NULL AS PRF_ANA_CNT_PC04
                   , NULL AS ESN_ER_CNT_PC04
                   -- PC05
                   , NULL AS PRF_CNT_PC05
                   , NULL AS PRF_ANA_TGT_CNT_PC05
                   , NULL AS PRF_ANA_CNT_PC05
                   , NULL AS ESN_ER_CNT_PC05
              			<if test='sortTyp == "dbConnTrgLnm"'>
				  	 
                    	<include refid="prfKndCdDbConnTrgLnm" />
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  	<include refid="prfKndCdDbSchLnm" />
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  	<include refid="prfKndCdDbcTblNm" />
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  	<include refid="prfKndCdDbcTblNm" />
				  	  </if>
             WHERE 1 = 1
               AND M.PRF_KND_CD = 'PC01'
             GROUP BY <if test='sortTyp == "dbConnTrgLnm"'>
				  	  M.DB_CONN_TRG_ID
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM,
				  	  M.OBJ_NM
				  	  </if>
                     , M.PRF_KND_CD
                     , R.ANA_DGR

            UNION ALL

            SELECT
                     <if test='sortTyp == "dbConnTrgLnm"'>
				  	  M.DB_CONN_TRG_ID
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM,
				  	  M.OBJ_NM AS DBC_COL_NM
				  	  </if>
                   , M.PRF_KND_CD
                   , R.ANA_DGR
                   -- PT01
                   , NULL AS PRF_CNT_PT01
                   , NULL AS PRF_ANA_TGT_CNT_PT01
                   , NULL AS PRF_ANA_CNT_PT01
                   , NULL AS ESN_ER_CNT_PT01
                   -- PT02
                   , NULL AS PRF_CNT_PT02
                   , NULL AS PRF_ANA_TGT_CNT_PT02
                   , NULL AS PRF_ANA_CNT_PT02
                   , NULL AS ESN_ER_CNT_PT02
                   -- PC01
                   , NULL AS PRF_CNT_PC01
                   , NULL AS PRF_ANA_TGT_CNT_PC01
                   , NULL AS PRF_ANA_CNT_PC01
                   , NULL AS ESN_ER_CNT_PC01
                   -- PC02
                   , MAX(CNT.PRF_CNT) AS PRF_CNT_PC02
                   , COUNT(R.PRF_ID) AS PRF_ANA_TGT_CNT_PC02
                   , SUM(R.ANA_CNT) AS PRF_ANA_CNT_PC02
                   , SUM(R.ESN_ER_CNT) AS ESN_ER_CNT_PC02
                   -- PC03
                   , NULL AS PRF_CNT_PC03
                   , NULL AS PRF_ANA_TGT_CNT_PC03
                   , NULL AS PRF_ANA_CNT_PC03
                   , NULL AS ESN_ER_CNT_PC03
                   -- PC04
                   , NULL AS PRF_CNT_PC04
                   , NULL AS PRF_ANA_TGT_CNT_PC04
                   , NULL AS PRF_ANA_CNT_PC04
                   , NULL AS ESN_ER_CNT_PC04
                   -- PC05
                   , NULL AS PRF_CNT_PC05
                   , NULL AS PRF_ANA_TGT_CNT_PC05
                   , NULL AS PRF_ANA_CNT_PC05
                   , NULL AS ESN_ER_CNT_PC05
              		<if test='sortTyp == "dbConnTrgLnm"'>
				  	 
                    	<include refid="prfKndCdDbConnTrgLnm" />
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  	<include refid="prfKndCdDbSchLnm" />
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  	<include refid="prfKndCdDbcTblNm" />
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  	<include refid="prfKndCdDbcTblNm" />
				  	  </if>
             WHERE 1 = 1
               AND M.PRF_KND_CD = 'PC02'
             GROUP BY <if test='sortTyp == "dbConnTrgLnm"'>
				  	  M.DB_CONN_TRG_ID
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM,
				  	  M.OBJ_NM
				  	  </if>
                     , M.PRF_KND_CD
                     , R.ANA_DGR

            UNION ALL

            SELECT
                     <if test='sortTyp == "dbConnTrgLnm"'>
				  	  M.DB_CONN_TRG_ID
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM,
				  	  M.OBJ_NM AS DBC_COL_NM
				  	  </if>
                   , M.PRF_KND_CD
                   , R.ANA_DGR
                   -- PT01
                   , NULL AS PRF_CNT_PT01
                   , NULL AS PRF_ANA_TGT_CNT_PT01
                   , NULL AS PRF_ANA_CNT_PT01
                   , NULL AS ESN_ER_CNT_PT01
                   -- PT02
                   , NULL AS PRF_CNT_PT02
                   , NULL AS PRF_ANA_TGT_CNT_PT02
                   , NULL AS PRF_ANA_CNT_PT02
                   , NULL AS ESN_ER_CNT_PT02
                   -- PC01
                   , NULL AS PRF_CNT_PC01
                   , NULL AS PRF_ANA_TGT_CNT_PC01
                   , NULL AS PRF_ANA_CNT_PC01
                   , NULL AS ESN_ER_CNT_PC01
                   -- PC02
                   , NULL AS PRF_CNT_PC02
                   , NULL AS PRF_ANA_TGT_CNT_PC02
                   , NULL AS PRF_ANA_CNT_PC02
                   , NULL AS ESN_ER_CNT_PC02
                   -- PC03
                   , MAX(CNT.PRF_CNT) AS PRF_CNT_PC03
                   , COUNT(R.PRF_ID) AS PRF_ANA_TGT_CNT_PC03
                   , SUM(R.ANA_CNT) AS PRF_ANA_CNT_PC03
                   , SUM(R.ESN_ER_CNT) AS ESN_ER_CNT_PC03
                   -- PC04
                   , NULL AS PRF_CNT_PC04
                   , NULL AS PRF_ANA_TGT_CNT_PC04
                   , NULL AS PRF_ANA_CNT_PC04
                   , NULL AS ESN_ER_CNT_PC04
                   -- PC05
                   , NULL AS PRF_CNT_PC05
                   , NULL AS PRF_ANA_TGT_CNT_PC05
                   , NULL AS PRF_ANA_CNT_PC05
                   , NULL AS ESN_ER_CNT_PC05
              		<if test='sortTyp == "dbConnTrgLnm"'>
				  	 
                    	<include refid="prfKndCdDbConnTrgLnm" />
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  	<include refid="prfKndCdDbSchLnm" />
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  	<include refid="prfKndCdDbcTblNm" />
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  	<include refid="prfKndCdDbcTblNm" />
				  	  </if>
             WHERE 1 = 1
               AND M.PRF_KND_CD = 'PC03'
             GROUP BY <if test='sortTyp == "dbConnTrgLnm"'>
				  	  M.DB_CONN_TRG_ID
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM,
				  	  M.OBJ_NM
				  	  </if>
                     , M.PRF_KND_CD
                     , R.ANA_DGR

            UNION ALL

            SELECT
                     <if test='sortTyp == "dbConnTrgLnm"'>
				  	  M.DB_CONN_TRG_ID
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM,
				  	  M.OBJ_NM AS DBC_COL_NM
				  	  </if>
                   , M.PRF_KND_CD
                   , R.ANA_DGR
                   -- PT01
                   , NULL AS PRF_CNT_PT01
                   , NULL AS PRF_ANA_TGT_CNT_PT01
                   , NULL AS PRF_ANA_CNT_PT01
                   , NULL AS ESN_ER_CNT_PT01
                   -- PT02
                   , NULL AS PRF_CNT_PT02
                   , NULL AS PRF_ANA_TGT_CNT_PT02
                   , NULL AS PRF_ANA_CNT_PT02
                   , NULL AS ESN_ER_CNT_PT02
                   -- PC01
                   , NULL AS PRF_CNT_PC01
                   , NULL AS PRF_ANA_TGT_CNT_PC01
                   , NULL AS PRF_ANA_CNT_PC01
                   , NULL AS ESN_ER_CNT_PC01
                   -- PC02
                   , NULL AS PRF_CNT_PC02
                   , NULL AS PRF_ANA_TGT_CNT_PC02
                   , NULL AS PRF_ANA_CNT_PC02
                   , NULL AS ESN_ER_CNT_PC02
                   -- PC03
                   , NULL AS PRF_CNT_PC03
                   , NULL AS PRF_ANA_TGT_CNT_PC03
                   , NULL AS PRF_ANA_CNT_PC03
                   , NULL AS ESN_ER_CNT_PC03
                   -- PC04
                   , MAX(CNT.PRF_CNT) AS PRF_CNT_PC04
                   , COUNT(R.PRF_ID) AS PRF_ANA_TGT_CNT_PC04
                   , SUM(R.ANA_CNT) AS PRF_ANA_CNT_PC04
                   , SUM(R.ESN_ER_CNT) AS ESN_ER_CNT_PC04
                   -- PC05
                   , NULL AS PRF_CNT_PC05
                   , NULL AS PRF_ANA_TGT_CNT_PC05
                   , NULL AS PRF_ANA_CNT_PC05
                   , NULL AS ESN_ER_CNT_PC05
         		     <if test='sortTyp == "dbConnTrgLnm"'>
				  	 
                    	<include refid="prfKndCdDbConnTrgLnm" />
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  	<include refid="prfKndCdDbSchLnm" />
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  	<include refid="prfKndCdDbcTblNm" />
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  	<include refid="prfKndCdDbcTblNm" />
				  	  </if>
             WHERE 1 = 1
               AND M.PRF_KND_CD = 'PC04'
             GROUP BY  <if test='sortTyp == "dbConnTrgLnm"'>
				  	  M.DB_CONN_TRG_ID
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM,
				  	  M.OBJ_NM
				  	  </if>
                     , M.PRF_KND_CD
                     , R.ANA_DGR

            UNION ALL

            SELECT
                     <if test='sortTyp == "dbConnTrgLnm"'>
				  	  M.DB_CONN_TRG_ID
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM,
				  	  M.OBJ_NM AS DBC_COL_NM
				  	  </if>
                   , M.PRF_KND_CD
                   , R.ANA_DGR
                   -- PT01
                   , NULL AS PRF_CNT_PT01
                   , NULL AS PRF_ANA_TGT_CNT_PT01
                   , NULL AS PRF_ANA_CNT_PT01
                   , NULL AS ESN_ER_CNT_PT01
                   -- PT02
                   , NULL AS PRF_CNT_PT02
                   , NULL AS PRF_ANA_TGT_CNT_PT02
                   , NULL AS PRF_ANA_CNT_PT02
                   , NULL AS ESN_ER_CNT_PT02
                   -- PC01
                   , NULL AS PRF_CNT_PC01
                   , NULL AS PRF_ANA_TGT_CNT_PC01
                   , NULL AS PRF_ANA_CNT_PC01
                   , NULL AS ESN_ER_CNT_PC01
                   -- PC02
                   , NULL AS PRF_CNT_PC02
                   , NULL AS PRF_ANA_TGT_CNT_PC02
                   , NULL AS PRF_ANA_CNT_PC02
                   , NULL AS ESN_ER_CNT_PC02
                   -- PC03
                   , NULL AS PRF_CNT_PC03
                   , NULL AS PRF_ANA_TGT_CNT_PC03
                   , NULL AS PRF_ANA_CNT_PC03
                   , NULL AS ESN_ER_CNT_PC03
                   -- PC04
                   , NULL AS PRF_CNT_PC04
                   , NULL AS PRF_ANA_TGT_CNT_PC04
                   , NULL AS PRF_ANA_CNT_PC04
                   , NULL AS ESN_ER_CNT_PC04
                   -- PC05
                   , MAX(CNT.PRF_CNT) AS PRF_CNT_PC05
                   , COUNT(R.PRF_ID) AS PRF_ANA_TGT_CNT_PC05
                   , SUM(R.ANA_CNT) AS PRF_ANA_CNT_PC05
                   , SUM(R.ESN_ER_CNT) AS ESN_ER_CNT_PC05
            		  <if test='sortTyp == "dbConnTrgLnm"'>
				  	 
                    	<include refid="prfKndCdDbConnTrgLnm" />
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  	<include refid="prfKndCdDbSchLnm" />
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  	<include refid="prfKndCdDbcTblNm" />
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  	<include refid="prfKndCdDbcTblNm" />
				  	  </if>
             WHERE 1 = 1
               AND M.PRF_KND_CD = 'PC05'
             GROUP BY <if test='sortTyp == "dbConnTrgLnm"'>
				  	  M.DB_CONN_TRG_ID
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  M.DB_CONN_TRG_ID,
				  	  SCH.DB_SCH_ID,
				  	  M.DBC_TBL_NM,
				  	  M.OBJ_NM
				  	  </if>
                     , M.PRF_KND_CD
                     , R.ANA_DGR


            ) A 
           
            
            GROUP BY <if test='sortTyp == "dbConnTrgLnm"'>
				  	  A.DB_CONN_TRG_ID
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  A.DB_CONN_TRG_ID,
				  	  A.DB_SCH_ID
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  A.DB_CONN_TRG_ID,
				  	  A.DB_SCH_ID,
				  	  A.DBC_TBL_NM
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  A.DB_CONN_TRG_ID,
				  	  A.DB_SCH_ID,
				  	  A.DBC_TBL_NM,
				  	  A.DBC_COL_NM
				  	  </if>, A.ANA_DGR
            ORDER BY <if test='sortTyp == "dbConnTrgLnm"'>
				  	  A.DB_CONN_TRG_ID
				  	  </if>
				      <if test='sortTyp == "dbSchLnm"'>
				  	  A.DB_CONN_TRG_ID,
				  	  A.DB_SCH_ID
				  	  </if>
				  	  <if test='sortTyp == "dbcTblNm"'>
				  	  A.DB_CONN_TRG_ID,
				  	  A.DB_SCH_ID,
				  	  A.DBC_TBL_NM
				  	  </if>
				  	  <if test='sortTyp == "dbcColNm"'>
				  	  A.DB_CONN_TRG_ID,
				  	  A.DB_SCH_ID,
				  	  A.DBC_TBL_NM,
				  	  A.DBC_COL_NM
				  	  </if>, A.ANA_DGR ) A
            
            LEFT OUTER JOIN ( SELECT A.*
            						<if test='sortTyp == "dbConnTrgLnm"'>
								  	  ,CAST(ROUND(A.ESN_ER_CNT_DB*100/CASE WHEN A.ANA_CNT_DB = 0 THEN 1 ELSE A.ANA_CNT_DB END ,2) AS CHAR) AS ESN_ER_RATE_DB
								  	  </if>
								      <if test='sortTyp == "dbSchLnm"'>
								  	  ,CAST(ROUND(A.ESN_ER_CNT_SCH*100/CASE WHEN A.ANA_CNT_SCH = 0 THEN 1 ELSE A.ANA_CNT_SCH END ,2) AS CHAR) AS ESN_ER_RATE_SCH
								  	  </if>
								  	  <if test='sortTyp == "dbcTblNm"'>
								  	  ,CAST(ROUND(A.ESN_ER_CNT_TBL*100/CASE WHEN A.ANA_CNT_TBL = 0 THEN 1 ELSE A.ANA_CNT_TBL END ,2) AS CHAR) AS ESN_ER_RATE_TBL
								  	  </if>
								  	  <if test='sortTyp == "dbcColNm"'>
								  	  ,CAST(ROUND(A.ESN_ER_CNT_COL*100/CASE WHEN A.ANA_CNT_COL = 0 THEN 1 ELSE A.ANA_CNT_COL END ,2) AS CHAR) AS ESN_ER_RATE_COL
								  	  </if>
                              
                          FROM (
                                SELECT <if test='sortTyp == "dbConnTrgLnm"'>
								  	  DB.DB_CONN_TRG_ID
								  	  </if>
								      <if test='sortTyp == "dbSchLnm"'>
								      DB.DB_CONN_TRG_ID
								  	  ,DB.DB_SCH_ID
								  	  </if>
								  	  <if test='sortTyp == "dbcTblNm"'>
								  	  DB.DB_CONN_TRG_ID
								  	  ,DB.DB_SCH_ID
								  	  ,DB.DBC_TBL_NM
								  	  </if>
								  	  <if test='sortTyp == "dbcColNm"'>
								  	  DB.DB_CONN_TRG_ID
								  	  ,DB.DB_SCH_ID
								  	  ,DB.DBC_TBL_NM
								  	  ,PM.OBJ_NM AS DBC_COL_NM
								  	  </if>
                                      ,PR.ANA_DGR
                                      <if test='sortTyp == "dbConnTrgLnm"'>
								  	  ,COUNT(PM.PRF_ID) AS PRF_TOT_CNT_DB
                                      ,COUNT(DISTINCT PM.DBC_TBL_NM) AS ANA_TBL_TOT_CNT_DB
                                      ,COUNT(DISTINCT PM.OBJ_NM) AS ANA_COL_TOT_CNT_DB
                                      ,SUM(PR.ANA_CNT) AS ANA_CNT_DB
                                      ,SUM(PR.ESN_ER_CNT) AS ESN_ER_CNT_DB
								  	  </if>
								      <if test='sortTyp == "dbSchLnm"'>
								  	  ,COUNT(PM.PRF_ID) AS PRF_TOT_CNT_SCH
                                      ,COUNT(DISTINCT PM.DBC_TBL_NM) AS ANA_TBL_TOT_CNT_SCH
                                      ,COUNT(DISTINCT PM.OBJ_NM) AS ANA_COL_TOT_CNT_SCH
                                      ,SUM(PR.ANA_CNT) AS ANA_CNT_SCH
                                      ,SUM(PR.ESN_ER_CNT) AS ESN_ER_CNT_SCH
								  	  </if>
								  	  <if test='sortTyp == "dbcTblNm"'>
								  	  ,COUNT(PM.PRF_ID) AS PRF_TOT_CNT_TBL
                                      ,COUNT(DISTINCT PM.DBC_TBL_NM) AS ANA_TBL_TOT_CNT_TBL
                                      ,COUNT(DISTINCT PM.OBJ_NM) AS ANA_COL_TOT_CNT_TBL
                                      ,SUM(PR.ANA_CNT) AS ANA_CNT_TBL
                                      ,SUM(PR.ESN_ER_CNT) AS ESN_ER_CNT_TBL
								  	  </if>
								  	  <if test='sortTyp == "dbcColNm"'>
								  	  ,COUNT(PM.PRF_ID) AS PRF_TOT_CNT_COL
                                      ,COUNT(DISTINCT PM.DBC_TBL_NM) AS ANA_TBL_TOT_CNT_COL
                                      ,COUNT(DISTINCT PM.OBJ_NM) AS ANA_COL_TOT_CNT_COL
                                      ,SUM(PR.ANA_CNT) AS ANA_CNT_COL
                                      ,SUM(PR.ESN_ER_CNT) AS ESN_ER_CNT_COL
								  	  </if>
                                  FROM WAM_PRF_MSTR PM
                                  
                                    INNER JOIN WAM_PRF_RESULT PR
                                       ON PM.PRF_ID = PR.PRF_ID
                                       
                                    LEFT OUTER JOIN (SELECT DB.DB_CONN_TRG_PNM
                                                           ,DB.DB_CONN_TRG_LNM
                                                           ,DB.DB_CONN_TRG_ID
                                                           ,S.DB_SCH_PNM
                                                           ,S.DB_SCH_LNM
                                                           ,S.DB_SCH_ID
                                                           ,T.DBC_TBL_NM
                                                           ,T.DBC_TBL_KOR_NM
                                                           ,T.SUBJ_ID
                                                          
                                                      FROM WAA_DB_CONN_TRG DB
                                                           INNER JOIN WAA_DB_SCH S
                                                              ON DB.DB_CONN_TRG_ID = S.DB_CONN_TRG_ID
                                                             AND S.EXP_DTM = DATE_FORMAT( '99991231', '%Y%m%d')
                                                             AND S.REG_TYP_CD IN ('C','U')
                                                           INNER JOIN WAT_DBC_TBL T
                                                              ON T.DB_CONN_TRG_ID = S.DB_CONN_TRG_ID
                                                             AND T.DB_SCH_ID = S.DB_SCH_ID
<!--                                                              AND IFNULL(T.REG_TYP, 'C') IN ('C','U') -->
                                                           
                                                     WHERE DB.EXP_DTM = DATE_FORMAT( '99991231', '%Y%m%d')
                                                       AND DB.REG_TYP_CD IN ('C','U') ) DB
                                       ON PM.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
                                      AND PM.DB_SCH_ID = DB.DB_SCH_ID
                                      AND PM.DBC_TBL_NM = DB.DBC_TBL_NM
                                 WHERE PR.ANA_DGR IS NOT NULL
                                   AND PM.PRF_KND_CD != 'PC01'
                                 GROUP BY <if test='sortTyp == "dbConnTrgLnm"'>
								  	  DB.DB_CONN_TRG_ID
								  	  </if>
								      <if test='sortTyp == "dbSchLnm"'>
								  	  DB.DB_CONN_TRG_ID
								  	  ,DB.DB_SCH_ID
								  	  </if>
								  	  <if test='sortTyp == "dbcTblNm"'>
								  	  DB.DB_CONN_TRG_ID
								  	  ,DB.DB_SCH_ID
								  	  ,DB.DBC_TBL_NM
								  	  </if>
								  	  <if test='sortTyp == "dbcColNm"'>
								  	  DB.DB_CONN_TRG_ID
								  	  ,DB.DB_SCH_ID
								  	  ,DB.DBC_TBL_NM
								  	  ,PM.OBJ_NM
								  	  </if>, PR.ANA_DGR
                                 ORDER BY <if test='sortTyp == "dbConnTrgLnm"'>
								  	  DB.DB_CONN_TRG_ID
								  	  </if>
								      <if test='sortTyp == "dbSchLnm"'>
								  	  DB.DB_CONN_TRG_ID
								  	  ,DB.DB_SCH_ID
								  	  </if>
								  	  <if test='sortTyp == "dbcTblNm"'>
								  	  DB.DB_CONN_TRG_ID
								  	  ,DB.DB_SCH_ID
								  	  ,DB.DBC_TBL_NM
								  	  </if>
								  	  <if test='sortTyp == "dbcColNm"'>
								  	  DB.DB_CONN_TRG_ID
								  	  ,DB.DB_SCH_ID
								  	  ,DB.DBC_TBL_NM
								  	  ,PM.OBJ_NM
								  	  </if>, PR.ANA_DGR ) A ) TOT
		<if test='sortTyp == "dbConnTrgLnm"'>
	  	 ON A.DB_CONN_TRG_ID = TOT.DB_CONN_TRG_ID
	  	  </if>
	      <if test='sortTyp == "dbSchLnm"'>
	  	 ON A.DB_CONN_TRG_ID = TOT.DB_CONN_TRG_ID
	  	AND A.DB_SCH_ID = TOT.DB_SCH_ID
	  	  </if>
	  	  <if test='sortTyp == "dbcTblNm"'>
	  	 ON A.DB_CONN_TRG_ID = TOT.DB_CONN_TRG_ID
	  	AND A.DB_SCH_ID = TOT.DB_SCH_ID
	  	AND A.DBC_TBL_NM = TOT.DBC_TBL_NM
	  	  </if>	
	  	  <if test='sortTyp == "dbcColNm"'>
	  	  ON A.DB_CONN_TRG_ID = TOT.DB_CONN_TRG_ID
	  	AND A.DB_SCH_ID = TOT.DB_SCH_ID
	  	AND A.DBC_TBL_NM = TOT.DBC_TBL_NM
	  	AND A.DBC_COL_NM = TOT.DBC_COL_NM
	  	  </if>							  	  
        
       AND A.ANA_DGR = TOT.ANA_DGR
       
       <if test='sortTyp == "dbConnTrgLnm"'>
      LEFT OUTER JOIN WAA_DB_CONN_TRG DB
        ON A.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
       AND DB.REG_TYP_CD IN ('C', 'U')
       AND DB.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
       </if>
       <if test='sortTyp == "dbSchLnm"'>
      LEFT OUTER JOIN WAA_DB_CONN_TRG DB
        ON A.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
       AND DB.REG_TYP_CD IN ('C', 'U')
       AND DB.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
      LEFT OUTER JOIN WAA_DB_SCH SCH
        ON A.DB_SCH_ID = SCH.DB_SCH_ID
       AND SCH.REG_TYP_CD IN ('C', 'U')
       AND SCH.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
       
       </if>
       <if test='sortTyp == "dbcTblNm"'>
      LEFT OUTER JOIN WAA_DB_CONN_TRG DB
        ON A.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
       AND DB.REG_TYP_CD IN ('C', 'U')
       AND DB.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
      LEFT OUTER JOIN WAA_DB_SCH SCH
        ON A.DB_SCH_ID = SCH.DB_SCH_ID
       AND SCH.REG_TYP_CD IN ('C', 'U')
       AND SCH.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
       
       </if>
       <if test='sortTyp == "dbcColNm"'>
      LEFT OUTER JOIN WAA_DB_CONN_TRG DB
        ON A.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
       AND DB.REG_TYP_CD IN ('C', 'U')
       AND DB.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
      LEFT OUTER JOIN WAA_DB_SCH SCH
        ON A.DB_SCH_ID = SCH.DB_SCH_ID
       AND SCH.REG_TYP_CD IN ('C', 'U')
       AND SCH.EXP_DTM = DATE_FORMAT( '9999-12-31', '%Y-%m-%d')
       
       </if>
       
      ORDER BY
       <if test='sortTyp == "dbConnTrgLnm"'>
      DB.DB_CONN_TRG_LNM is null ASC
  	  ,DB.DB_CONN_TRG_LNM
  	  </if>
      <if test='sortTyp == "dbSchLnm"'>
      DB.DB_CONN_TRG_LNM is null ASC
      ,DB.DB_CONN_TRG_LNM
  	  ,SCH.DB_SCH_LNM
  	  </if>
  	  <if test='sortTyp == "dbcTblNm"'>
  	  DB.DB_CONN_TRG_LNM is null ASC
  	  ,DB.DB_CONN_TRG_LNM
  	  ,SCH.DB_SCH_LNM
  	  ,A.DBC_TBL_NM
  	  </if>
  	  <if test='sortTyp == "dbcColNm"'>
  	  DB.DB_CONN_TRG_LNM is null ASC
  	  ,DB.DB_CONN_TRG_LNM
  	  ,SCH.DB_SCH_LNM
  	  ,A.DBC_TBL_NM
  	  ,A.DBC_COL_NM
  	  </if>
      ,A.ANA_DGR
</select>

<select id="selectBizruleQuality" resultMap="BaseResultMap" parameterType="kr.wise.dq.report.profile.service.ProgChartVO">
  SELECT A.*
      ,CASE WHEN A.ANA_CNT = 0 THEN 0 
				 ELSE CASE WHEN A.ER_CNT = 0 THEN 100 
					 	  ELSE ROUND(((A.ANA_CNT-A.ER_CNT)/A.ANA_CNT*100),2)
	   END END AS ER_RATE
FROM (
        SELECT DB.DB_CONN_TRG_LNM
        		<if test='sortTyp == "dbcTblNm"'>
        	  ,DB.DBC_TBL_NM
        		</if>
        		<if test='sortTyp == "dbcColNm"'>
        	  ,DB.DBC_TBL_NM
        	  ,DB.DBC_COL_NM
        		</if>
              ,BR.ANA_DGR
<!--               ,BR.ANA_DGR || '차' AS ANA_DGR_DISP	 -->
              ,CONCAT(BR.ANA_DGR , ' ') AS ANA_DGR_DISP
              ,COUNT(BM.BR_ID) AS TOT_BR_CNT
              ,COUNT(DISTINCT BM.DBC_TBL_NM) AS ANA_TBL_CNT
              ,COUNT(DISTINCT BM.DBC_COL_NM) AS ANA_COL_CNT
              ,SUM(BR.ANA_CNT) AS ANA_CNT
              ,SUM(BR.ER_CNT) AS ER_CNT
              
          FROM WAM_BR_MSTR BM
            INNER JOIN WAM_BR_RESULT BR
               ON BM.BR_ID = BR.BR_ID
            INNER JOIN WAM_BIZ_AREA BIZ
               ON BM.BIZ_AREA_ID = BIZ.BIZ_AREA_ID
            INNER JOIN WAM_BR_DQI_MAP DQIMAP
               ON BM.BR_ID = DQIMAP.BR_ID
            INNER JOIN WAM_DQI DQI
               ON DQIMAP.DQI_ID = DQI.DQI_ID
            LEFT OUTER JOIN WAM_BR_CTQ_MAP CTQMAP
               ON BM.BR_ID = CTQMAP.BR_ID
            LEFT OUTER JOIN WAM_CTQ CTQ
               ON CTQMAP.CTQ_ID = CTQ.CTQ_ID
            LEFT OUTER JOIN ( SELECT  DB.DB_CONN_TRG_PNM
                                       ,DB.DB_CONN_TRG_LNM
                                       ,DB.DB_CONN_TRG_ID
                                       ,S.DB_SCH_PNM
                                       ,S.DB_SCH_LNM
                                       ,S.DB_SCH_ID
                                       ,T.DBC_TBL_NM
                                       ,T.DBC_TBL_KOR_NM
                                       ,T.SUBJ_ID
                                       ,C.DBC_COL_NM
                                       ,C.DBC_COL_KOR_NM
                                       ,C.DATA_TYPE  
                                       ,C.DATA_LEN   
                                       ,C.DATA_PNUM  
                                       ,C.DATA_PNT   
                                       ,C.NULL_YN    
                                       ,C.DEFLT_LEN  
                                       ,C.DEFLT_VAL  
                                       ,C.PK_YN      
                                       ,C.ORD        
                                       ,C.PK_ORD     
                                       ,C.COL_DESCN  
                                  FROM WAA_DB_CONN_TRG DB
                                       INNER JOIN WAA_DB_SCH S
                                          ON DB.DB_CONN_TRG_ID = S.DB_CONN_TRG_ID
                                         AND S.EXP_DTM = DATE_FORMAT( '99991231', '%Y%m%d')
                                         AND S.REG_TYP_CD IN ('C','U')
                                       INNER JOIN WAT_DBC_TBL T
                                          ON T.DB_CONN_TRG_ID = S.DB_CONN_TRG_ID
                                         AND T.DB_SCH_ID = S.DB_SCH_ID
<!--                                          AND IFNULL(T.REG_TYP, 'C') IN ('C','U') -->
                                       INNER JOIN WAT_DBC_COL C
                                          ON T.DB_SCH_ID = C.DB_SCH_ID
                                         AND T.DBC_TBL_NM = C.DBC_TBL_NM
<!--                                          AND IFNULL(C.REG_TYP, 'C') IN ('C','U') -->
                                 WHERE DB.EXP_DTM = DATE_FORMAT( '99991231', '%Y%m%d')
                                   AND DB.REG_TYP_CD IN ('C','U') ) DB
               ON BM.DB_CONN_TRG_ID = DB.DB_CONN_TRG_ID
              AND BM.DBC_TBL_NM = DB.DBC_TBL_NM
              AND BM.DBC_COL_NM = DB.DBC_COL_NM   
              
            WHERE BR.ANA_DGR IS NOT NULL
              AND DB.DB_CONN_TRG_LNM IS NOT NULL
              
              <if test="dbConnTrgId != null">
   	         AND BM.DB_CONN_TRG_ID = #{dbConnTrgId,jdbcType=VARCHAR}
	         </if>
	         <if test="dbcTblNm != null">
		     AND (DBC.DBC_TBL_NM LIKE CONCAT('%' , #{dbcTblNm,jdbcType=VARCHAR} , '%') OR DBC.DBC_TBL_KOR_NM LIKE CONCAT('%' , #{dbcTblNm,jdbcType=VARCHAR} , '%')
		       OR DBC.DBC_TBL_NM LIKE CONCAT('%' , UPPER(#{dbcTblNm,jdbcType=VARCHAR}) , '%') OR DBC.DBC_TBL_KOR_NM LIKE CONCAT('%' , UPPER(#{dbcTblNm,jdbcType=VARCHAR}) , '%'))
			  </if>
			  <if test="dbcColNm != null">
		     AND (DBC.DBC_COL_NM LIKE CONCAT('%' , #{dbcColNm,jdbcType=VARCHAR} , '%') OR DBC.DBC_COL_KOR_NM LIKE CONCAT('%' , #{dbcColNm,jdbcType=VARCHAR} , '%')
		       OR DBC.DBC_COL_NM LIKE CONCAT('%' , UPPER(#{dbcColNm,jdbcType=VARCHAR}) , '%') OR DBC.DBC_COL_KOR_NM LIKE CONCAT('%' , UPPER(#{dbcColNm,jdbcType=VARCHAR}) , '%'))
			  </if>
	         <if test="bizAreaLnm != null">
	      	 AND BIZ.FULL_PATH LIKE CONCAT('%' , #{bizAreaLnm,jdbcType=VARCHAR} , '%')
	         </if>
	         <if test="dqiLnm != null">
	      	 AND DQI.FULL_PATH LIKE CONCAT('%' , #{dqiLnm,jdbcType=VARCHAR} , '%')
	         </if>
	         <if test="ctqLnm != null">
	      	 AND CTQ.FULL_PATH LIKE CONCAT('%' , #{ctqLnm,jdbcType=VARCHAR} , '%')
	         </if>
	         <if test="brNm != null">
	      	 AND BM.BR_NM LIKE CONCAT('%' , #{brNm,jdbcType=VARCHAR} , '%')
	         </if>
	         <if test="anaDgr != null">
	         AND BR.ANA_DGR = #{anaDgr,jdbcType=VARCHAR}
	         </if> 
	         
			<if test='tgtVrfJoinCd == "N"  '>
	         AND BM.TGT_VRF_JOIN_CD IS  NULL
			</if>
			<if test='tgtVrfJoinCd == "Y"  '>
	         AND BM.TGT_VRF_JOIN_CD IS NOT NULL
			</if>
              
            GROUP BY DB.DB_CONN_TRG_LNM,<if test='sortTyp == "dbcTblNm"'>DB.DBC_TBL_NM, </if><if test='sortTyp == "dbcColNm"'>DB.DBC_TBL_NM, DB.DBC_COL_NM, </if> BR.ANA_DGR
            ORDER BY DB.DB_CONN_TRG_LNM,<if test='sortTyp == "dbcTblNm"'>DB.DBC_TBL_NM, </if><if test='sortTyp == "dbcColNm"'>DB.DBC_TBL_NM, DB.DBC_COL_NM, </if> BR.ANA_DGR ) A
       
</select>

    
</mapper>